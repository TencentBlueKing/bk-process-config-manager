(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[10],{217:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this;var t=e.$createElement;var a=e._self._c||t;return a("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:e.loading},expression:"{ isLoading: loading }"}],staticClass:"process-attribute-container"},[a("div",{staticClass:"page-head"},[e._v(e._s(e.$t("进程属性")))]),e._v(" "),e.isEmtpyTopo?a("EmptyProcess",{attrs:{"empty-type":"topo"}}):e._e(),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:!e.loading&&!e.isEmtpyTopo,expression:"!loading && !isEmtpyTopo"}],staticClass:"page-content"},[a("section",{class:["content-left",{"width-transition":!e.drag.isMouseDown}],style:{width:e.targetWidth+"px"}},[a("div",{staticClass:"process-topo"},[a("ProcessTarget",{ref:"processTarget",staticClass:"process-topo-content",attrs:{loading:!e.loading&&e.topoLoading,"tree-data":e.topoData,"template-list":e.templateList},on:{"format-tree":e.handleUpdateTree,"tree-selected":e.handleTargetSelected,"temp-selected":e.handleTargetSelected,"tab-change":e.handleTabChange},model:{value:e.tabActive,callback:function(t){e.tabActive=t},expression:"tabActive"}})],1),e._v(" "),a("div",{staticClass:"drag-box"},[a("div",{ref:"dragBorder",staticClass:"drag-border",attrs:{id:"drag-border"}})]),e._v(" "),a("div",{staticClass:"topo-toggle",on:{click:function(t){t.stopPropagation();e.showLeftTopo=!e.showLeftTopo}}},[a("i",{class:["gsekit-icon gsekit-icon-angle-left-line",{"show-topo":!e.showLeftTopo}]})])]),e._v(" "),a("section",{staticClass:"content-right"},[e.isTemplateTab&&e.isEmtpyTemplate?a("EmptyServiceBox",{attrs:{type:"template"},on:{change:e.handleEmptyLink}}):[e.isTemplateTab?a("section",{staticClass:"temp-head"},[a("p",{staticClass:"title"},[a("span",{staticClass:"tag"},[e._v(e._s(e.$t("模版")))]),e._v(e._s(e.selectedTemp.name))])]):a("section",{staticClass:"topo-head"},[a("p",{staticClass:"topo-path"},[e._v(e._s(e.topoProcessTitle))]),e._v(" "),a("h2",{staticClass:"topo-name mt10"},[e._v(e._s(e.selectedNode.topoName))])]),e._v(" "),e.isTemplateTab&&e.showSyncTip?a("div",{staticClass:"head-tips"},[a("i",{staticClass:"gsekit-icon gsekit-icon-swither-small tips-icon"}),e._v(" "),a("span",{staticClass:"tips-text"},[e._v(e._s(e.$t("当前服务模板下进程属性已改变，需到配置平台进行同步操作方可生效。")))]),e._v(" "),a("bk-button",{staticClass:"ml20",attrs:{text:"",size:"small"},on:{click:e.goSyncTemplate}},[e._v(e._s(e.$t("去同步")))]),e._v(" "),a("span",{staticStyle:{flex:"1"}})],1):e._e(),e._v(" "),a("section",{staticClass:"content-operate"},[a("div"),e._v(" "),a("bk-search-select",{directives:[{name:"test",rawName:"v-test.common",value:"searchSelect",expression:"'searchSelect'",modifiers:{common:true}}],ref:"searchSelect",staticClass:"search-input",attrs:{placeholder:e.$t("进程别名、进程名称、配置缺失情况"),"show-condition":false,data:e.filterSearchSelectData},on:{change:e.handleSearchSelectChange},model:{value:e.searchSelectValue,callback:function(t){e.searchSelectValue=t},expression:"searchSelectValue"}})],1),e._v(" "),a("section",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:!e.loading&&e.tableLoading},expression:"{ isLoading: !loading && tableLoading }"}],staticClass:"content-table-block"},[!e.tableLoading?a("ProcessTable",{attrs:{"is-biz-process":!e.isTemplateTab,"static-total":e.pagination.count,"static-incomplete":e.staticIncomplete,"table-head":e.tableHead,"table-data":e.tableData,selections:e.selections,"not-editable":e.notEditable,pagination:e.pagination,"selected-node":e.isTemplateTab?e.selectedTemp:e.selectedNode,"edit-rules":e.editRules,"is-search":!!e.searchSelectValue.length},on:{"cell-edit":e.handleCellEdit,"eidt-disabled":e.handleEidtDisabled,"sub-head-filter":e.handSubHeadFilter,"change-filters":e.handleFiltersChange,"page-change":e.handlePageChange,"selection-change":e.handleTableSelected}}):e._e()],1)]],2)])],1)};var n=[];var s=a(13);var o=a.n(s);var r=a(37);var l=a.n(r);var c=a(3);var d=a.n(c);var p=a(7);var u=a.n(p);var h=a(11);var f=a.n(h);var m=a(4);var v=a.n(m);var b=a(8);var g=function(){var e=this;var t=e.$createElement;var a=e._self._c||t;return a("div",{staticClass:"process-target"},[a("section",{staticClass:"topo-tab"},[a("div",{staticClass:"bk-button-group"},e._l(e.tabList,function(t){return a("bk-button",{key:t.id,attrs:{theme:t.id===e.tabActive?"primary":"default"},on:{click:function(a){e.handleTabClick(t)}}},[e._v("\n        "+e._s(t.name)+"\n      ")])}),1)]),e._v(" "),a("div",{staticClass:"topo-search"},[a("bk-input",{directives:[{name:"show",rawName:"v-show",value:e.showBizTopo,expression:"showBizTopo"}],attrs:{value:e.topoSearchKeyword,placeholder:e.$t("请输入关键字"),"right-icon":"bk-icon icon-search",clearable:""},on:{change:e.handleSearch}}),e._v(" "),a("bk-input",{directives:[{name:"show",rawName:"v-show",value:!e.showBizTopo,expression:"!showBizTopo"}],attrs:{placeholder:e.$t("请输入关键字"),"right-icon":"bk-icon icon-search",clearable:""},on:{change:e.handleSearch},model:{value:e.tempSearchKeyword,callback:function(t){e.tempSearchKeyword=typeof t==="string"?t.trim():t},expression:"tempSearchKeyword"}})],1),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:e.showBizTopo,expression:"showBizTopo"},{name:"bkloading",rawName:"v-bkloading",value:{isLoading:e.loading||e.searchLoading,opacity:1},expression:"{ isLoading: loading || searchLoading, opacity: 1 }"}],staticClass:"topo-content"},[a("TopoTree",{ref:"topoTree",attrs:{"load-position":"child",data:e.treeData,"node-reload":""},on:{selected:e.handleTreeSelected,"format-tree":e.handleUpdateTree}})],1),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:!e.showBizTopo,expression:"!showBizTopo"},{name:"bkloading",rawName:"v-bkloading",value:{isLoading:e.loading||e.searchLoading,opacity:0},expression:"{ isLoading: loading || searchLoading, opacity: 0 }"}],staticClass:"topo-content"},[a("ServerTemplate",{ref:"serverTemp",attrs:{"search-word":e.tempSearchKeyword,list:e.templateList},on:{click:e.handleTempClick}})],1)])};var y=[];var T=function(){var e=this;var t=e.$createElement;var a=e._self._c||t;return a("div",{staticClass:"server-template"},[a("ul",e._l(e.templateList,function(t){return a("li",{key:t.id,on:{click:function(a){e.handleClick(t)}}},[a("div",{directives:[{name:"show",rawName:"v-show",value:t.visible,expression:"item.visible"}],class:["template-list-item",{active:t.active}]},[a("i",{staticClass:"item-icon"},[e._v(e._s(e.$t("模")))]),e._v(" "),a("span",{directives:[{name:"bk-overflow-tips",rawName:"v-bk-overflow-tips"}]},[e._v(e._s(t.name))]),e._v(" "),t.showSync?a("i",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips.top",value:e.$t("未同步"),expression:"$t('未同步')",modifiers:{top:true}}],staticClass:"gsekit-icon gsekit-icon-swither-small sync-icon",on:{click:function(a){a.stopPropagation();e.goSyncTemplate(t)}}}):e._e()])])}),0)])};var w=[];var x={name:"ServerTemplate",props:{list:{type:Array,default:function e(){return[]}},searchWord:{type:String,default:""}},computed:{templateList:function e(){var t=this;return this.searchWord?this.list.filter(function(e){return e.name.includes(t.searchWord)}):this.list}},methods:{handleClick:function e(t){this.setAtive(t);this.$emit("click",t)},cancelActive:function e(){this.templateList.forEach(function(e){e.active=false})},setAtive:function e(t){this.templateList.forEach(function(e){e.active=e.id===t.id})},goSyncTemplate:function e(t){console.log(t);var a=window.PROJECT_CONFIG.CMDB_URL;var i=this.$store.state.bizId;window.open("".concat(a,"/#/business/").concat(i,"/service/operational/template/").concat(t.id,"?tab=instance"))}}};var k=x;var _=a(747);var C=a(10);var I=Object(C["a"])(k,T,w,false,null,"1dbca46f",null);var E=I.exports;var N=function(){var e=this;var t=e.$createElement;var a=e._self._c||t;return a("TopoTreeItem",e._g(e._b({directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:e.loading,zIndex:0},expression:"{ isLoading: loading, zIndex: 0 }"}],attrs:{"node-list":e.nodeList},on:{click:e.handleClick,selected:e.handleSelected,"toggle-check":e.handleToggleCheck,"toggle-expand":e.handleToggleExpand,"load-child":e.handleLoadChild}},"TopoTreeItem",e.$attrs,false),e.$listeners))};var S=[];var L=a(19);var j=function(){var e=this;var t=e.$createElement;var a=e._self._c||t;return a("ul",{staticClass:"topo-tree"},[e._l(e.nodeList,function(t,i){return a("li",{directives:[{name:"show",rawName:"v-show",value:t.topoVisible,expression:"node.topoVisible"}],key:i,staticClass:"tree-node-container"},[a("div",{class:["tree-node-item",{"topo-active":t.topoActive}],style:{"padding-left":26*t.topoLevel+"px"},on:{click:function(a){e.handleClickNode(t)}}},[a("div",{class:["node-flex-start",{expanded:t.topoExpand}]},[t.ableExpand?[t.topoLoading&&e.loadPosition==="left"?a("svg",{staticClass:"svg-icon",attrs:{"aria-hidden":"true"}},[a("use",{attrs:{"xlink:href":"#gsekit-icon-loading"}})]):a("span",{staticClass:"bk-icon icon-right-shape"})]:e._e()],2),e._v(" "),e.nodeTypeMap[t.topoType]?a("span",{class:"word-icon "+t.topoType},[e._v("\n        "+e._s(e.nodeTypeMap[t.topoType])+"\n      ")]):e._e(),e._v(" "),t.topoProcess?[a("bk-checkbox",{staticClass:"king-checkbox",model:{value:t.topoChecked,callback:function(a){e.$set(t,"topoChecked",a)},expression:"node.topoChecked"}},[a("div",{directives:[{name:"bk-overflow-tips",rawName:"v-bk-overflow-tips"}],staticClass:"text-content"},[e._v(e._s(t.topoName))])])]:a("span",{directives:[{name:"bk-overflow-tips",rawName:"v-bk-overflow-tips"}],staticClass:"node-name"},[e._v(e._s(t.topoName))]),e._v(" "),t.topoTotalCount!==undefined?a("div",{staticClass:"node-total-box"},[e._v(e._s(t.topoTotalCount))]):e._e()],2),e._v(" "),t.topoExpand&&t.child&&t.child.length?a("TopoTreeItem",{directives:[{name:"show",rawName:"v-show",value:t.topoExpand,expression:"node.topoExpand"}],attrs:{"node-list":t.child,"load-position":e.loadPosition},on:{click:e.handleClickNode}}):e.loadPosition==="child"&&t.topoExpand?a("div",{style:{"padding-left":26*(t.topoLevel+1)+22+"px"}},[t.topoLoading?a("div",{staticClass:"tree-node-loading"},[a("svg",{staticClass:"svg-icon",attrs:{"aria-hidden":"true"}},[a("use",{attrs:{"xlink:href":"#gsekit-icon-loading"}})]),e._v(" "),a("span",{staticClass:"loading-text"},[e._v(e._s(e.$t("加载中")))])]):!t.topoLoading&&t.empty?a("span",{staticClass:"node-child-empty"},[e._v("\n        "+e._s(t.emptyText||e.emptyChildText)+"\n      ")]):e._e()]):t.topoExpand&&t.topoloaded&&t.empty?a("div",{staticClass:"tree-node-empty",style:{"padding-left":26*(t.topoLevel+1)+22+"px"}},[e._v("\n      "+e._s(t.emptyText||e.emptyChildText)+"\n    ")]):e._e()],1)}),e._v(" "),!e.nodeList.length?e._t("empty",[a("div",{staticClass:"not-topo"},[e._v(e._s(e.$t("暂无业务拓扑数据")))])]):e._e()],2)};var $=[];var D={name:"TopoTreeItem",props:{nodeList:{type:Array,required:true},loadPosition:{type:String,default:"left"},emptyChildText:{type:String,default:window.i18n.t("暂无服务实例")}},data:function e(){return{nodeTypeMap:{set:this.$t("集"),module:this.$t("模"),serviceTemplate:this.$t("模"),instance:this.$t("实"),serviceInstance:this.$t("实"),process:this.$t("进")}}},methods:{handleClickNode:function e(t){this.$emit("click",t)}}};var M=D;var P=a(748);var A=Object(C["a"])(M,j,$,false,null,"6a09e600",null);var O=A.exports;function z(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a.push.apply(a,i)}return a}function B(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?z(Object(a),!0).forEach(function(t){v()(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):z(Object(a)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}var U={name:"TopoTree",components:{TopoTreeItem:O},props:{loading:{type:Boolean,default:false},data:{type:Array,required:true},expandType:{type:Array,default:function e(){return["biz","set","module"]}},loadType:{type:Array,default:function e(){return["set","module","serviceTemplate"]}},checkType:{type:Array,default:function e(){return["instanceProcess"]}},selectType:{type:Array,default:function e(){return["biz","set","module","serviceTemplate","instance","serviceInstance","process"]}},loadChild:{type:Function,default:null}},data:function e(){return{nodeList:[]}},watch:{data:function e(t){var a=this.formatTopoData(t);this.nodeList=a.sort(Object(L["h"])("bk_inst_name"));this.$emit("format-tree",this.nodeList)}},methods:{handleClick:function e(t){if(t.loading){return}if(t.topoProcess){this.handleToggleCheck(t)}if(t.ableExpand){this.handleToggleExpand(t)}if(t.ableSelect){this.handleSelected(t)}if(t.loadChild&&t.topoExpand&&!(t.child&&t.child.length)){this.handleLoadChild(t);return}if(t.ableSelect){this.$emit("selected",t)}this.$emit("click",t)},handleLoadChild:function e(t){var a=this;return u()(d.a.mark(function e(){var i,n,s;return d.a.wrap(function e(o){while(1){switch(o.prev=o.next){case 0:i=false;if(!a.loadChild){o.next=9;break}o.next=4;return a.loadChild();case 4:n=o.sent;t.child=a.formatTopoData(n,t.topoLevel,t);i=true;o.next=27;break;case 9:o.prev=9;t.topoLoading=true;if(!(t.topoType==="module")){o.next=18;break}o.next=14;return a.$store.dispatch("cmdb/ajaxGetServiceListByModule",{data:{bk_module_ids:[t.bk_inst_id]}});case 14:s=o.sent;s.data.forEach(function(e){e.topoType="serviceInstance"});t.child=a.formatTopoData(s.data,t.topoLevel,t);t.topoloaded=true;case 18:o.next=23;break;case 20:o.prev=20;o.t0=o["catch"](9);console.warn(o.t0);case 23:o.prev=23;i=true;t.topoLoading=false;return o.finish(23);case 27:if(i){if(t.ableSelect){a.$emit("selected",t)}a.$emit("click",t)}case 28:case"end":return o.stop()}}},e,null,[[9,20,23,27]])}))()},handleSelected:function e(t){this.setTopoActive(this.nodeList,t.uuid)},handleToggleCheck:function e(t){console.log(t.topoChecked);this.$emit("toggle-check",t)},handleToggleExpand:function e(t){t.topoExpand=!t.topoExpand;this.$emit("toggle-expand",t)},handleSearch:function e(t){this.setNodesVisible(this.nodeList,t)},setNodesVisible:function e(t,a){var i=this;t.forEach(function(e){e.topoExpand=false;var t=e.topoName.includes(a);e.topoVisible=t;if(t){i.setFilterExpand(e.topoParent,a)}if(e.child&&e.child.length){i.setNodesVisible(e.child,a)}})},setFilterExpand:function e(t,a){if(t){t.topoVisible=true;t.topoExpand=Boolean(a);this.setFilterExpand(t.topoParent,a)}},formatTopoData:function e(t){var a=this;var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:-1;var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;i+=1;var s=[];t.reduce(function(e,t){var s=B(B({},t),{},{uuid:a.uuid(),topoLoading:false,topoParent:n,topoVisible:true,topoActive:false,topoExpand:false,topoLevel:i,topoName:t.bk_inst_name||t.service_instance_name,topoReduceName:n&&n.id?n.topoReduceName+t.topoName:t.topoName,topoProcess:n&&["serviceInstance","instance"].includes(n.topoType),topoChecked:false});if(t.bk_obj_id==="biz"){s.topoType="biz"}else if(t.bk_obj_id==="set"){s.topoType="set"}else if(t.bk_obj_id==="module"){s.empty=true;s.topoloaded=false;if(t.service_template_id){s.topoType="serviceTemplate"}else{s.topoType="module"}}s.ableSelect=a.transNodeValue(s,a.selectType);s.ableExpand=a.transNodeValue(s,a.expandType);s.loadChild=a.transNodeValue(s,a.loadType);s.topoConcatPath=n&&n.uuid?"".concat(n.topoConcatPath," / ").concat(s.topoName):s.topoName;if(t.child&&t.child.length){s.child=a.formatTopoData(t.child,i,s)}e.push(s);return e},s);return s},transNodeValue:function e(t,a){return a&&a.length?a.includes(t.topoType):true},setTopoActive:function e(t,a){var i=this;(t||this.nodeList).forEach(function(e){e.topoActive=e.uuid===a;if(e.topoActive){i.setParentExpand(e.topoParent)}if(e.child&&e.child.length){i.setTopoActive(e.child,a)}})},setParentExpand:function e(t){if(t){t.topoVisible=true;t.topoExpand=true;this.setParentExpand(t.topoParent)}},cancelTopoActive:function e(t){this.setTopoActive(t||this.nodeList)},getTreeData:function e(){return this.nodeList},uuid:function e(){var t="";var a=Math.floor((1+Math.random())*65536).toString(16).substring(1);for(var i=0;i<7;i++){t+=a}return t}}};var H=U;var R=Object(C["a"])(H,N,S,false,null,null,null);var W=R.exports;var V={name:"ProcessTarget",components:{ServerTemplate:E,TopoTree:W},model:{prop:"tabActive",event:"tab-change"},props:{loading:{type:Boolean,default:false},treeData:{type:Array,defaut:function e(){return[]}},templateList:{type:Array,defaut:function e(){return[]}},tabActive:{type:String,default:"template"},timely:{type:Boolean,default:true},debounceTime:{type:Number,default:300}},data:function e(){return{tabList:[{id:"template",name:window.i18n.t("按服务模板")},{id:"node",name:window.i18n.t("按业务拓扑")}],searchLoading:false,tempSearchKeyword:"",topoSearchKeyword:"",searchTimer:null}},computed:{showBizTopo:function e(){return this.tabActive==="node"}},methods:{handleTabClick:function e(t){if(t!==this.tabActive){if(this.timely){this.handleTimelyChange(t)}this.$emit("tab-change",t.id)}},handleSearch:function e(t){var a=this;this.searchLoading=true;this.searchTimer&&clearTimeout(this.searchTimer);this.searchTimer=setTimeout(function(){if(a.tabActive==="node"){a.topoSearchKeyword=t.trim();a.$refs.topoTree.handleSearch(a.topoSearchKeyword)}else{a.tempSearchKeyword=t.trim()}a.searchLoading=false},this.debounceTime)},handleTempClick:function e(t){this.$refs.topoTree.cancelTopoActive();this.$emit("temp-selected",t)},handleTreeSelected:function e(t){this.$refs.serverTemp.cancelActive();this.$emit("tree-selected",t)},handleUpdateTree:function e(t){this.$emit("format-tree",t)},handleTimelyChange:function e(t){if(t==="template"){this.topoSearchKeyword="";this.$refs.topoTree.cancelTopoActive()}else{this.$refs.serverTemp.cancelActive();this.tempSearchKeyword=""}},handleSetTemplateActive:function e(t){this.$refs.serverTemp.setAtive(t)},handleSetTopoActive:function e(t){this.$refs.topoTree.setTopoActive(null,t)}}};var G=V;var Z=a(749);var F=Object(C["a"])(G,g,y,false,null,"272e6f86",null);var Y=F.exports;var Q=function(){var e=this;var t=e.$createElement;var a=e._self._c||t;return a("section",[a("div",{staticClass:"table-statistics"},[e.isBizProcess?a("i18n",{staticClass:"static-total",attrs:{path:"进程总数"}},[a("span",{staticClass:"primary"},[e._v(e._s(e.staticTotal))])]):a("i18n",{staticClass:"static-total",attrs:{path:"模板进程总数"}},[a("span",{staticClass:"primary"},[e._v(e._s(e.staticTotal))])]),e._v(" "),e.staticIncomplete?a("span",{staticClass:"static-incomplete"},[e._v("\n      "+e._s(e.$t("配置缺失"))+":\n      "),a("span",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips",value:e.$t("筛选"),expression:"$t('筛选')"}],staticClass:"text-cursor undone",on:{click:function(t){t.stopPropagation();return e.handleFiltersChange(t)}}},[e._v("\n        "+e._s(e.staticIncomplete)+"\n      ")])]):e._e()],1),e._v(" "),a("ExpandTable",{ref:"expandTable",attrs:{"check-all":"","row-key":"id","ext-cls":"edit-table","table-head":e.tableHead,data:e.tableData,"edit-rules":e.editRules,pagination:e.pagination,"row-class-name":e.setRowClassName,"cell-class-name":e.setCellClassName,"header-cell-class-name":e.getellClassName,"empty-text":e.$t("搜索结果不存在")},on:{rowCheck:e.handleRowCheck,"cell-edit":e.handleCellEdit,"eidt-disabled":e.handleEidtDisabled,"page-change":e.handlePageChange,"sub-head-click":e.handFilterUndone,"page-limit-change":e.handlePageLimitChange,"selection-change":e.handleSelectionChange},scopedSlots:e._u([{key:"isTemplate",fn:function(t){var i=t.row;return[a("span",{class:["table-tag",{"is-template":i.isTemplate}]},[e._v("\n        "+e._s(i.isTemplate?e.$t("模版"):e.$t("实例"))+"\n      ")])]}},{key:"alias",fn:function(t){var i=t.row;return[i.showTypeTag?a("span",{class:["table-tag",{"is-template":i.isTemplate}]},[e._v("\n        "+e._s(i.isTemplate?e.$t("模版"):e.$t("实例"))+"\n      ")]):e._e(),e._v(" "),i.isTemplate?a("div",{staticClass:"text-cursor",on:{click:function(t){e.handleEidtDisabled(i)}}},[a("bk-button",{attrs:{text:""}},[e._v(e._s(i.bk_process_name))]),e._v(" "),a("i",{staticClass:"gsekit-icon gsekit-icon-jump-fill primary ml10"})],1):a("span",[e._v(e._s(i.bk_process_name))])]}},{key:"topo",fn:function(t){var a=t.row;return[e._v("\n      "+e._s(a.topoPath)+"\n    ")]}}])},[!e.tableData.length&&!e.isSearch?a("EmptyServiceBox",{attrs:{slot:"empty",title:e.$t("暂无进程"),desc:e.isBizProcess?e.$t("当前业务拓扑下暂无进程"):e.$t("当前服务模板下暂无进程"),"desc-slot":"创建进程slot"},on:{"click-link":e.handleEmptyLink},slot:"empty"}):e._e()],1)],1)};var K=[];var J=function(){var e=this;var t=e.$createElement;var a=e._self._c||t;return a("div",{staticClass:"process-attribute-container"},[a("bk-table",e._g(e._b({directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:e.loading,zIndex:0},expression:"{ isLoading: loading, zIndex: 0 }"}],ref:"table",class:["expand-table",{edit:e.edit,"right-shadow-table":e.rightShadow}]},"bk-table",e.$attrs,false),e.$listeners),[a("template",{slot:"prepend"},[e._t("prepend")],2),e._v(" "),a("template",{slot:"empty"},[e._t("empty")],2),e._v(" "),e._l(e.tableHead,function(t){var i;return a("bk-table-column",e._b({key:t.key,attrs:{align:"center"}},"bk-table-column",Object.assign({},t,(i={},i[t.isExpandable?"renderHeader":"other"]=e.headRenderExpand,i)),false),[t.isExpandable&&!t.isExpand?a("bk-table-column",{attrs:{align:"center",prop:t.key,"render-header":e.headRenderStatus},scopedSlots:e._u([{key:"default",fn:function(i){var n=i.row;return[a("img",{staticClass:"status-img",attrs:{src:e.getGroupStatus(n,t.child)}})]}}])}):[e._l(t.child,function(t){return[t.type==="selection"?[e.openCheckAll?a("bk-table-column",{key:t.prop,attrs:{"render-header":e.checkRender},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;return a("div",{on:{click:function(e){e.stopPropagation()}}},[a("bk-checkbox",{attrs:{value:i.rowSelect,disabled:i.disabled},on:{change:function(t){e.handleRowCheck(i)}}})],1)}}])}):a("bk-table-column",e._b({key:t.prop},"bk-table-column",t,false))]:t.slotNameStr?a("bk-table-column",e._b({key:t.prop,scopedSlots:e._u([{key:"default",fn:function(a){var i=a.row;var n=a.$index;return[e._t(t.slotNameStr,null,{row:i,$index:n})]}}])},"bk-table-column",t,false)):e.edit&&t.editAble?a("bk-table-column",e._b({key:t.prop,attrs:{"class-name":"edit-cell"},scopedSlots:e._u([{key:"default",fn:function(i){var n=i.row;var s=i.$index;return[t.prop===e.editProp&&e.editIndex===s?a("div",{staticClass:"bk-form-control edit-input"},[a("div",{staticClass:"bk-input-text"},[a("input",{directives:[{name:"model",rawName:"v-model.trim",value:e.editValue,expression:"editValue",modifiers:{trim:true}}],ref:"editInput",refInFor:true,staticClass:"bk-form-input pr10",attrs:{type:"text",placeholder:e.$t("请输入")},domProps:{value:e.editValue},on:{"!blur":function(a){var i=arguments.length,s=Array(i);while(i--)s[i]=arguments[i];e.handleEditBlur.apply(void 0,s.concat([n[t.prop]],[t]))},input:function(t){if(t.target.composing){return}e.editValue=t.target.value.trim()},blur:function(t){e.$forceUpdate()}},nativeOn:{keyup:function(t){if(!("button"in t)&&e._k(t.keyCode,"enter",13,t.key,"Enter")){return null}return e.handleEditEnter(t)}}})])]):a("div",{class:["text-content",{disabled:n.disabled}],on:{click:function(a){e.handleEditfocus(t.prop,n,s)}}},[a("bk-popover",{attrs:{disabled:!n.disabled,placement:"top",theme:"light"}},[!e.isEmpty(n[t.prop])?a("span",[e._v(e._s(n[t.prop]))]):a("div",{staticStyle:{display:"block",width:"100%",height:"100%"}}),e._v(" "),a("i18n",{attrs:{slot:"content",path:"跳转服务模板"},slot:"content"},[a("span",{staticClass:"text-cursor primary",on:{click:function(t){e.handleGoServeTemp(n)}}},[e._v(e._s(e.$t("服务模版")))])])],1)],1)]}}])},"bk-table-column",t,false)):a("bk-table-column",e._b({key:t.prop,scopedSlots:e._u([{key:"default",fn:function(a){var i=a.row;return[e._v("\n              "+e._s(e.emptyCell(i[t.prop]))+"\n            ")]}}])},"bk-table-column",t,false))]})]],2)}),e._v(" "),e.rightShadow?a("bk-table-column",{attrs:{fixed:"right",width:1}},[a("bk-table-column",{attrs:{fixed:"right",width:1}})],1):e._e()],2)],1)};var q=[];var X=function(){var e=this;var t=e.$createElement;var a=e._self._c||t;return a("div",{staticClass:"expand-th-container"},[e.column.tips?a("span",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips",value:{content:e.column.tips,placement:e.tipsPlacement},expression:"{\n      content: column.tips,\n      placement: tipsPlacement\n    }"}],staticClass:"text-has-tips"},[e._v(e._s(e.column.label))]):a("span",[e._v(e._s(e.column.label))]),e._v(" "),a("div",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips",value:{content:e.isExpand?e.$t("收起配置字段"):e.$t("展开配置字段"),placement:"right"},expression:"{\n      content: isExpand ? $t('收起配置字段') : $t('展开配置字段'),\n      placement: 'right'\n    }"}],staticClass:"expand-btn",on:{click:function(t){t.stopPropagation();return e.handleToggleExpand(t)}}},[a("i",{class:"gsekit-icon gsekit-icon-"+(e.isExpand?"shouqi":"zhankai")})])])};var ee=[];var te={name:"ExpandTh",props:{column:{type:Object,default:function e(){return{}}},isExpand:{type:Boolean,default:false},tipsPlacement:{type:String,default:"top"}},methods:{handleToggleExpand:function e(){this.$emit("click-expand",!this.column.isExpand)}}};var ae=te;var ie=a(750);var ne=Object(C["a"])(ae,X,ee,false,null,"398eefd5",null);var se=ne.exports;var oe=a(751);var re=a.n(oe);var le=a(752);var ce=a.n(le);var de={name:"ExpandTable",props:{loading:{type:Boolean,default:false},tableHead:{type:Array,default:function e(){return[]}},checkAll:{type:Boolean,default:false},checkRender:{type:Function,default:null},edit:{type:Boolean,default:true},editRules:{type:Object,default:function e(){return{}}},undoneLoading:{type:Boolean,default:false},rightShadow:{type:Boolean,default:true},emptyText:{type:String,default:""}},data:function e(){return{editProp:"",editIndex:null,editValue:""}},computed:{openCheckAll:function e(){return this.checkAll&&!!this.checkRender}},methods:{handleRowCheck:function e(t){t.rowSelect=!t.rowSelect;this.$emit("rowCheck",t)},headRenderExpand:function e(t,a){var i=a.$index;var n=this.tableHead[i];return t(se,{props:{column:n,isExpand:n.isExpand},on:{"click-expand":function e(t){n.isExpand=t}}})},headRenderStatus:function e(t,a){var i=this;var n=a.column;if(this.undoneLoading){return t("bk-button",{props:{icon:"loading",text:true,disabled:true}})}var s=this.tableHead.find(function(e){return e.key===n.property});if(s&&s.hasUndone){return t("img",{class:"status-img",style:{cursor:"pointer"},attrs:{src:ce.a},on:{click:function e(){return i.handSubHeadClick({column:n,parent:s})}}})}return t("img",{class:"status-img",attrs:{src:re.a}})},handSubHeadClick:function e(t){var a=t.column,i=t.parent;this.$emit("sub-head-click",{column:a,parent:i})},handleEditfocus:function e(t,a,i){var n=this;if(!a.disabled&&!this.editProp){this.editProp=t;this.editIndex=i;this.editValue=a[t];this.$nextTick(function(){n.$refs.editInput[0]&&n.$refs.editInput[0].focus()})}},handleEditBlur:function e(t,a,i){var n=false;var s="";var o=this.editRules[this.editProp];var r="".concat(this.editValue);var l="".concat(a);if(r!==l&&o){if(!r){this.editProp="";this.editIndex=null;return}o.forEach(function(e){n=e.validator?e.validator(r):false;s=n?e.message:""})}if(n){this.$bkMessage({message:s,theme:"error"});if(t&&t.preventDefault){t.preventDefault()}this.$refs.editInput[0]&&this.$refs.editInput[0].focus();return false}if(r!==l){this.$emit("cell-edit",{prop:this.editProp,value:i.type==="number"?parseInt(this.editValue):this.editValue,row:this.$attrs.data[this.editIndex],index:this.editIndex})}this.editProp="";this.editIndex=null},handleEditEnter:function e(){this.$refs.editInput[0]&&this.$refs.editInput[0].blur()},handleGoServeTemp:function e(t){this.$emit("eidt-disabled",t)},getGroupStatus:function e(t,a){return a&&a.some(function(e){return!t[e.prop]&&t[e.prop]!==0})?ce.a:re.a},isEmpty:function e(t){return t===null||t===undefined||t===""},emptyCell:function e(t){return!this.isEmpty(t)?t:this.emptyText},clearSelection:function e(){this.$refs.table.clearSelection()}}};var pe=de;var ue=a(753);var he=Object(C["a"])(pe,J,q,false,null,"c90204d8",null);var fe=he.exports;var me=a(576);var ve={name:"ProcessTable",components:{ExpandTable:fe,EmptyServiceBox:me["a"]},props:{isBizProcess:{type:Boolean,default:true},selectedNode:{type:Object,default:function e(){return{}}},tableData:{type:Array,default:function e(){return[]}},tableHead:{type:Array,default:function e(){return[]}},staticTotal:{type:Number,default:0},staticIncomplete:{type:Number,default:0},selections:{type:Array,default:function e(){return[]}},pagination:{type:Object,default:function e(){return{current:1,count:0,limit:10}}},editRules:{type:Object,default:function e(){return{}}},isSearch:{type:Boolean,default:false}},data:function e(){return{testExpand:true,indeterminate:false,isAllChecked:false,checkLoading:false}},computed:{openCheckAll:function e(){return this.checkAll&&!!this.checkRender}},methods:{handleRowCheck:function e(t){console.log(t)},handlePageChange:function e(t,a){this.$emit("page-change",{page:t,limit:a||this.pagination.limit})},handlePageLimitChange:function e(t){this.handlePageChange(1,t)},handleFiltersChange:function e(){this.$emit("change-filters",this.staticIncomplete)},handleSelectionChange:function e(t){this.$emit("selection-change",t)},handleCellEdit:function e(t){this.$emit("cell-edit",t)},handFilterUndone:function e(t){this.$emit("sub-head-filter",t)},handleEidtDisabled:function e(t){this.$emit("eidt-disabled",t)},handleCancelSelect:function e(){this.$refs.expandTable.clearSelection()},selectableFn:function e(t){return!t.disabled},setRowClassName:function e(t){var a=t.row;return a.disabled?"disabled-row":""},getellClassName:function e(t){var a=t.row,i=t.rowIndex,n=t.columnIndex;var s=!i&&this.tableHead[n]&&this.tableHead[n].isExpandable?"expand-th":"";return this.isBizProcess&&a[n].property==="bk_process_name"?"".concat(s," show-tag-column"):s},setCellClassName:function e(t){var a=t.row,i=t.column;return i.property==="bk_process_name"&&a.showTypeTag?"show-tag-column":""},handleEmptyLink:function e(){var t="".concat(window.PROJECT_CONFIG.CMDB_URL,"/#/business/").concat(this.$store.state.bizId,"/");if(this.isBizProcess){var a=this.selectedNode,i=a.bk_inst_id,n=a.bk_obj_id,s=a.topoType,o=a.topoParent;if(s==="set"||s==="module"||s==="serviceTemplate"){t="".concat(t,"index?node=").concat(n,"-").concat(i,"&tab=serviceInstance&view=instance")}else if(s==="serviceInstance"){t="".concat(t,"index?node=").concat(o.bk_obj_id,"-").concat(o.bk_inst_id,"&tab=serviceInstance&view=instance")}}else{t+="service/operational/template/".concat(this.selectedNode.id,"?tab=config")}window.open(t,"_blank")}}};var be=ve;var ge=a(756);var ye=Object(C["a"])(be,Q,K,false,null,"4826be56",null);var Te=ye.exports;var we=a(641);var xe={work_path:[{required:true,message:window.i18n.t("必填项"),trigger:"blur"}],user:[{required:true,message:window.i18n.t("必填项"),trigger:"blur"}],pid_file:[{required:true,message:window.i18n.t("必填项"),trigger:"blur"}],start_cmd:[{required:true,message:window.i18n.t("必填项"),trigger:"blur"}],stop_cmd:[{required:true,message:window.i18n.t("必填项"),trigger:"blur"}],bk_process_name:[{required:true,message:window.i18n.t("必填项"),trigger:"blur"}],bk_func_name:[{required:true,message:window.i18n.t("必填项"),trigger:"blur"}],timeout:[{validator:function e(t){if(!t||t==="0"||/-/.test(t)){return true}},message:window.i18n.t("请输入正整数"),trigger:"blur"}],bk_start_check_secs:[{validator:function e(t){if(!t||t==="0"||/-/.test(t)){return true}},message:window.i18n.t("请输入正整数"),trigger:"blur"}],priority:[{validator:function e(t){if(!/^-?\d+$/.test(t)){return true}},required:true,message:window.i18n.t("请输入整数"),trigger:"blur"}],proc_num:[{validator:function e(t){console.log(/-/.test(t),t);if(!t||t==="0"||/-/.test(t)){return true}},message:window.i18n.t("请输入正整数"),trigger:"blur"}]};var ke=function e(t,a){var i=null;return function(){var e=this;var n=arguments;if(!i){i=setTimeout(function(){t.apply(e,n);i=null},a)}}};var _e=function e(t){var a=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"left";var i=arguments.length>2?arguments[2]:undefined;var n=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;this.isMouseDown=false;var s={left:"right",right:"left",top:"bottom",bottom:"top"};var o=this;t.onmousedown=function(e){var r;e=e||event;var l=e.clientX;var c=e.clientY;o.isMouseDown=true;var d=(r={},v()(r,a,t.style[a]),v()(r,"zIndex",t.style.zIndex||5),v()(r,"position",t.style.position),r);var p;var u;var h=s[a];if(n){Object.keys(s).forEach(function(e){t.style[e]=0});t.style.position="fixed"}else{t.style[h]=0;t.style.border="1px dashed #dae0e4"}t.style.zIndex="99999";document.onmousemove=function(e){e=e||event;p=e.clientX;u=e.clientY;switch(a){case"left":t.style.left="".concat(p-l,"px");break;case"right":t.style.right="".concat(l-p,"px");break;case"top":t.style.top="".concat(u-c,"px");break;case"bottom":t.style.bottom="".concat(c-u,"px");break;default:t.style.left="".concat(p-l,"px");break}if(n&&i&&typeof i==="function"){ke(i({x:p-l,y:u-c},50));l=p;c=u}};t.onmouseup=function(){t.style.border="0";t.style.zIndex=d.zIndex;t.style[a]=d[a];t.style.position=d.position;t.style[h]="auto";if(!n&&i&&typeof i==="function"){i({x:p-l,y:u-c})}o.isMouseDown=false;document.onmousemove=null};return false}};function Ce(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a.push.apply(a,i)}return a}function Ie(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Ce(Object(a),!0).forEach(function(t){v()(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Ce(Object(a)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}var Ee={name:"ProcessAttribute",components:{ProcessTarget:Y,ProcessTable:Te,EmptyProcess:we["a"],EmptyServiceBox:me["a"]},props:{type:{type:String,default:"template"}},data:function e(){return{isEmtpyTopo:false,isEmtpyTemplate:false,isEmtpyInstance:false,loading:false,topoLoading:false,tableLoading:false,showLeftTopo:true,leftWidth:330,isMouseDown:true,showSyncTip:false,tabActive:"template",selectedNode:{},selectedTemp:{},nodeInfo:{type:"",id:"",instanceId:null},templateId:null,instanceId:null,searchSelectData:[{name:this.$t("进程别名"),id:"bk_process_name"},{name:this.$t("进程名称"),id:"bk_func_name"},{name:this.$t("配置缺失"),id:"missing",multiable:true,children:[{name:this.$t("基础控制配置"),id:"controlBase"},{name:this.$t("启动配置"),id:"startConfig"},{name:this.$t("停止配置"),id:"stopConfig"},{name:this.$t("重启配置"),id:"restartConfig"},{name:this.$t("重载配置"),id:"reloadConfig"},{name:this.$t("强制终止配置"),id:"faceStopConfig"}]}],searchSelectValue:[],staticIncomplete:0,topoData:[],formatTree:[],templateList:[],sourceTableData:[],tableData:[],selections:[],pagination:{current:1,count:0,limit:10},slider:{show:false,title:this.$t("批量编辑"),width:756},filterFields:[],tableHead:[{label:"",props:"base",key:"",fixed:true,width:120,isExpandable:false,isExpand:true,hasUndone:false,hasChild:true,headerAlign:"center",child:[{label:this.$t("进程别名"),prop:"bk_process_name",width:120,slotNameStr:"alias",fixed:true}]},{label:this.$t("进程基本属性"),props:"base",key:"attributeBase",isExpandable:false,isExpand:true,hasUndone:false,hasChild:true,headerAlign:"center",child:[{label:this.$t("进程名称"),prop:"bk_func_name",fixed:false,minWidth:86},{label:this.$t("所属拓扑"),prop:"topoPath",fixed:false,slotNameStr:"topo",minWidth:200,showOverflowTooltip:true},{label:this.$t("进程启动参数"),prop:"bk_start_param_regex",minWidth:200,fixed:false},{label:this.$t("进程备注"),prop:"description",fixed:false,minWidth:100}]},{label:this.$t("基础控制配置"),props:"",key:"controlBase",isExpandable:true,isExpand:true,fixed:false,hasUndone:false,hasChild:true,tips:this.$t("若要使用Gsekit进行进程管理，需完善此基础控制配置"),child:[{label:this.$t("启动用户"),prop:"user",minWidth:86,fixed:false},{label:this.$t("PID 文件路径"),prop:"pid_file",minWidth:200,fixed:false},{label:this.$t("工作路径"),prop:"work_path",minWidth:160,fixed:false},{label:this.$t("操作超时时长th"),prop:"timeout",type:"number",minWidth:120,fixed:false},{label:this.$t("启动优先级"),prop:"priority",type:"number",minWidth:100,fixed:false}]},{label:this.$t("启动配置"),props:"",key:"startConfig",width:"auto",isExpandable:true,isExpand:true,fixed:false,hasUndone:false,hasChild:true,child:[{label:this.$t("启动命令"),prop:"start_cmd",minWidth:120,fixed:false},{label:this.$t("启动等待时长th"),prop:"bk_start_check_secs",type:"number",minWidth:130,fixed:false},{label:this.$t("启动数量"),prop:"proc_num",type:"number",minWidth:100,fixed:false}]},{label:this.$t("停止配置"),props:"",key:"stopConfig",width:"auto",isExpandable:true,isExpand:true,fixed:false,hasUndone:false,hasChild:true,child:[{label:this.$t("停止命令"),prop:"stop_cmd",minWidth:120,fixed:false}]},{label:this.$t("重启配置"),props:"",key:"restartConfig",width:"auto",isExpandable:true,isExpand:true,fixed:false,hasUndone:0,hasChild:true,child:[{label:this.$t("重启命令"),prop:"restart_cmd",minWidth:120,fixed:false}]},{label:this.$t("重载配置"),props:"",key:"reloadConfig",width:"auto",isExpandable:true,isExpand:true,fixed:false,hasUndone:false,hasChild:true,child:[{label:this.$t("重载命令"),prop:"reload_cmd",minWidth:120,fixed:false}]},{label:this.$t("强制终止配置"),props:"",key:"faceStopConfig",width:"auto",isExpandable:true,isExpand:true,fixed:false,hasUndone:false,hasChild:true,child:[{label:this.$t("强制停止命令"),prop:"face_stop_cmd",minWidth:120,fixed:false}]}],editRules:xe,notEditable:["selection","isTemplate","bk_func_name","bk_process_name","alias","name","topo"],drag:{}}},computed:Ie(Ie({},Object(b["d"])(["bizId"])),{},{targetWidth:function e(){return this.showLeftTopo?this.leftWidth:0},topoPath:function e(){return this.selectedNode.topoConcatPath},topoProcessTitle:function e(){return this.topoPath?"".concat(this.topoPath):this.$store.state.bizName},batchDisabled:function e(){return!this.selections.length},isTemplateTab:function e(){return this.tabActive==="template"},filterSearchSelectData:function e(){var t=this.searchSelectValue.map(function(e){return e.id});return this.searchSelectData.filter(function(e){return!t.includes(e.id)})}}),watch:{$route:{deep:true,handler:function e(t,a){var i=a.query.biz;var n=t.query,s=n.biz,o=n.template;this.templateId=o||null;this.tabActive=this.type;f()(this.pagination,{current:1,count:0,limit:10});this.setTableHead();if(i!==s){this.initTopoAndRouter()}else{this.initTargetInfo()}}}},created:function e(){this.initTopoAndRouter()},mounted:function e(){var t=this;this.$nextTick(function(){t.drag=new _e(t.$refs.dragBorder,"right",t.handleDrag,true)})},methods:Ie(Ie(Ie({},Object(b["b"])("cmdb",["ajaxGetProcessRelated","ajaxGetCheckServiceTemplate","ajaxGetBatchCheckServiceTemplate"])),Object(b["b"])("process",["ajaxGetTemplateProcessByServiceTemplate"])),{},{initTopoAndRouter:function e(){var t=this;this.loading=true;this.initTableHead();this.loadTopoData().then(function(e){if(e){t.initTargetInfo()}else{t.loading=false}})},initTargetInfo:function e(){var t=this;return u()(d.a.mark(function e(){var a,i,n,s,o,r,l,c,p,u,h;return d.a.wrap(function e(d){while(1){switch(d.prev=d.next){case 0:a=t.$route.query||{},i=a.node,n=i===void 0?"":i,s=a.template;t.tabActive=["template","node"].includes(t.type)?t.type:"template";o=s-0;if(!(t.isEmtpyTopo||t.tabActive==="template"&&t.isEmtpyTemplate)){d.next=6;break}t.loading=false;return d.abrupt("return",false);case 6:if(!(t.tabActive==="template")){d.next=18;break}r=t.templateList.find(function(e){return e.id===o})||t.templateList[0];if(!(r.id===o)){d.next=14;break}t.selectedTemp=r;t.templateId=r.id;t.$refs.processTarget.handleSetTemplateActive(r);d.next=16;break;case 14:t.$store.commit("routeProcessAttr",{params:{type:t.tabActive},query:{template:r.id}});return d.abrupt("return",false);case 16:d.next=26;break;case 18:l={nodeItem:null};if(n){c=n.split("-");if(c[2]){t.findSelectedTopo({type:"serviceInstance",id:c[2]-0},l,t.formatTree);if(!l.nodeItem){t.$store.commit("routeProcessAttr",{params:{type:t.tabActive},query:{node:"".concat(c[0],"-").concat(c[1])}})}}if(!l.nodeItem){t.findSelectedTopo({type:c[0],id:c[1]-0},l,t.formatTree)}}if(!(!n||!l.nodeItem)){d.next=24;break}p=t.formatTree[0],u=p.bk_obj_id,h=p.bk_inst_id;t.$store.commit("routeProcessAttr",{params:{type:t.tabActive},query:{node:"".concat(u,"-").concat(h)}});return d.abrupt("return",false);case 24:t.selectedNode=l.nodeItem;t.$refs.processTarget.handleSetTopoActive(l.nodeItem.uuid);case 26:t.pageLoadProcess();t.loading=false;case 28:case"end":return d.stop()}}},e)}))()},findSelectedTopo:function e(t,a,i){var n=this;var s=t.type,o=t.id;i.forEach(function(e){if(s==="serviceInstance"){if(e.service_instance_id===o){a.nodeItem=e}}else{if(e.bk_inst_id===o&&s===e.bk_obj_id){a.nodeItem=e;if(s==="biz"){e.topoExpand=true}}}if(e.child&&e.child.length){n.findSelectedTopo({type:s,id:o},a,e.child)}})},pageLoadProcess:function e(){var t=this;return u()(d.a.mark(function e(){return d.a.wrap(function e(a){while(1){switch(a.prev=a.next){case 0:if(t.isTemplateTab){if(t.templateId){t.loadTableData();t.checkServeTemplate();t.batchCheckServeTemplate()}else{t.initTargetInfo()}}else{t.loadTableData();t.loadUndoneCount()}case 1:case"end":return a.stop()}}},e)}))()},loadTopoData:function e(){var t=this;return u()(d.a.mark(function e(){return d.a.wrap(function e(a){while(1){switch(a.prev=a.next){case 0:return a.abrupt("return",new Promise(function(){var e=u()(d.a.mark(function e(a,i){var n,s,o,r;return d.a.wrap(function e(c){while(1){switch(c.prev=c.next){case 0:c.prev=0;t.topoLoading=true;c.next=4;return Promise.all([t.$store.dispatch("cmdb/ajaxGetBizTopo"),t.$store.dispatch("cmdb/ajaxGetServiceTemplate")]);case 4:n=c.sent;s=l()(n,2);o=s[0];r=s[1];r.data.forEach(function(e){e.active=false;e.visible=true;e.showSync=false});r.data.sort(Object(L["h"])("name"));t.templateList=r.data;t.isEmtpyTemplate=!r.data||!r.data.length;if(o.data&&o.data.length){t.topoData=o.data;t.isEmtpyTopo=!(o.data[0].child&&o.data[0].child.length)}else{t.isEmtpyTopo=true}a(!t.isEmtpyTopo||t.type==="template"&&!t.isEmtpyTemplate);c.next=21;break;case 16:c.prev=16;c.t0=c["catch"](0);console.warn(c.t0);t.loading=false;i(c.t0);case 21:c.prev=21;t.topoLoading=false;return c.finish(21);case 24:case"end":return c.stop()}}},e,null,[[0,16,21,24]])}));return function(t,a){return e.apply(this,arguments)}}()));case 1:case"end":return a.stop()}}},e)}))()},loadTableData:function e(){var t=this;return u()(d.a.mark(function e(){var a,i,n,s,r,l,c,p,u;return d.a.wrap(function e(d){while(1){switch(d.prev=d.next){case 0:a=0;i=[];d.prev=2;t.tableLoading=true;n=t.isTemplateTab?"ajaxGetTemplateProcessByServiceTemplate":"ajaxGetProcessRelated";d.next=7;return t[n](t.isTemplateTab?{serviceTemplateId:t.templateId}:t.getParams("load"));case 7:s=d.sent;if(s.result){if(t.type==="template"){i=s.data.map(function(e){return Ie(Ie({},e),e.property||{})});t.sourceTableData=i;a=s.data.length;i=t.forntfilterData()}else{r=s.data,l=r.count,c=r.info,p=c===void 0?[]:c;i=p.map(function(e){var a=e.host,i=e.module,n=e.process,s=e.process_template,o=e.service_instance,r=e.set;return Ie(Ie(Ie(Ie(Ie(Ie({},e),a),i),n),r),{},{processTemplateId:s.id,serviceInstanceId:o.id,topoPath:t.setRowTopoPath(r,i,o),disabled:!t.isTemplateTab&&!!s.id,showTypeTag:!t.isTemplateTab,isTemplate:!!s.id})});a=l}}d.next=14;break;case 11:d.prev=11;d.t0=d["catch"](2);console.warn(d.t0);case 14:d.prev=14;t.setHeadUndoneStatus(i);(u=t.tableData).splice.apply(u,[0,t.tableData.length].concat(o()(i)));t.pagination.count=a;t.tableLoading=false;t.loading=false;if(t.isTemplateTab){t.staticIncomplete=t.getUndoneCount()}return d.finish(14);case 22:case"end":return d.stop()}}},e,null,[[2,11,14,22]])}))()},loadUndoneCount:function e(){var t=this;return u()(d.a.mark(function e(){var a,i,n;return d.a.wrap(function e(s){while(1){switch(s.prev=s.next){case 0:a=t.getParams("statis");s.next=3;return t.ajaxGetProcessRelated(a);case 3:i=s.sent;n=0;if(i.result){n=i.data.count||0}t.staticIncomplete=n;case 7:case"end":return s.stop()}}},e)}))()},getUndoneCount:function e(){var t=this.tableHead.filter(function(e){return e.isExpandable});var a=[];t.forEach(function(e){a.push.apply(a,o()(e.child.map(function(e){return e.prop})))});if(!a.length)return 0;var i=this.tableData.filter(function(e){return a.some(function(t){return e[t]!==0&&!e[t]})});return i.length},getParams:function e(){var t=this;var a=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"load";if(a==="load"&&this.type==="template"){return{serviceTemplateId:this.templateId}}var i=this.pagination,n=i.current,s=i.limit;var o={page:{limit:s}};if(a==="statis"){o.page.limit=1;var r=[];this.filterFields.forEach(function(e){r.push({field:e,operator:"equal",value:""});r.push({field:e,operator:"is_null"})});o.process_property_filter={condition:"OR",rules:r}}else{o.page.start=(n-1)*s;o.page.sort=this.filterFields.join(",");if(this.searchSelectValue.length){var l=[];var c=[];this.searchSelectValue.forEach(function(e){if(e.id==="missing"){e.values.forEach(function(e){var a=t.tableHead.find(function(t){return t.key===e.id});if(a){a.child.map(function(e){return e.prop}).forEach(function(e){l.push({field:e,operator:"equal",value:""});l.push({field:e,operator:"is_null"})})}})}else if(["bk_func_name","bk_process_name"].includes(e.id)){c.push({field:e.id,operator:"equal",value:e.values.map(function(e){return e.name}).join(",")})}});if(a==="load"){if(c.length){if(l.length){c.push({condition:"OR",rules:l})}o.process_property_filter={condition:"AND",rules:c}}else{o.process_property_filter={condition:"OR",rules:l}}}else{o.undoneRule=l;o.blurryRule=c}}}var d=this.selectedNode,p=d.bk_inst_id,u=d.bk_obj_id,h=d.topoType,f=d.service_instance_id;if(u){if(u==="set"){o.set={bk_set_ids:[p]}}else if(u==="module"){o.module={bk_module_ids:[p]}}}if(h&&h==="serviceInstance"){o.service_instance={ids:[f]}}return o},handleTargetSelected:function e(t){var a="template";var i={};if(this.isTemplateTab){this.selectedTemp=t;this.templateId=t.id;i.template=t.id}else{a="node";this.selectedNode=t;var n=t.topoParent,s=t.bk_inst_id,o=t.topoType,r=t.service_instance_id;var l=o;var c=s;l=t.bk_obj_id||o;if(o==="serviceInstance"){l="module";c="".concat(n.bk_inst_id,"-").concat(r)}i.node="".concat(l,"-").concat(c)}this.$router.replace({name:"process-attr",params:{type:a},query:i})},handleTabChange:function e(t){this.tabActive=t;this.selections=[];this.searchSelectValue=[];var a={};if(this.isTemplateTab){this.templateId=this.templateList.length?this.templateList[0].id:null;if(this.templateId){a.template=this.templateId}this.setNodesExpanded(this.formatTree)}this.$store.commit("routeProcessAttr",{params:{type:this.tabActive},query:a})},checkServeTemplate:function e(){var t=this;return u()(d.a.mark(function e(){var a,i,n,s;return d.a.wrap(function e(o){while(1){switch(o.prev=o.next){case 0:a=false;o.prev=1;i=t.isTemplateTab?!!t.templateId:t.selectedNode.topoType==="serviceTemplate";n=t.isTemplateTab?t.templateId:t.selectedNode.service_template_id;if(!(i&&n)){o.next=9;break}o.next=7;return t.ajaxGetCheckServiceTemplate({service_template_id:n});case 7:s=o.sent;if(s.result){a=s.data}case 9:o.next=14;break;case 11:o.prev=11;o.t0=o["catch"](1);console.warn(o.t0);case 14:o.prev=14;t.showSyncTip=a;return o.finish(14);case 17:case"end":return o.stop()}}},e,null,[[1,11,14,17]])}))()},batchCheckServeTemplate:function e(){var t=this;return u()(d.a.mark(function e(){var a,i;return d.a.wrap(function e(n){while(1){switch(n.prev=n.next){case 0:n.next=2;return t.ajaxGetBatchCheckServiceTemplate();case 2:a=n.sent;if(a.result&&a.data&&a.data.length){i={};a.data.reduce(function(e,t){f()(e,t);return e},i);Object.keys(i).forEach(function(e){var a=t.templateList.find(function(t){return"".concat(t.id)==="".concat(e)});if(a){a.showSync=i[e]}})}case 4:case"end":return n.stop()}}},e)}))()},handleSearchSelectChange:function e(){this.handlePageChange({page:1})},handleCellEdit:function e(t){var a=this;var i=t.row,n=t.prop,s=t.value;return u()(d.a.mark(function e(){var t,o,r,l,c;return d.a.wrap(function e(d){while(1){switch(d.prev=d.next){case 0:d.prev=0;t=[];a.tableHead.forEach(function(e){t=t.concat(e.child.map(function(e){return e.prop}))});o=["selection","topoPath"];r=["create_time","last_time","bind_info","auto_start","bk_process_id","bk_biz_id","bk_supplier_account"];t=t.concat(r);l={};t.reduce(function(e,t){if(!o.includes(t)){e[t]=i[t]}return e},l);d.next=10;return a.$store.dispatch("process/".concat(a.isTemplateTab?"ajaxUpdateProcessTemplate":"ajaxUpdateProcessInstance"),{data:{process_template_id:a.isTemplateTab?i.process_template_id:"",process_property:f()(l,v()({},n,s))}});case 10:c=d.sent;if(c.result){i[n]=s;if(a.isTemplateTab){a.showSyncTip=true;a.setTemplateServeSync()}a.setHeadUndoneStatus(a.tableData);a.$bkMessage({message:a.$t("编辑成功"),theme:"success"})}d.next=17;break;case 14:d.prev=14;d.t0=d["catch"](0);console.warn(d.t0);case 17:case"end":return d.stop()}}},e,null,[[0,14]])}))()},handleFiltersChange:function e(){var t=this.searchSelectData.find(function(e){return e.id==="missing"});if(t){this.searchSelectValue.splice(0,this.searchSelectValue.length,{id:t.id,multiable:t.multiable,name:t.name,values:t.children.map(function(e){return Ie({},e)})});this.handlePageChange({page:1})}},handlePageChange:function e(t){var a=t.page,i=t.limit;f()(this.pagination,{current:a||1,limit:i});if(this.isTemplateTab){this.tableData=this.forntfilterData()}else{this.loadTableData()}},handleTableSelected:function e(t){this.selections=t},handSubHeadFilter:function e(t){var a=t.parent;this.searchSelectValue.splice(0,this.searchSelectValue.length,{id:"missing",multiable:true,name:this.$t("配置缺失"),values:[{id:a.key,name:a.label}]});this.handlePageChange({page:1})},initTableHead:function e(){var t=this;var a=[];this.tableHead.forEach(function(e,i){e.isExpand=!e.isExpandable||i<=1;if(e.isExpandable){a=a.concat(e.child.map(function(e){return e.prop}))}e.child.forEach(function(e){e.editAble=!t.notEditable.includes(e.prop)})});this.filterFields=a;this.setTableHead()},handleDrag:function e(t){var a=t.x;if(this.showLeftTopo){if(this.leftWidth+a<230){this.leftWidth=230}else if(this.leftWidth+a>630){this.leftWidth=630}else{this.leftWidth=this.leftWidth+a}}},setHeadUndoneStatus:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var a=t.length;this.tableHead.forEach(function(e){if(e.isExpandable){var i=false;if(a){t.forEach(function(t){if(e.child.some(function(e){return!t[e.prop]&&t[e.prop]!==0})){i=true}})}e.hasUndone=i}})},setRowTopoPath:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var a=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var i=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};var n=t.bk_set_name,s=n===void 0?"":n;var o=a.bk_module_name,r=o===void 0?"":o;var l=i.name,c=l===void 0?"":l;var d=[s,r,c].filter(function(e){return!!e});return d.join("/")},setTableHead:function e(){var t=this.type==="template";this.tableHead[0].width=t?120:190;this.tableHead[0].child[0].width=t?120:190;var a=this.tableHead[1].child[1].prop;if(t&&a==="topoPath"){this.tableHead[1].child.splice(1,1)}if(!t&&a!=="topoPath"){this.tableHead[1].child.splice(1,0,{label:this.$t("所属拓扑"),prop:"topoPath",fixed:false,slotNameStr:"topo",minWidth:200,showOverflowTooltip:true})}},goSyncTemplate:function e(){var t=window.PROJECT_CONFIG.CMDB_URL;var a=this.$store.state.bizId;var i=this.isTemplateTab?this.selectedTemp.id:this.selectedNode.service_template_id;window.open("".concat(t,"/#/business/").concat(a,"/service/operational/template/").concat(i,"?tab=instance"))},forntfilterData:function e(){var t=o()(this.sourceTableData);var a=this.getParams("front"),i=a.page,n=a.undoneRule,s=a.blurryRule;if(s&&s.length){t=t.filter(function(e){return s.every(function(t){return e[t.field].includes(t.value)})})}if(n&&n.length){t=t.filter(function(e){return n.some(function(t){return!e[t.field]})})}t=t.slice(i.start,i.start+i.limit);return t},handleUpdateTree:function e(t){this.formatTree=t},setTemplateServeSync:function e(t){var a=t||this.templateId;var i=this.templateList.find(function(e){return e.id===a});if(i){i.sync=true}},setNodesExpanded:function e(t){var a=this;t.forEach(function(e){e.topoExpand=false;if(e.child&&e.child.length){a.setNodesExpanded(e.child)}})},handleEidtDisabled:function e(){this.$store.commit("routeProcessAttr",{params:{type:"template"},query:{template:this.selectedNode?this.selectedNode.service_template_id:null}})},handleEmptyLink:function e(){var t="".concat(window.PROJECT_CONFIG.CMDB_URL,"/#/business/").concat(this.$store.state.bizId,"/service/operational/template?tab=config");window.open(t,"_blank")}})};var Ne=Ee;var Se=a(757);var Le=Object(C["a"])(Ne,i,n,false,null,"6be244e0",null);var je=t["default"]=Le.exports},531:function(e,t,a){},532:function(e,t,a){},533:function(e,t,a){},534:function(e,t,a){},535:function(e,t,a){},537:function(e,t,a){},538:function(e,t,a){},747:function(e,t,a){"use strict";var i=a(531);var n=a.n(i);var s=n.a},748:function(e,t,a){"use strict";var i=a(532);var n=a.n(i);var s=n.a},749:function(e,t,a){"use strict";var i=a(533);var n=a.n(i);var s=n.a},750:function(e,t,a){"use strict";var i=a(534);var n=a.n(i);var s=n.a},751:function(e,t){e.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDIyLjEuMCwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPgo8c3ZnIHZlcnNpb249IjEuMSIgaWQ9IuWbvuWxgl8xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB4PSIwcHgiIHk9IjBweCIKCSB2aWV3Qm94PSIwIDAgMTAyNCAxMDI0IiBzdHlsZT0iZW5hYmxlLWJhY2tncm91bmQ6bmV3IDAgMCAxMDI0IDEwMjQ7IiB4bWw6c3BhY2U9InByZXNlcnZlIj4KPHN0eWxlIHR5cGU9InRleHQvY3NzIj4KCS5zdDB7ZmlsbDojNjJEMThBO30KCS5zdDF7ZmlsbDojM0ZDMDZEO30KCS5zdDJ7ZmlsbDojRTVGNkVBO30KPC9zdHlsZT4KPHBhdGggY2xhc3M9InN0MCIgZD0iTTUxMiwxMDI0QzIyNy42LDEwMjQsMCw3OTYuNCwwLDUxMlMyMjcuNiwwLDUxMiwwczUxMiwyMjcuNiw1MTIsNTEyUzc5Ni40LDEwMjQsNTEyLDEwMjR6IE01MTIsNTYuOQoJQzI2MS43LDU2LjksNTYuOSwyNjEuNyw1Ni45LDUxMlMyNjEuNyw5NjcuMSw1MTIsOTY3LjFTOTY3LjEsNzYyLjMsOTY3LjEsNTEyUzc2Mi4zLDU2LjksNTEyLDU2Ljl6Ii8+CjxwYXRoIGNsYXNzPSJzdDEiIGQ9Ik03MjguMiwzMzUuNmw1MS4yLDUxLjJMNDQzLjcsNzI4LjJMMjQ0LjYsNTI5LjFsNTEuMi01MS4ybDE0Ny45LDE0Mi4yTDcyOC4yLDMzNS42eiIvPgo8cGF0aCBjbGFzcz0ic3QyIiBkPSJNNTEyLjEsNTdDMjYwLjgsNTYuOSw1NywyNjAuNiw1Ni45LDUxMmMwLDI1MS40LDIwMy44LDQ1NS4xLDQ1NS4xLDQ1NS4xUzk2Ny4xLDc2My40LDk2Ny4xLDUxMgoJQzk2NywyNjAuNyw3NjMuNCw1Ny4xLDUxMi4xLDU3eiBNNDQzLjcsNzI4LjJMMjQ0LjYsNTI5LjFsNTEuMi01MS4ybDE0Ny45LDE0Mi4ybDI4NC40LTI4NC40bDUxLjIsNTEuMkw0NDMuNyw3MjguMnoiLz4KPC9zdmc+Cg=="},752:function(e,t){e.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDIyLjEuMCwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPgo8c3ZnIHZlcnNpb249IjEuMSIgaWQ9IuWbvuWxgl8xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB4PSIwcHgiIHk9IjBweCIKCSB2aWV3Qm94PSIwIDAgMTAyNCAxMDI0IiBzdHlsZT0iZW5hYmxlLWJhY2tncm91bmQ6bmV3IDAgMCAxMDI0IDEwMjQ7IiB4bWw6c3BhY2U9InByZXNlcnZlIj4KPHN0eWxlIHR5cGU9InRleHQvY3NzIj4KCS5zdDB7ZmlsbDojRkZCODQ4O30KCS5zdDF7ZmlsbDojRkZFOEMzO30KPC9zdHlsZT4KPHBhdGggY2xhc3M9InN0MCIgZD0iTTUxMiwwQzIyNy42LDAsMCwyMjcuNiwwLDUxMnMyMjcuNiw1MTIsNTEyLDUxMnM1MTItMjI3LjYsNTEyLTUxMlM3OTYuNCwwLDUxMiwweiBNNTEyLDk2Ny4xCglDMjYxLjcsOTY3LjEsNTYuOSw3NjIuMyw1Ni45LDUxMlMyNjEuNyw1Ni45LDUxMiw1Ni45VjUxMmg0NTUuMUM5NjcuMSw3NjIuMyw3NjIuMyw5NjcuMSw1MTIsOTY3LjF6Ii8+CjxwYXRoIGNsYXNzPSJzdDEiIGQ9Ik01MTIsNTdjLTMzLjYsMC02Ni40LDMuNi05Ny45LDEwLjZDMjE1LjksMTExLjUsNjUuMywyODUuNSw1Ny4yLDQ5NC40Yy0wLjIsNS44LTAuMywxMS43LTAuMywxNy42CgljMCwyNTAuMywyMDQuOCw0NTUuMSw0NTUuMSw0NTUuMVM5NjcuMSw3NjIuMyw5NjcuMSw1MTJINTEyVjU3eiIvPgo8L3N2Zz4K"},753:function(e,t,a){"use strict";var i=a(535);var n=a.n(i);var s=n.a},756:function(e,t,a){"use strict";var i=a(537);var n=a.n(i);var s=n.a},757:function(e,t,a){"use strict";var i=a(538);var n=a.n(i);var s=n.a}}]);