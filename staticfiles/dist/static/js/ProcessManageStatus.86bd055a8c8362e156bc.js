(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[13],{219:function(e,t,a){"use strict";a.r(t);var s=function(){var e=this;var t=e.$createElement;var a=e._self._c||t;return a("div",{directives:[{name:"test",rawName:"v-test",value:"processStatus",expression:"'processStatus'"},{name:"bkloading",rawName:"v-bkloading",value:{isLoading:e.checkeStatus==="loading"&&e.isDataLoading},expression:"{ isLoading: checkeStatus === 'loading' && isDataLoading }"}],staticClass:"process-status"},[e.showEmptyProcess?a("EmptyProcess",{attrs:{completed:e.checkeStatus==="completed"}}):e.showNormalProcess?a("section",[a("div",{staticClass:"process-status-title"},[e._v(e._s(e.$t("进程管理")))]),e._v(" "),a("ButtonGrounp",{attrs:{"is-selected":Boolean(e.selectLength),"is-btn-loading":e.isBtnLoading,"job-action":e.jobAction,"is-data-loading":e.isDataLoading,"is-synchronous-loading":e.isSynchronousLoading,"is-allow-issued":e.isAllowIssued,"is-allow-start":e.isAllowStart,"is-allow-stop":e.isAllowStop,"is-selected-all-pages":e.isSelectedAllPages},on:{operateProcess:e.operateProcess,operateConfigDistribute:e.operateConfigDistribute,synchronousProcess:e.synchronousProcess}}),e._v(" "),a("div",{staticClass:"search-content"},[a("SelectInstance",{ref:"selectInstanceRef",attrs:{"show-button":false},on:{valueChange:e.valueChange}}),e._v(" "),a("div",{staticClass:"search-select-input-container"},[a("bk-search-select",{directives:[{name:"test",rawName:"v-test.common",value:"searchSelect",expression:"'searchSelect'",modifiers:{common:true}}],ref:"searchSelect",attrs:{placeholder:e.$t("内网IP、云区域"),"show-condition":false,data:e.searchSelectData},on:{"show-menu":e.handleSearchSelectShowMenu,change:e.handleSearchSelectChange},nativeOn:{"!paste":function(t){t.preventDefault();return e.handlePaste(t)}},model:{value:e.searchSelectValue,callback:function(t){e.searchSelectValue=t},expression:"searchSelectValue"}})],1)],1),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:e.isSelectedAllPages,expression:"isSelectedAllPages"}],staticClass:"selected-all-pages"},[e._v("\n      "+e._s(e.$t("已选"))+"\n      "),a("span",{staticClass:"count"},[e._v(e._s(e.selectLength))]),e._v("\n      "+e._s(e.$t("条，跨页全选暂不支持反选，"))+"\n      "),a("span",{staticClass:"button-text",on:{click:e.handleClearSelection}},[e._v(e._s(e.$t("取消")))])]),e._v(" "),a("TableContent",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:e.isDataLoading},expression:"{ isLoading: isDataLoading }"}],ref:"tableContent",attrs:{"table-data":e.tableData,pagination:e.pagination,"job-action":e.jobAction,"filter-data":e.filterData,"search-select-data":e.filterData,"search-select-value":e.searchSelectValue,ordering:e.ordering},on:{handleSortChange:e.handleSortChange,handleFilterHeaderReset:e.handleFilterHeaderReset,handleFilterHeaderConfirm:e.handleFilterHeaderConfirm,operateProcess:e.operateProcess,handleRowCheck:e.handleRowCheck,selectedAllPages:e.onSelectedAllPages,handlePageLimitChange:e.handlePageLimitChange,handlePageChange:e.handlePageChange,showSideSlider:e.showSideSlider}}),e._v(" "),e.isShow?a("ConfigDistribute",{attrs:{"is-dropdown-mode":e.isDropdownMode,"selected-scope":e.selectedScope,"process-detail":e.processDetail,"title-name":e.$t("配置下发")},on:{onConfigDistribute:e.onConfigDistribute,closeSideSlider:e.closeSideSlider}}):e._e(),e._v(" "),a("bk-dialog",{attrs:{"ext-cls":"king-dialog","render-directive":"if",width:"450","mask-close":false,title:e.dialogInfo.title+e.$t("进程")},on:{confirm:e.handleDialogConFirm,cancel:e.handleDialogCancel},model:{value:e.dialogInfo.visible,callback:function(t){e.$set(e.dialogInfo,"visible",t)},expression:"dialogInfo.visible"}},[a("div",{staticClass:"body-prompt"},[e._v("\n        "+e._s(e.$t("确定要"))+"\n        "),a("span",[e._v(e._s(e.dialogInfo.title))]),e._v("\n        "+e._s(e.$t("所选进程？"))+"\n      ")])])],1):e._e()],1)};var n=[];var i=a(13);var r=a.n(i);var o=a(11);var c=a.n(o);var l=a(37);var d=a.n(l);var u=a(3);var f=a.n(u);var h=a(4);var p=a.n(h);var v=a(7);var g=a.n(v);var m=function(){var e=this;var t=e.$createElement;var a=e._self._c||t;return a("div",{staticClass:"bk-custom-table"},[a("bk-table",{ref:"statusTable",attrs:{data:e.tableData,size:e.setting.size,"max-height":e.$store.state.pageHeight-(e.isSelectedAllPages?271:235),"row-key":"bk_process_id","expand-row-keys":e.expandRow,pagination:e.pagination},on:{"sort-change":e.handleSortChange,"row-click":e.toggleExpansion,"page-change":e.handlePageChange,"page-limit-change":e.handlePageLimitChange}},[a("bk-table-column",{attrs:{type:"expand",width:"30","before-expand-change":e.onBeforeExpandChange},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.row;return[s.proc_inst_infos.length?a("div",{staticClass:"process-status"},e._l(s.proc_inst_infos,function(t,s){return a("div",{key:t.id,staticClass:"col-status-item"},[a("div",{staticClass:"item-instance-text"},[e._v(e._s(e.$t("实例")+(s+1)))]),e._v(" "),a("div",{staticClass:"item-template-name"},[a("bk-popover",{attrs:{content:e.$t("主机下唯一标识")}},[a("span",[e._v(e._s("LocalInstID："))])]),e._v(" "),a("div",{directives:[{name:"bk-overflow-tips",rawName:"v-bk-overflow-tips"}]},[e._v(e._s(t.local_inst_id))])],1),e._v(" "),a("div",{staticClass:"item-file-name"},[a("bk-popover",{attrs:{content:e.$t("模块下唯一标识")}},[a("span",[e._v(e._s("InstID："))])]),e._v(" "),a("div",{directives:[{name:"bk-overflow-tips",rawName:"v-bk-overflow-tips"}]},[e._v(e._s(t.inst_id))])],1),e._v(" "),a("div",{staticClass:"item-status"},[e._v("\n              "+e._s(e.$t("状态")+"：")+"\n              "),t.process_status===0?a("StatusView",{attrs:{type:"origin","is-solid":true,text:e.$t("未运行")}}):t.process_status===1?a("StatusView",{attrs:{type:"success","is-solid":true,text:e.$t("运行中")}}):t.process_status===2?a("StatusView",{attrs:{type:"failed","is-solid":true,text:e.$t("未运行")}}):e._e()],1)])}),0):a("div",{staticClass:"process-status"},[a("span",{staticClass:"no-other-instance"},[e._v(e._s(e.$t("暂无其他实例")))])])]}}])}),e._v(" "),a("bk-table-column",{key:"selection",attrs:{width:"65",resizable:false,"render-header":e.renderSelectionHeader},scopedSlots:e._u([{key:"default",fn:function(t){return a("div",{on:{click:function(e){e.stopPropagation()}}},[a("bk-checkbox",{directives:[{name:"test",rawName:"v-test.common",value:"rowSelect",expression:"'rowSelect'",modifiers:{common:true}}],attrs:{value:t.row.isSelect,disabled:t.row.disable},on:{change:function(a){e.handleRowCheck(t.row)}}})],1)}}])}),e._v(" "),e._l(e.setting.selectedFields,function(t){return[!["process_status","is_auto","bk_process_id"].includes(t.id)?a("bk-table-column",{key:t.id,attrs:{label:t.label,prop:t.id,sortable:t.sortable?"custom":""},scopedSlots:e._u([{key:"default",fn:function(s){var n=s.row;return a("div",{directives:[{name:"bk-overflow-tips",rawName:"v-bk-overflow-tips"}]},[a("span",{attrs:{title:n[t.id]}},[e._v(e._s(n[t.id]||"--"))])])}}])}):e._e(),e._v(" "),t.id==="bk_process_id"?a("bk-table-column",{key:t.id,attrs:{label:t.label,prop:t.id,sortable:"custom","render-header":e.renderProcessHeader},scopedSlots:e._u([{key:"default",fn:function(s){var n=s.row;return[a("span",{attrs:{title:n[t.id]}},[e._v(e._s(n[t.id]||"--"))])]}}])}):e._e(),e._v(" "),t.id==="process_status"?a("bk-table-column",{key:t.id,attrs:{label:t.label,prop:t.id,"render-header":e.renderFilterHeader},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.row;return[s.process_status===0?a("StatusView",{attrs:{type:"origin","is-solid":true,text:e.$t("未运行")}}):s.process_status===1?a("StatusView",{attrs:{type:"success","is-solid":true,text:e.$t("运行中")}}):s.process_status===2?a("StatusView",{attrs:{type:"failed","is-solid":true,text:e.$t("未运行")}}):e._e()]}}])}):e._e(),e._v(" "),t.id==="is_auto"?a("bk-table-column",{key:t.id,attrs:{label:t.label,prop:t.id,"render-header":e.renderFilterHeader},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.row;return[a("span",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips",value:{content:e.$t("进程处于未托管状态如遇异常退出不会被自动拉起"),disabled:s.process_status!==1||!!s.is_auto},expression:"{\n              content: $t('进程处于未托管状态如遇异常退出不会被自动拉起'),\n              disabled: row.process_status !== 1 || !!row.is_auto\n            }"}],class:["hosting-status",s.process_status===1?s.is_auto?"hosting":"fail":"unmanaged"]},[e._v("\n            "+e._s(s.is_auto?e.$t("托管中"):e.$t("未托管"))+"\n          ")])]}}])}):e._e()]}),e._v(" "),a("bk-table-column",{staticClass:"operat-headr",attrs:{label:e.$t("操作"),width:"170"},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.row;return a("div",{staticClass:"table-operation-container",on:{click:function(e){e.stopPropagation()}}},[a("AuthTag",{attrs:{action:"manage_process",authorized:e.authMap.manage_process},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.disabled;return[a("bk-popover",{attrs:{disabled:s.process_status!==1,content:e.$t("进程运行中，无需启动")}},[a("bk-button",{directives:[{name:"test",rawName:"v-test",value:"start",expression:"'start'"}],staticStyle:{"margin-right":"12px"},attrs:{disabled:n||s.process_status===1,theme:"primary",text:""},on:{click:function(t){e.operateProcess("start",s.bk_process_id)}}},[e._v("\n                "+e._s(e.$t("启动"))+"\n              ")])],1),e._v(" "),a("bk-popover",{attrs:{disabled:s.process_status!==2,content:e.$t("进程未运行")}},[a("bk-button",{directives:[{name:"test",rawName:"v-test",value:"stop",expression:"'stop'"}],staticStyle:{"margin-right":"12px"},attrs:{disabled:n||s.process_status===2,theme:"primary",text:""},on:{click:function(t){e.operateProcess("stop",s.bk_process_id)}}},[e._v("\n                "+e._s(e.$t("停止"))+"\n              ")])],1)]}}])}),e._v(" "),a("AuthTag",{attrs:{action:"operate_config",authorized:e.authMap.operate_config},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.disabled;return[a("bk-popover",{attrs:{disabled:Boolean(s.templateCount),content:e.$t("没有绑定配置文件，无法进行配置下发")}},[a("bk-button",{directives:[{name:"test",rawName:"v-test",value:"release",expression:"'release'"}],attrs:{disabled:n||!Boolean(s.templateCount),theme:"primary",text:""},on:{click:function(t){e.operateConfigDistribute(s)}}},[e._v("\n                "+e._s(e.$t("配置下发"))+"\n              ")])],1)]}}])}),e._v(" "),a("bk-popover",{attrs:{placement:"bottom-start",theme:"dot-menu light",trigger:"click",arrow:false,distance:0}},[a("div",{staticClass:"dot-menu-trigger"},[a("span",{directives:[{name:"test",rawName:"v-test.common",value:"more",expression:"'more'",modifiers:{common:true}}],staticClass:"bk-icon icon-more"})]),e._v(" "),a("ul",{staticClass:"dot-menu-list",attrs:{slot:"content"},slot:"content"},[e._l(e.jobAction.slice(2),function(t){return a("AuthTag",{directives:[{name:"test",rawName:"v-test.common",value:"moreItem",expression:"'moreItem'",modifiers:{common:true}}],key:t.type,staticClass:"dot-menu-item",attrs:{tag:"li","test-key":t.type,action:"manage_process",authorized:e.authMap.manage_process},on:{click:function(a){e.operateProcess(t.type,s.bk_process_id)}}},[e._v("\n              "+e._s(t.actionName)+"\n            ")])}),e._v(" "),a("li",{staticClass:"dot-menu-item",on:{click:function(t){e.onCheckProcessConfig(s)}}},[e._v(e._s(e.$t("查看进程配置")))])],2)])],1)}}])}),e._v(" "),a("bk-table-column",{attrs:{type:"setting"}},[a("bk-table-setting-content",{attrs:{size:e.setting.size,fields:e.setting.fields,selected:e.setting.selectedFields},on:{"setting-change":e.handleSettingChange}})],1)],2)],1)};var b=[];var _=a(8);var k=function(){var e=this;var t=e.$createElement;var a=e._self._c||t;return a("div",{staticClass:"check"},[e.loading?a("bk-button",{attrs:{"ext-cls":"check-btn-loading",size:"small",loading:e.loading}}):[a("bk-checkbox",{class:{"all-check":e.checkType.active==="all"},attrs:{value:e.checkValue,indeterminate:e.halfCheck,disabled:!e.disabled},on:{change:e.handleCheckChange}})]],2)};var S=[];var w={name:"ColumnCheck",props:{indeterminate:{type:Boolean,default:false},isAllChecked:{type:Boolean,default:false},disabled:{type:Boolean,default:false},loading:{type:Boolean,default:false}},data:function e(){return{checkValue:false,checkType:{active:"current",list:[{id:"current",name:this.$t("本页全选")},{id:"all",name:this.$t("跨页全选")}]},isDropDownShow:false}},computed:{halfCheck:function e(){return this.indeterminate&&!this.isAllChecked}},watch:{isAllChecked:function e(t){this.checkValue=t}},methods:{handleCheckAll:function e(t){this.checkType.active=t;this.$emit("change",true,t);this.$refs.popover&&this.$refs.popover.instance.hide()},handleCheckChange:function e(t){this.checkValue=t;this.$emit("change",this.checkValue)},handleOnShow:function e(){this.isDropDownShow=true},handleOnHide:function e(){this.isDropDownShow=false}}};var C=w;var y=a(655);var $=a(10);var D=Object($["a"])(C,k,S,false,null,"a5c5dffe",null);var x=D.exports;var L=a(648);var P=function(){var e=this;var t=e.$createElement;var a=e._self._c||t;return a("section",[a("div",{staticClass:"process-header"},[a("bk-popover",{attrs:{content:e.tips,"max-width":200}},[a("span",[e._v(e._s(e.name))])])],1)])};var I=[];var A={name:"ProcessHeader",props:{name:{type:String,default:""},tips:{type:String,default:""}}};var O=A;var j=a(657);var E=Object($["a"])(O,P,I,false,null,"84f8ecb8",null);var N=E.exports;function M(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a.push.apply(a,s)}return a}function F(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?M(Object(a),!0).forEach(function(t){p()(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):M(Object(a)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}var R={props:{pagination:{type:Object,default:function e(){return{}}},tableData:{type:Array,default:function e(){return[]}},jobAction:{type:Array,default:function e(){return[]}},filterData:{type:Array,default:function e(){return[]}},searchSelectData:{type:Array,default:function e(){return[]}},searchSelectValue:{type:Array,default:function e(){return[]}},ordering:{type:String,default:""}},data:function e(){var t=[{id:"bk_set_name",label:this.$t("集群"),sortable:true},{id:"bk_module_name",label:this.$t("模块"),sortable:true},{id:"bk_service_name",label:this.$t("服务实例"),sortable:true},{id:"bk_process_name",label:this.$t("进程别名"),disabled:true,sortable:true},{id:"bk_process_id",label:"process_id",sortable:true},{id:"bk_host_innerip",label:this.$t("内网IP"),sortable:true},{id:"process_status",label:this.$t("进程状态"),disabled:true,sortable:true},{id:"is_auto",label:this.$t("托管状态"),sortable:true},{id:"bk_cloud_name",label:this.$t("云区域"),sortable:true}];return{isDataLoading:false,fields:t,setting:{fields:t,selectedFields:t.slice(0,7),size:"small"},isSelectedAllPages:false,checkLoading:false,expandRow:[]}},computed:F(F({},Object(_["d"])(["authMap"])),{},{indeterminate:function e(){if(this.isSelectedAllPages){this.tableData.forEach(function(e){e.isSelect=true;e.disable=true});return false}var t=0;this.tableData.forEach(function(e){if(e.isSelect){t+=1}});if(t){return!(t===this.tableData.length)}return false},isAllChecked:function e(){if(this.isSelectedAllPages){return true}var t=0;this.tableData.forEach(function(e){if(e.isSelect){t+=1}});if(t){return t===this.tableData.length}return false},headerData:function e(){return this.filterData.reduce(function(e,t){if(t.children&&t.children.length){e[t.id]=t.children}return e},{})}}),mounted:function e(){this.getFields()},methods:{getFields:function e(){var t=window.localStorage.getItem("settingCache");if(t){var a=JSON.parse(t),s=a.fields,n=a.size;var i=s;this.setting.size=n;this.setting.selectedFields=this.fields.slice(0).filter(function(e){return i.includes(e.id)})}},handleSortChange:function e(t){var a=t.prop,s=t.order;this.$emit("handleSortChange",{prop:a,order:s})},renderFilterHeader:function e(t,a){var s=this;var n=this.headerData[a.column.property]||[];this.setChecked(n);var i=a.column.label||"";var r=a.column.property||"";return t(L["a"],{attrs:{name:i,property:r,filterList:n},on:{confirm:function e(t,a){return s.handleFilterHeaderConfirm(t,a)},reset:function e(t){return s.handleFilterHeaderReset(t)}}})},renderProcessHeader:function e(t,a){var s=a.column.label||"";var n=this.$t("配置平台统一为每一个进程实例单独分配了全局唯一的ID，此ID非旧版“实例ID”且不可更改");return t(N,{attrs:{name:s,tips:n}})},setChecked:function e(t){var a=this;t.forEach(function(e){if(!e.checked){e.checked=false}if(e.child&&e.child.length){a.setChecked(e.child)}})},handleFilterHeaderReset:function e(t){this.$emit("handleFilterHeaderReset",t)},handleFilterHeaderConfirm:function e(t,a){this.$emit("handleFilterHeaderConfirm",t,a)},renderSelectionHeader:function e(){var t=this;var a=this.$createElement;return a(x,{ref:"customSelectionHeader",attrs:{indeterminate:this.indeterminate,isAllChecked:this.isAllChecked,loading:this.checkLoading,disabled:Boolean(this.tableData.length)},on:{change:function e(a){return t.handleCheckAll(a)}}})},handleCheckAll:function e(t){var a=this;return g()(f.a.mark(function e(){return f.a.wrap(function e(s){while(1){switch(s.prev=s.next){case 0:a.tableData.forEach(function(e){e.isSelect=t;e.disable=t});a.isSelectedAllPages=t;a.$emit("selectedAllPages",t);case 3:case"end":return s.stop()}}},e)}))()},onClearSelectedData:function e(){this.tableData.forEach(function(e){e.isSelect=false;e.disable=false});this.isSelectedAllPages=false;this.$refs.customSelectionHeader.handleCheckChange()},handleRowCheck:function e(t){t.isSelect=!t.isSelect;this.$emit("handleRowCheck",t)},handleSettingChange:function e(t){var a=t.fields,s=t.size;this.setting.size=s;this.setting.selectedFields=a;var n=a.map(function(e){return e.id});window.localStorage.setItem("settingCache",JSON.stringify({fields:n,size:s}))},handlePageChange:function e(t){this.$emit("handlePageChange",t)},handlePageLimitChange:function e(t){this.$emit("handlePageLimitChange",t)},operateProcess:function e(t,a){this.$emit("operateProcess",t,a)},operateConfigDistribute:function e(t){this.$emit("showSideSlider",t)},onCheckProcessConfig:function e(t){var a=t.service_template_id;var s={};var n=a?"template":"node";if(a){s.template=a}else{s.node="module-".concat(t.bk_module_id)}this.$router.push({name:"process-attr",params:{type:n},query:s})},toggleExpansion:function e(t){if(this.expandRow.includes(t.bk_process_id)){this.expandRow=[]}else{this.expandRow=[t.bk_process_id]}},onBeforeExpandChange:function e(t){var a=t.row;this.toggleExpansion(a)}}};var V=R;var B=a(658);var T=Object($["a"])(V,m,b,false,null,"43d1a085",null);var H=T.exports;var z=function(){var e=this;var t=e.$createElement;var a=e._self._c||t;return a("bk-sideslider",{attrs:{title:e.titleName,"is-show":true,width:!e.isContrast?630:1197,"before-close":e.onCloseSidesLider,"quick-close":true}},[a("div",{staticClass:"from-area",attrs:{slot:"content"},slot:"content"},[a("div",{staticClass:"editor-header"},[a("div",{class:["common-form-item",{"default-width":!e.isContrast}]},[a("label",{staticClass:"required"},[e._v(e._s(e.$t("配置模板")))]),e._v(" "),a("bk-select",{directives:[{name:"test",rawName:"v-test",value:"tempSelect",expression:"'tempSelect'"}],attrs:{clearable:false,disabled:e.isBatch||e.isGenerateLoading},on:{change:e.handleSelectChange},model:{value:e.templateId,callback:function(t){e.templateId=t},expression:"templateId"}},e._l(e.templateList,function(e){return a("bk-option",{key:e.config_template_id,attrs:{id:e.config_template_id,name:e.showName}})}),1),e._v(" "),a("bk-button",{directives:[{name:"test",rawName:"v-test",value:"configGenerate",expression:"'configGenerate'"}],attrs:{loading:e.isGenerateLoading,diasbled:e.isReleaseLoading,theme:"primary"},on:{click:function(t){e.setSyncGenerateConfig(true)}}},[a("div",{staticClass:"generate-btn"},[a("i",{staticClass:"swither-icon gsekit-icon gsekit-icon-swither-small"}),e._v(" "),a("span",[e._v(e._s(e.$t("生成")))])])]),e._v(" "),!e.configInfo.is_latest?[a("span",{staticClass:"update-tip"},[e._v(e._s(e.$t("模版有更新，请重新生成")))]),e._v(" "),a("i",{staticClass:"new-generate-icon"})]:e._e()],2),e._v(" "),e.isContrast?a("div",{staticClass:"common-form-item expand-width"},[a("DiffNav",{staticClass:"diff-nav-container",attrs:{"diff-count":e.diffCount},on:{previous:e.jumpPreviousChange,next:e.jumpNextChange}})],1):e._e()]),e._v(" "),a("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:e.isDataLoading,opacity:.1},expression:"{ isLoading: isDataLoading, opacity: .1 }"}],staticClass:"editor-content"},[a("div",{staticClass:"editor-title"},[a("div",{class:["common-form-editor",{"default-width":!e.isContrast}]},[e.isContrast?a("div",{staticClass:"real-time"},[e._v(e._s(e.$t("实时")))]):e._e(),e._v(" "),a("div",{staticClass:"editor-info"},[a("div",[e._v(e._s(e.configInfo.file_name||"--"))]),e._v(" "),a("div",[e._v("\n              "+e._s(e.$t("生成时间"))+"\n              "),e.isContrast?[e._v("\n                "+e._s(e.releasedConfig.created_at?e.modifyFormatDate(e.releasedConfig.created_at):"--")+"\n              ")]:[e._v("\n                "+e._s(e.generatedConfig.created_at?e.modifyFormatDate(e.generatedConfig.created_at):"--")+"\n              ")]],2)])]),e._v(" "),e.isContrast?a("div",{staticClass:"common-form-editor"},[a("div",{staticClass:"pre-populated"},[e._v(e._s(e.$t("预生成")))]),e._v(" "),a("div",{staticClass:"editor-info"},[a("div",[e._v(e._s(e.configInfo.file_name||"--"))]),e._v(" "),a("div",[e._v("\n              "+e._s(e.$t("生成时间"))+"\n              "),e.isContrast?[e._v("\n                "+e._s(e.generatedConfig.created_at?e.modifyFormatDate(e.generatedConfig.created_at):"--")+"\n              ")]:[e._v("\n                "+e._s(e.releasedConfig.created_at?e.modifyFormatDate(e.releasedConfig.created_at):"--")+"\n              ")]],2)])]):e._e()]),e._v(" "),e.isContrast?a("DiffEditor",{ref:"diffEditorRef",staticStyle:{height:"calc(100% - 73px)"},attrs:{"old-data":e.releasedConfig,"new-data":e.generatedConfig,"diff-count":e.diffCount},on:{"update:diffCount":function(t){e.diffCount=t}}}):a("CodeEditor",{staticStyle:{height:"calc(100% - 73px)"},attrs:{content:e.generatedConfig.content,language:e.generatedConfig.language}})],1),e._v(" "),!e.isBatch?a("div",{staticClass:"king-btn-group"},[a("bk-popover",{attrs:{disabled:e.isDataLoading||Boolean(e.generatedConfig.created_at),content:e.$t("请重新生成")}},[a("bk-button",{directives:[{name:"test",rawName:"v-test",value:"configRelease",expression:"'configRelease'"}],attrs:{disabled:e.isDataLoading||!e.generatedConfig.created_at,loading:e.isReleaseLoading,theme:"primary"},on:{click:e.onConfigDistribute}},[e._v("\n          "+e._s(e.$t("配置下发"))+"\n        ")])],1),e._v(" "),a("bk-button",{directives:[{name:"test",rawName:"v-test",value:"configContrast",expression:"'configContrast'"}],class:{pressed:e.isContrast},attrs:{disabled:e.isDataLoading||!e.generatedConfig.content},on:{click:e.onConfigContrast}},[e._v("\n        "+e._s(e.$t("配置对比"))+"\n      ")]),e._v(" "),a("bk-button",{on:{click:e.onCancel}},[e._v("\n        "+e._s(e.$t("取消"))+"\n      ")])],1):e._e()])])};var G=[];var J=a(385);var q=a(387);var K=a(388);var U=a(19);var Z={components:{CodeEditor:J["a"],DiffEditor:q["a"],DiffNav:K["a"]},props:{processDetail:{type:Object,default:function e(){return{}}},selectedScope:{type:Object,default:function e(){return{}}},isDropdownMode:{type:Boolean,default:true},titleName:{type:String,default:""},isBatch:{type:Boolean,default:false}},data:function e(){return{modifyFormatDate:U["f"],templateList:[],configInfo:{},generatedConfig:{content:"",language:"",created_at:""},releasedConfig:{content:"",language:"",created_at:""},templateId:"",isContrast:false,isGenerateLoading:false,isDataLoading:false,isReleaseLoading:false,diffCount:0}},watch:{processDetail:{handler:function e(t){var a=this;this.templateList=t.config_templates.map(function(e){a.$set(e,"showName",e.template_name+a.$t("（")+e.file_name+a.$t("）"));return e});this.templateId=this.templateList[0].config_template_id;this.getConfigInfo()},immediate:true}},methods:{getConfigInfo:function e(){var t=this;return g()(f.a.mark(function e(){var a,s;return f.a.wrap(function e(n){while(1){switch(n.prev=n.next){case 0:n.prev=0;t.isDataLoading=true;n.next=4;return t.$store.dispatch("configInstance/ajaxGetLatestConfigInstance",{templateId:t.templateId,processId:t.processDetail.bk_process_id});case 4:a=n.sent;s=t.templateList.find(function(e){return e.config_template_id===t.templateId});t.configInfo=a.data||{};if(t.isContrast){t.isContrast=false;t.$nextTick(function(){t.isContrast=true})}t.configInfo.file_name=s.file_name;t.generatedConfig=t.configInfo.generated_config||{};t.releasedConfig=t.configInfo.released_config||{};if(!Object.keys(t.generatedConfig).length){t.setSyncGenerateConfig()}n.next=18;break;case 14:n.prev=14;n.t0=n["catch"](0);console.warn(n.t0);t.isDataLoading=false;case 18:n.prev=18;t.isDataLoading=false;t.isGenerateLoading=false;return n.finish(18);case 22:case"end":return n.stop()}}},e,null,[[0,14,18,22]])}))()},handleSelectChange:function e(t){this.templateId=t;this.isContrast=false;this.getConfigInfo()},onCloseSidesLider:function e(){this.$emit("closeSideSlider")},onConfigDistribute:function e(){var t=this;return g()(f.a.mark(function e(){var a;return f.a.wrap(function e(s){while(1){switch(s.prev=s.next){case 0:s.prev=0;t.isReleaseLoading=true;s.next=4;return t.$store.dispatch("configTemplate/ajaxSetReleaseConfig",{data:p()({config_template_id:t.templateId},t.isDropdownMode?"scope":"expression_scope",t.selectedScope)});case 4:a=s.sent;t.$store.commit("routeTaskHistoryDetail",a.data.job_id);s.next=12;break;case 8:s.prev=8;s.t0=s["catch"](0);console.warn(s.t0);t.isReleaseLoading=false;case 12:s.prev=12;t.isReleaseLoading=false;return s.finish(12);case 15:case"end":return s.stop()}}},e,null,[[0,8,12,15]])}))()},onConfigContrast:function e(){this.isContrast=!this.isContrast},onCancel:function e(){this.$emit("closeSideSlider")},setSyncGenerateConfig:function e(t){var a=this;return g()(f.a.mark(function e(){var s,n;return f.a.wrap(function e(i){while(1){switch(i.prev=i.next){case 0:i.prev=0;a.isDataLoading=true;a.isGenerateLoading=true;i.next=5;return a.$store.dispatch("configTemplate/ajaxSyncGenerateConfig",{data:{bk_process_id:a.processDetail.bk_process_id},templateId:a.templateId});case 5:s=i.sent;n=s.data[0]||{};if(!(n.status==="succeeded")){i.next=15;break}i.next=10;return a.getConfigInfo();case 10:if(t){i.next=12;break}return i.abrupt("return",true);case 12:a.$bkMessage({message:a.$t("配置生成成功"),theme:"success"});i.next=20;break;case 15:a.isDataLoading=false;a.isGenerateLoading=false;if(t){i.next=19;break}return i.abrupt("return",true);case 19:a.$bkMessage({message:a.$t("配置生成失败"),theme:"error"});case 20:i.next=27;break;case 22:i.prev=22;i.t0=i["catch"](0);console.warn(i.t0);a.isGenerateLoading=false;a.isDataLoading=false;case 27:case"end":return i.stop()}}},e,null,[[0,22]])}))()},jumpNextChange:function e(){this.$refs.diffEditorRef.diffNavigator.next()},jumpPreviousChange:function e(){this.$refs.diffEditorRef.diffNavigator.previous()}}};var Q=Z;var W=a(731);var X=Object($["a"])(Q,z,G,false,null,"0a016448",null);var Y=X.exports;var ee=a(572);var te=function(){var e=this;var t=e.$createElement;var a=e._self._c||t;return a("div",{staticClass:"button-content"},[a("AuthTag",{attrs:{action:"manage_process",authorized:e.authMap.manage_process},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.disabled;return[a("bk-popover",{attrs:{disabled:s||!e.isAllowStart,content:!e.isSelected?e.$t("请先选择进程"):e.$t("进程运行中，无需启动")}},[a("bk-button",{directives:[{name:"test",rawName:"v-test",value:"batchStart",expression:"'batchStart'"}],staticClass:"operate-btn",attrs:{disabled:s||e.isDataLoading||!e.isSelected||e.isAllowStart,theme:"primary",loading:e.isBtnLoading==="start"},on:{click:function(t){e.operateProcess("start")}}},[e._v("\n          "+e._s(e.$t("启动"))+"\n        ")])],1),e._v(" "),a("bk-popover",{attrs:{disabled:s||!e.isAllowStop,content:!e.isSelected?e.$t("请先选择进程"):e.$t("进程未运行")}},[a("bk-button",{directives:[{name:"test",rawName:"v-test",value:"batchStop",expression:"'batchStop'"}],staticClass:"operate-btn",attrs:{disabled:s||e.isDataLoading||!e.isSelected||e.isAllowStop,loading:e.isBtnLoading==="stop"},on:{click:function(t){e.operateProcess("stop")}}},[e._v("\n          "+e._s(e.$t("停止"))+"\n        ")])],1)]}}])}),e._v(" "),a("AuthTag",{attrs:{action:"operate_config",authorized:e.authMap.operate_config},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.disabled;return[a("bk-popover",{attrs:{disabled:s||!e.isAllowIssued,content:!e.isSelected?e.$t("请先选择进程"):e.$t("所选进程暂未关联配置文件，无法进行配置下发")}},[a("bk-button",{directives:[{name:"test",rawName:"v-test",value:"batchRelease",expression:"'batchRelease'"}],staticClass:"king-btn",attrs:{disabled:s||e.isDataLoading||!e.isSelected||e.isAllowIssued},on:{click:e.operateConfigDistribute}},[e._v("\n          "+e._s(e.$t("配置下发"))+"\n        ")])],1)]}}])}),e._v(" "),!e.authMap.manage_process?a("AuthTag",{attrs:{action:"manage_process",authorized:false}},[a("bk-button",{attrs:{disabled:"","icon-right":"icon-angle-down"}},[e._v("\n      "+e._s(e.$t("更多"))+"\n    ")])],1):a("bk-popover",{staticClass:"dot-menu",attrs:{placement:"bottom-start",disabled:!e.isSelected,theme:"dot-menu light",trigger:"click",arrow:false,distance:2}},[a("bk-button",{directives:[{name:"test",rawName:"v-test.common",value:"more",expression:"'more'",modifiers:{common:true}}],attrs:{"icon-right":"icon-angle-down",disabled:e.isDataLoading||!e.isSelected}},[e._v("\n      "+e._s(e.$t("更多"))+"\n    ")]),e._v(" "),a("ul",{staticClass:"dot-menu-list",attrs:{slot:"content"},slot:"content"},e._l(e.jobAction.slice(2),function(t){return a("li",{directives:[{name:"test",rawName:"v-test.common",value:"moreItem",expression:"'moreItem'",modifiers:{common:true}}],key:t.type,staticClass:"dot-menu-item",attrs:{"test-key":t.type},on:{click:function(a){e.operateProcess(t.type)}}},[e._v("\n        "+e._s(t.actionName)+"\n      ")])}),0)],1),e._v(" "),a("div",{staticClass:"synchronous-btn"},[a("bk-button",{directives:[{name:"test",rawName:"v-test",value:"syncStatus",expression:"'syncStatus'"}],attrs:{icon:"bk-icon icon-refresh",loading:e.isSynchronousLoading},on:{click:e.synchronousProcess}},[e._v("\n      "+e._s(e.$t("同步进程状态"))+"\n    ")]),e._v(" "),a("bk-popover",{ref:"synchronousPopover",class:{disabled:e.isDataLoading},attrs:{placement:"bottom-start",theme:"dot-menu light",disabled:e.isDataLoading,trigger:"click",arrow:false,distance:2}},[a("div",{staticClass:"icon-btn"},[a("i",{directives:[{name:"test",rawName:"v-test",value:"syncMore",expression:"'syncMore'"}],staticClass:"bk-icon icon-angle-down"})]),e._v(" "),a("ul",{staticClass:"dot-menu-list",attrs:{slot:"content"},slot:"content"},[a("li",{directives:[{name:"test",rawName:"v-test.common",value:"moreItem",expression:"'moreItem'",modifiers:{common:true}}],staticClass:"dot-menu-item",on:{click:e.switchSynchronousText}},[e._v("\n          "+e._s(e.$t("同步CMDB进程配置"))+"\n        ")])])])],1)],1)};var ae=[];function se(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a.push.apply(a,s)}return a}function ne(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?se(Object(a),!0).forEach(function(t){p()(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):se(Object(a)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}var ie={props:{isSelected:{type:Boolean,default:false},isBtnLoading:{type:String,default:""},isSynchronousLoading:{type:Boolean,default:false},jobAction:{type:Array,default:function e(){return[]}},isDataLoading:{type:Boolean,default:false},isAllowIssued:{type:Boolean,default:false},isSelectedAllPages:{type:Boolean,default:false},isAllowStart:{type:Boolean,default:false},isAllowStop:{type:Boolean,default:false}},computed:ne({},Object(_["d"])(["authMap"])),methods:{operateConfigDistribute:function e(){this.$emit("operateConfigDistribute")},operateProcess:function e(t){this.$emit("operateProcess",t)},synchronousProcess:function e(){this.$emit("synchronousProcess","status")},switchSynchronousText:function e(){this.$emit("synchronousProcess","config");this.$refs.synchronousPopover.hideHandler()}}};var re=ie;var oe=a(735);var ce=Object($["a"])(re,te,ae,false,null,"42d6ef93",null);var le=ce.exports;var de=a(641);function ue(e,t){var a=typeof Symbol!=="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!a){if(Array.isArray(e)||(a=fe(e))||t&&e&&typeof e.length==="number"){if(a)e=a;var s=0;var n=function e(){};return{s:n,n:function t(){if(s>=e.length)return{done:true};return{done:false,value:e[s++]}},e:function e(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i=true,r=false,o;return{s:function t(){a=a.call(e)},n:function e(){var t=a.next();i=t.done;return t},e:function e(t){r=true;o=t},f:function e(){try{if(!i&&a.return!=null)a.return()}finally{if(r)throw o}}}}function fe(e,t){if(!e)return;if(typeof e==="string")return he(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);if(a==="Object"&&e.constructor)a=e.constructor.name;if(a==="Map"||a==="Set")return Array.from(e);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return he(e,t)}function he(e,t){if(t==null||t>e.length)t=e.length;for(var a=0,s=new Array(t);a<t;a++){s[a]=e[a]}return s}function pe(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a.push.apply(a,s)}return a}function ve(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?pe(Object(a),!0).forEach(function(t){p()(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):pe(Object(a)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}var ge={name:"ProcessStatus",components:{TableContent:H,ConfigDistribute:Y,SelectInstance:ee["a"],ButtonGrounp:le,EmptyProcess:de["a"]},data:function e(){var t=[{type:"start",actionName:this.$t("启动")},{type:"stop",actionName:this.$t("停止")},{type:"restart",actionName:this.$t("重启")},{type:"reload",actionName:this.$t("重载")},{type:"force_stop",actionName:this.$t("强制停止")},{type:"set_auto",actionName:this.$t("托管")},{type:"unset_auto",actionName:this.$t("取消托管")}];return{checkeStatus:"loading",localEnv:"",checkedEnv:"",checkedEnvList:[],hasCheckedAsync:false,hasCheckedModelList:false,selectChecks:[],isShow:false,processDetail:{},isDataLoading:true,tableData:[],pagination:{current:1,count:0,limit:50},selectLength:0,isSelectedAllPages:false,isDropdownMode:true,selectedScope:{bk_set_ids:[],bk_module_ids:[],bk_service_ids:[],bk_process_names:[],bk_process_ids:[],bk_set_env:""},processIdList:[],isBtnLoading:"",filterData:[],searchSelectValue:[],searchSelectData:[],isMenuShow:false,ordering:"",isSynchronousLoading:false,jobAction:t,dialogInfo:{visible:false,rowId:null,operateType:"",title:""},prevListLength:0,isMatch:true}},computed:{showEmptyProcess:function e(){return["error","completed"].includes(this.checkeStatus)},showNormalProcess:function e(){return["unknow","normal"].includes(this.checkeStatus)},isAllowIssued:function e(){var t=this;var a=this.tableData.some(function(e){return t.processIdList.includes(e.bk_process_id)&&e.templateCount});return this.isSelectedAllPages?!this.isSelectedAllPages:!a},isAllowStart:function e(){var t=this;var a=this.tableData.some(function(e){return t.processIdList.includes(e.bk_process_id)&&e.process_status!==1});return this.isSelectedAllPages?!this.isSelectedAllPages:!a},isAllowStop:function e(){var t=this;var a=this.tableData.some(function(e){return t.processIdList.includes(e.bk_process_id)&&e.process_status!==2});return this.isSelectedAllPages?!this.isSelectedAllPages:!a}},watch:{showNormalProcess:function e(t){var a=this;if(t){var s=this.$route.query.expressionScope;if(s){this.$nextTick(function(){a.$refs.selectInstanceRef.setExpressionValue(JSON.parse(s))})}else{if(this.checkedEnv!=="3"){this.$nextTick(function(){a.$refs.selectInstanceRef.handleSetEnv(a.localEnv||a.checkedEnv)})}this.getTemplateList();if(this.showNormalProcess){this.getFilterCondition()}}}},tableData:{handler:function e(t){if(this.isSelectedAllPages){this.selectLength=this.pagination.count;return}var a=0;t.forEach(function(e){if(e.isSelect){a+=1}});this.selectLength=a},deep:true},searchSelectValue:{handler:function e(){if(this.checkeStatus==="normal"&&this.isMatch){this.handleSearchSelectFilter();this.handlePageChange(1)}},deep:true}},created:function e(){this.resetEnvList();this.checkProcessCount()},methods:{getTemplateList:function e(){var t=this;return g()(f.a.mark(function e(){var a,s,n;return f.a.wrap(function e(i){while(1){switch(i.prev=i.next){case 0:a=false;i.prev=1;t.isDataLoading=true;s=t.getSearchParams();i.next=6;return t.$store.dispatch("process/ajaxGetProcessStatusList",{data:ve(p()({page:t.pagination.current,pagesize:t.pagination.limit},t.isDropdownMode?"scope":"expression_scope",t.selectedScope),s)});case 6:n=i.sent;n.data.list.forEach(function(e){e.isSelect=false;e.disable=false;e.templateCount=e.config_templates.length});t.tableData=n.data.list;t.pagination.count=n.data.count;a=!!n.data.list.length;i.next=16;break;case 13:i.prev=13;i.t0=i["catch"](1);console.warn(i.t0);case 16:i.prev=16;if(t.checkeStatus==="loading"){t.checkeStatus=a?"normal":"completed"}t.isDataLoading=false;return i.finish(16);case 20:case"end":return i.stop()}}},e,null,[[1,13,16,20]])}))()},getFilterCondition:function e(){var t=this;return g()(f.a.mark(function e(){var a,s,n,i,r,o,c,l;return f.a.wrap(function e(u){while(1){switch(u.prev=u.next){case 0:u.next=2;return t.$store.dispatch("meta/ajaxGetStatusFilterCondition");case 2:a=u.sent;s=[];n=0,i=Object.entries(a.data);case 5:if(!(n<i.length)){u.next=21;break}r=d()(i[n],2),o=r[0],c=r[1];l={children:c,id:o.split("_choices")[0]};u.t0=o;u.next=u.t0==="process_status_choices"?11:u.t0==="is_auto_choices"?13:u.t0==="bk_cloud_id_choices"?15:17;break;case 11:l.name=t.$t("进程状态");return u.abrupt("break",17);case 13:l.name=t.$t("托管状态");return u.abrupt("break",17);case 15:l.multiable=true;l.name=t.$t("云区域");case 17:s.push(l);case 18:n++;u.next=5;break;case 21:s.push({name:"IP",id:"bk_host_innerip"});t.filterData=s;t.searchSelectData=s;case 24:case"end":return u.stop()}}},e)}))()},getSearchParams:function e(){var t={};var a=[];if(this.searchSelectValue.length){this.searchSelectValue.forEach(function(e){var s=["bk_cloud_id","bk_host_innerip"];var n=["process_status","is_auto"];if(s.includes(e.id)){t["".concat(e.id,"s")]=e.values.map(function(e){return e.id})}else if(n.includes(e.id)){t["".concat(e.id,"_list")]=e.values.map(function(e){return e.id})}else{a.push(e.id);t.searches=a}})}if(this.ordering){t.ordering=this.ordering}return t},handleSortChange:function e(t){var a=t.prop,s=t.order;if(s==="ascending"){this.ordering=a}else if(s==="descending"){this.ordering="-".concat(a)}else{this.ordering=""}this.getTemplateList()},handlePageLimitChange:function e(t){this.pagination.current=1;this.pagination.limit=t;this.getTemplateList()},handlePageChange:function e(t){this.pagination.current=t;this.getTemplateList()},valueChange:function e(t,a){this.selectedScope=JSON.parse(JSON.stringify(a));this.isDropdownMode=t;this.pagination.current=1;this.getTemplateList()},onSelectedAllPages:function e(t){this.isSelectedAllPages=t;this.processIdList=[]},handleRowCheck:function e(){var t=[];this.tableData.forEach(function(e){if(e.isSelect){t.push(e.bk_process_id)}});this.processIdList=t},handleClearSelection:function e(){this.$refs.tableContent.onClearSelectedData()},operateProcess:function e(t,a){this.dialogInfo={title:this.jobAction.find(function(e){return t===e.type}).actionName,visible:true,rowId:a,operateType:t}},handleDialogConFirm:function e(){var t=this;return g()(f.a.mark(function e(){var a,s,n,i,o,l,d;return f.a.wrap(function e(u){while(1){switch(u.prev=u.next){case 0:u.prev=0;t.isDataLoading=true;t.selectLength=0;a=t.dialogInfo,s=a.rowId,n=a.operateType;t.isBtnLoading=s?"":n;i={op_type:n};if(t.isSelectedAllPages){i[t.isDropdownMode?"scope":"expression_scope"]=t.selectedScope;c()(i,t.getSearchParams())}else{o=t.$refs.selectInstanceRef.dropdownSelectedData||{};l={bk_set_env:t.selectedScope.bk_set_env};Object.keys(o).forEach(function(e){l[e]=[]});l.bk_process_ids=s?[s]:r()(t.processIdList);i.scope=l}u.next=9;return t.$store.dispatch("process/ajaxSetOperateProcess",{data:i});case 9:d=u.sent;t.$store.commit("routeTaskHistoryDetail",d.data.job_id);u.next=18;break;case 13:u.prev=13;u.t0=u["catch"](0);console.warn(u.t0);t.isBtnLoading="";t.isDataLoading=false;case 18:case"end":return u.stop()}}},e,null,[[0,13]])}))()},handleDialogCancel:function e(){this.isBtnLoading="";this.isDataLoading=false;this.dialogInfo.visible=false;this.dialogInfo.rowId=null},showSideSlider:function e(t){if(this.isDropdownMode){this.selectedScope.bk_process_ids=[t.bk_process_id]}else{this.selectedScope.bk_process_id=String(t.bk_process_id)}this.isShow=true;this.processDetail=t},closeSideSlider:function e(){this.isShow=false},operateConfigDistribute:function e(){var t=this;return g()(f.a.mark(function e(){var a;return f.a.wrap(function e(s){while(1){switch(s.prev=s.next){case 0:a=t.$refs.selectInstanceRef.getFormatScope();if(!t.isSelectedAllPages){if(t.isDropdownMode){a.bk_process_ids=r()(t.processIdList)}else{a.bk_process_id=JSON.stringify(t.processIdList)}}t.$router.push({path:"/process-manage/release-config",query:{scope:JSON.stringify(a),isDropdownMode:t.isDropdownMode}});case 3:case"end":return s.stop()}}},e)}))()},onConfigDistribute:function e(){this.isShow=false},synchronousProcess:function e(t){var a=this;return g()(f.a.mark(function e(){var s;return f.a.wrap(function e(n){while(1){switch(n.prev=n.next){case 0:n.prev=0;a.isSynchronousLoading=true;a.isDataLoading=true;if(!(t==="status")){n.next=9;break}n.next=6;return a.$store.dispatch("process/ajaxSynchProcessStatus");case 6:s=n.sent;n.next=12;break;case 9:n.next=11;return a.$store.dispatch("process/ajaxFlushProcess");case 11:s=n.sent;case 12:if(s.result){if(a.checkeStatus==="loading"){a.hasCheckedAsync=true;a.resetEnvList();a.checkStepInstance()}else{if(t==="config"){a.$router.go(0)}else if(t==="status"){a.handlePageChange(a.pagination.current)}}if(a.showNormalProcess){a.$bkMessage({message:a.$t("同步成功"),theme:"success"})}}n.next=19;break;case 15:n.prev=15;n.t0=n["catch"](0);if(a.checkeStatus==="loading"){a.checkeStatus="completed"}console.warn(n.t0);case 19:n.prev=19;a.isSynchronousLoading=false;if(t!=="status"){a.isDataLoading=false}return n.finish(19);case 23:case"end":return n.stop()}}},e,null,[[0,15,19,23]])}))()},handlePaste:function e(t){var a=this;var s=d()(t.clipboardData.items,1),n=s[0];n.getAsString(function(e){var s=a.$refs.searchSelect;var n=false;if(s.input&&s.input.value){var i=s.input.value;n=/ip/i.test(s.input.value);c()(t.target,{innerText:n?"":i+e});a.$refs.searchSelect.handleInputChange(t);a.$refs.searchSelect.handleInputFocus(t)}else{n=true}if(n){var r=e.replace(/;+|；+|_+|\\+|，+|,+|、+|\s+/g,",").replace(/,+/g," ").trim();var o=["，"," ","、",",","\n"].find(function(e){return r.indexOf(e)>0})||"\n";var l=new RegExp("^((25[0-5]|2[0-4]\\d|[01]?\\d\\d?)\\.){3}(25[0-5]|2[0-4]\\d|[01]?\\d\\d?)$");var d=r.trim().split(o);var u=d.every(function(e){return l.test(e)});if(u){a.handlePushValue("bk_host_innerip",d.map(function(e){return{id:e,name:e}}))}else{a.searchSelectValue.push({id:r.trim().replace("\n",""),name:r.trim().replace("\n","")})}}})},handlePushValue:function e(t,a){var s=this;var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;if(!a||!Array.isArray(a))return;var i=this.searchSelectValue.findIndex(function(e){return e.id===t||e.id===s.toLine(t)});if(i>-1){var r=n?this.searchSelectValue[i].values||[]:[];a.forEach(function(e){var t=r.some(function(t){return t&&t.id===e.id});if(!t){r.push(e)}});this.searchSelectValue[i].values=r}else if(t){var o=this.filterData.find(function(e){return e.id===t||e.id===s.toLine(t)});this.searchSelectValue.push({id:t,name:o?o.name:"",values:a})}},toLine:function e(t){return t.replace(/([A-Z])/g,"_$1").toLowerCase()},handleSearchSelectFilter:function e(){var t=this;var a=this.filterData.filter(function(e){var a=ue(t.searchSelectValue),s;try{for(a.s();!(s=a.n()).done;){var n=s.value.id;if(e.id===n){return false}}}catch(e){a.e(e)}finally{a.f()}return true});if(!a.length&&this.isMenuShow){this.$refs.searchSelect.popperMenuInstance.hide()}this.searchSelectData=a},handleSearchSelectShowMenu:function e(){this.isMenuShow=true},handleSearchSelectChange:function e(t){var a=this;if(t.length>this.prevListLength){this.isMatch=false;var s=t[t.length-1];if(s.id==="bk_host_innerip"){this.isMatch=true;return}if(s.id===s.name){this.isMatch=true;return}var n=this.filterData.find(function(e){return e.id===s.id});if(n&&n.children){n.children=n.children.map(function(e){var t=s.values.find(function(t){return t.name===e.name});if(t){e.checked=true;t.id=e.id;a.isMatch=true}else{e.checked=false}return e})}}else{this.filterData.forEach(function(e){var a=t.find(function(t){return t.id===e.id});if(e.children){e.children=e.children.map(function(e){if(!a){e.checked=false}else{e.checked=a.values.some(function(t){return t.id===e.id})}return e})}})}if(!this.isMatch&&t.length){this.searchSelectValue.pop();this.$bkMessage({message:this.$t("请在列表中选择"),theme:"warning"})}this.prevListLength=this.searchSelectValue.length},handleFilterHeaderReset:function e(t){var a=this.searchSelectValue.findIndex(function(e){return e.id===t});if(a>-1){this.searchSelectValue.splice(a,1)}},handleFilterHeaderConfirm:function e(t,a){this.isMenuShow=false;var s=this.searchSelectValue.findIndex(function(e){return e.id===t});var n=a.reduce(function(e,t){if(t.checked){e.push({id:t.id,name:t.name})}return e},[]);if(s>-1){this.searchSelectValue[s].values=n}else{var i=this.filterData.find(function(e){return e.id===t});this.searchSelectValue.push({id:t,name:i?i.name:"",values:n})}},checkProcessCount:function e(){var t=this;return g()(f.a.mark(function e(){var a;return f.a.wrap(function e(s){while(1){switch(s.prev=s.next){case 0:t.checkeStatus="loading";t.tableData=[];t.isDataLoading=true;s.prev=3;t.checkedEnv=t.checkedEnvList.splice(0,1)[0];if(!t.localEnv){t.selectedScope.bk_set_env=t.checkedEnv}s.next=8;return t.$store.dispatch("process/ajaxGetProcessStatusList",{data:{page:1,pagesize:10,scope:{bk_set_env:t.checkedEnv}}});case 8:a=s.sent;if(a.data.list&&a.data.list.length){t.checkeStatus="normal"}else{t.checkStepInstance()}s.next=16;break;case 12:s.prev=12;s.t0=s["catch"](3);t.checkeStatus="unknow";console.warn(s.t0);case 16:s.prev=16;if(t.showNormalProcess){t.isDataLoading=false}return s.finish(16);case 19:case"end":return s.stop()}}},e,null,[[3,12,16,19]])}))()},checkStepInstance:function e(){var t=this;return g()(f.a.mark(function e(){var a;return f.a.wrap(function e(s){while(1){switch(s.prev=s.next){case 0:if(!(t.checkeStatus!=="loading")){s.next=2;break}return s.abrupt("return");case 2:if(t.hasCheckedModelList){s.next=18;break}s.prev=3;s.next=6;return t.$store.dispatch("cmdb/ajaxGetModuleListBySet",{data:{bk_set_ids:[]}});case 6:a=s.sent;t.hasCheckedModelList=true;if(a.data&&a.data.length){t.checkProcessCount()}else{t.checkeStatus="error"}s.next=16;break;case 11:s.prev=11;s.t0=s["catch"](3);console.warn(s.t0);t.isDataLoading=false;t.checkeStatus="error";case 16:s.next=19;break;case 18:if(t.checkedEnvList.length){t.checkProcessCount()}else{if(!t.hasCheckedAsync){t.synchronousProcess()}else{t.checkeStatus="completed"}}case 19:case"end":return s.stop()}}},e,null,[[3,11]])}))()},resetEnvList:function e(){var t=this.$store.state.bizId;var a=JSON.parse(window.localStorage.getItem("BK_SET_ENV_MAP")||"{}");var s=a[t];var n=[];var i=["3","2","1"];if(s){var r=i.findIndex(function(e){return e===s});if(r>-1){this.localEnv=s;this.selectedScope.bk_set_env=s;n.push(s);i.splice(r,1)}}this.checkedEnvList=n.concat(i)}}};var me=ge;var be=a(739);var _e=Object($["a"])(me,s,n,false,null,"96867376",null);var ke=t["default"]=_e.exports},395:function(e,t,a){},397:function(e,t,a){},398:function(e,t,a){},516:function(e,t,a){},520:function(e,t,a){},523:function(e,t,a){},655:function(e,t,a){"use strict";var s=a(395);var n=a.n(s);var i=n.a},657:function(e,t,a){"use strict";var s=a(397);var n=a.n(s);var i=n.a},658:function(e,t,a){"use strict";var s=a(398);var n=a.n(s);var i=n.a},731:function(e,t,a){"use strict";var s=a(516);var n=a.n(s);var i=n.a},735:function(e,t,a){"use strict";var s=a(520);var n=a.n(s);var i=n.a},739:function(e,t,a){"use strict";var s=a(523);var n=a.n(s);var i=n.a}}]);