(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[9],{218:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this;var t=e.$createElement;var a=e._self._c||t;return a("div",{directives:[{name:"test",rawName:"v-test",value:"versionDetail",expression:"'versionDetail'"},{name:"bkloading",rawName:"v-bkloading",value:{isLoading:e.versionLoading,opacity:.1},expression:"{ isLoading: versionLoading, opacity: .1 }"}],staticClass:"version-detail-container"},[e.selectedVersion?[a("div",{staticClass:"template-title"},[a("span",{staticClass:"gsekit-icon gsekit-icon-down-line",on:{click:e.backToVersionList}}),e._v(" "),a("span",{staticClass:"text"},[e._v(e._s(e.$t("版本详情")+e.$t("：")+e.displayTitle))])]),e._v(" "),a("div",{staticClass:"detail-main-container"},[a("div",{staticClass:"detail-left-panel",class:e.isFullScreen&&"full-screen",style:{width:e.showRightPanel?"calc(100% - "+e.rightPanelWidth+"px)":"100%"}},[a("div",{staticClass:"code-header"},[a("div",{staticClass:"code-header-left"},[a("span",{directives:[{name:"bk-overflow-tips",rawName:"v-bk-overflow-tips",value:{distance:24},expression:"{ distance: 24 }"}],staticClass:"id-and-description text-overflow-row"},[e._v("\n              #"+e._s(e.selectedVersion.config_version_id)+" "+e._s(e.selectedVersion.description)+"\n            ")]),e._v(" "),e.selectedVersion.is_draft?a("TagDraft",{attrs:{dark:""}}):e.selectedVersion.is_active?a("TagAvailable",{attrs:{dark:""}}):e._e()],1),e._v(" "),e.selectedVersion.is_draft?a("div",{staticClass:"code-header-right"},[a("span",[e._v(e._s(e.$t("高亮风格")))]),e._v(" "),a("bk-select",{directives:[{name:"test",rawName:"v-test",value:"highlight",expression:"'highlight'"}],staticClass:"king-select dark",attrs:{"ext-popover-cls":"dark",clearable:false},model:{value:e.codeLanguage,callback:function(t){e.codeLanguage=t},expression:"codeLanguage"}},[a("bk-option",{attrs:{id:"python",name:"python"}}),e._v(" "),a("bk-option",{attrs:{id:"yaml",name:"yaml"}}),e._v(" "),a("bk-option",{attrs:{id:"json",name:"json"}}),e._v(" "),a("bk-option",{attrs:{id:"javascript",name:"javascript"}})],1),e._v(" "),a("span",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips",value:{content:e.$t("全屏"),theme:"black-arrow"},expression:"{ content: $t('全屏'), theme: 'black-arrow' }"}],class:"gsekit-icon gsekit-icon-"+(e.isFullScreen?"exit-full-screen-line":"full-screen-line-line"),on:{click:function(t){e.isFullScreen=!e.isFullScreen}}})],1):a("div",{staticClass:"code-header-right"},[a("bk-button",{directives:[{name:"test",rawName:"v-test",value:"copy",expression:"'copy'"}],staticClass:"king-button king-button-copy",attrs:{theme:"primary",icon:"plus-line"},on:{click:e.copyAndCreate}},[e._v(e._s(e.$t("复制并新建"))+"\n            ")]),e._v(" "),a("bk-button",{directives:[{name:"test",rawName:"v-test",value:"preview",expression:"'preview'"}],staticClass:"king-button dark",on:{click:e.handleOpenPreview}},[e._v("\n              "+e._s(e.$t("预览"))+"\n            ")])],1)]),e._v(" "),a("CodeEditor",{ref:"codeEditorRef",attrs:{content:e.selectedVersion.content,language:e.codeLanguage,readonly:!e.selectedVersion.is_draft,eol:e.endOfLine},on:{change:e.handleEditorContentChange}})],1),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:e.showRightPanel,expression:"showRightPanel"}],staticClass:"detail-right-panel",style:{width:e.rightPanelWidth+"px"}},[a("VariableComponent",{directives:[{name:"show",rawName:"v-show",value:e.showVariablePanel,expression:"showVariablePanel"}],on:{close:function(t){e.showVariablePanel=false}}}),e._v(" "),a("PreviewComponent",{directives:[{name:"show",rawName:"v-show",value:e.showPreviewPanel,expression:"showPreviewPanel"}],ref:"previewRef",attrs:{"template-id":e.templateId,"show-preview-panel":e.showPreviewPanel,"preview-language":e.codeLanguage,"preview-content":e.currentEditorContent,"preview-content-cache":e.previewContentCache},on:{"update:previewContentCache":function(t){e.previewContentCache=t},close:function(t){e.showPreviewPanel=false}}}),e._v(" "),a("DragIcon",{class:e.isDragActive&&"active",on:{dragBegin:e.dragBegin}})],1)]),e._v(" "),e.selectedVersion.is_draft?a("div",{staticClass:"code-footer"},[a("bk-button",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips",value:e.emptyContentTips,expression:"emptyContentTips"},{name:"test",rawName:"v-test",value:"save",expression:"'save'"}],staticClass:"king-button",class:(!e.currentEditorContent||!e.canSave)&&"dark is-disabled",attrs:{theme:"primary"},on:{click:e.handleSave}},[e._v("\n        "+e._s(e.$t("保存"))+"\n      ")]),e._v(" "),a("bk-button",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips",value:e.emptyContentTips,expression:"emptyContentTips"},{name:"test",rawName:"v-test",value:"saveDraft",expression:"'saveDraft'"}],staticClass:"king-button dark",class:!e.currentEditorContent&&"is-disabled",staticStyle:{"margin-right":"60px"},attrs:{loading:e.saveDraftLoading},on:{click:e.handleSaveDraft}},[e._v("\n        "+e._s(e.$t("暂存草稿"))+"\n      ")]),e._v(" "),a("bk-button",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips",value:e.disableDiffTips,expression:"disableDiffTips"},{name:"test",rawName:"v-test",value:"diff",expression:"'diff'"}],staticClass:"king-button dark",class:!e.usableVersion&&"is-disabled",on:{click:e.handleDiff}},[e._v("\n        "+e._s(e.$t("对比"))+"\n      ")]),e._v(" "),a("bk-button",{directives:[{name:"test",rawName:"v-test",value:"showVariable",expression:"'showVariable'"}],staticClass:"king-button dark",on:{click:e.handleOpenVariable}},[e._v("\n        "+e._s(e.$t("变量"))+"\n      ")]),e._v(" "),a("bk-button",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips",value:e.rePreviewTips,expression:"rePreviewTips"},{name:"test",rawName:"v-test",value:"preview",expression:"'preview'"}],staticClass:"king-button dark",class:{"is-draft-updated":e.isDraftUpdated&&e.showPreviewPanel},staticStyle:{"margin-right":"60px"},on:{click:e.handleOpenPreview}},[e._v("\n        "+e._s(e.$t("预览"))+"\n      ")]),e._v(" "),a("bk-button",{staticClass:"king-button dark",on:{click:e.backToVersionList}},[e._v(e._s(e.$t("取消")))])],1):e._e(),e._v(" "),a("bk-sideslider",{attrs:{"is-show":e.showDiff,"quick-close":true,title:e.$t("版本对比"),width:1200},on:{"update:isShow":function(t){e.showDiff=t}}},[e.showDiff?a("DraftDiff",{attrs:{slot:"content","version-list":e.versionList,"draft-version":e.selectedVersion,"new-data":{content:e.currentEditorContent,language:e.codeLanguage}},on:{coverSuccess:e.handleDiffCoverSuccess},slot:"content"}):e._e()],1),e._v(" "),a("SaveDialog",{attrs:{show:e.showSaveDialog,loading:e.saveLoading},on:{"update:show":function(t){e.showSaveDialog=t},confirm:e.handleConfirmSave}}),e._v(" "),a("CoverDialog",{attrs:{show:e.showCoverDialog,"version-list":e.versionList,"cover-version":e.selectedVersion},on:{"update:show":function(t){e.showCoverDialog=t},close:function(t){e.showCoverDialog=false},coverSuccess:e.handleCopyCoverSuccess}})]:e._e()],2)};var n=[];var s=a(3);var r=a.n(s);var o=a(11);var c=a.n(o);var l=a(7);var d=a.n(l);var v=a(345);var u=a(386);var f=function(){var e=this;var t=e.$createElement;var a=e._self._c||t;return a("div",{staticClass:"drag-icon",on:{mousedown:function(t){if(!("button"in t)&&e._k(t.keyCode,"left",37,t.key,["Left","ArrowLeft"])){return null}if("button"in t&&t.button!==0){return null}e.$emit("dragBegin",t)}}},[a("span",{staticClass:"dot"}),e._v(" "),a("span",{staticClass:"dot"}),e._v(" "),a("span",{staticClass:"dot"}),e._v(" "),a("span",{staticClass:"dot"})])};var p=[];var h=a(769);var g=a(10);var m={};var _=Object(g["a"])(m,f,p,false,null,"2bc5ee28",null);var w=_.exports;var b=function(){var e=this;var t=e.$createElement;var a=e._self._c||t;return a("div",{directives:[{name:"test",rawName:"v-test",value:"variable",expression:"'variable'"}],staticClass:"variable-panel-container"},[a("div",{staticClass:"right-panel-header"},[a("div",{staticClass:"icon-container",on:{click:function(t){e.$emit("close")}}},[a("span",{staticClass:"bk-icon icon-expand-line"})]),e._v(" "),a("div",{staticClass:"title"},[e._v(e._s(e.$t("变量")))])]),e._v(" "),a("div",{staticClass:"right-panel-main"},[a("bk-input",{directives:[{name:"test",rawName:"v-test",value:"variableSearch",expression:"'variableSearch'"}],staticClass:"king-input",attrs:{clearable:true,"right-icon":"icon-search"},on:{change:e.handleKeywordChange},model:{value:e.keyword,callback:function(t){e.keyword=t},expression:"keyword"}}),e._v(" "),a("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:e.searchLoading,opacity:.1},expression:"{ isLoading: searchLoading, opacity: .1 }"}],staticClass:"variable-container",on:{click:e.copyText}},[a("div",{directives:[{name:"show",rawName:"v-show",value:e.activeTab==="global",expression:"activeTab === 'global'"}],staticClass:"table-container"},[a("div",{staticClass:"table-header couple-container"},[a("span",{staticClass:"couple-left"},[e._v(e._s(e.$t("名称")))]),e._v(" "),a("span",{staticClass:"couple-right"},[e._v(e._s(e.$t("变量")))])]),e._v(" "),a("ul",{staticClass:"table-body"},[e._l(e.globalVariables,function(t){return[a("li",{directives:[{name:"show",rawName:"v-show",value:t.isShow,expression:"item.isShow"},{name:"test",rawName:"v-test",value:"variableItem",expression:"'variableItem'"}],key:t.key,staticClass:"couple-container",attrs:{"test-key":t.key}},[a("div",{staticClass:"copy-text-container",attrs:{"data-copy-text":t.key}},[a("span",{staticClass:"text-overflow-row couple-left"},[e._v(e._s(t.name))]),e._v(" "),a("span",{staticClass:"text-overflow-row couple-right"},[e._v(e._s(t.key))])])])]})],2)])])],1)])};var C=[];var k=a(37);var x=a.n(k);var y=a(2);var $=a(113);var V=a(215);var L=a.n(V);var D=a(216);var T={name:"HelpVariable",data:function e(){return{keyword:"",searchLoading:false,inputTimer:null,activeTab:"global",globalVariables:[]}},watch:{"$store.state.cmdb.globalVariables":{handler:function e(t){this.globalVariables=t.map(function(e){return{key:e.bk_property_id,name:e.bk_property_name,isShow:true}})},immediate:true}},created:function e(){if(!this.$store.state.cmdb.globalVariables.length){this.$store.dispatch("cmdb/ajaxGetGlobalVariables")}},methods:{toggleTab:function e(t){this.keyword="";this.activeTab=t;this.matchKeyword(true)},handleKeywordChange:function e(){this.matchKeyword()},matchKeyword:function e(t){var a=this;if(!t){this.searchLoading=true}this.inputTimer&&clearTimeout(this.inputTimer);this.inputTimer=setTimeout(function(){a.searchLoading=false;a.globalVariables.forEach(function(e){var t="";Object.entries(e).forEach(function(e){var a=x()(e,2),i=a[0],n=a[1];if(i!=="isShow"){t+=n}});e.isShow=t.toLowerCase().includes(a.keyword.toLowerCase())})},t?0:300)},copyText:function e(t){var a=this;var i=this.findCopyElement(t);if(i){try{var n=document.createElement("input");var s=i.getAttribute("data-copy-text");n.setAttribute("value","${".concat(s,"}"));document.body.appendChild(n);n.select();document.execCommand("copy");document.body.removeChild(n);i.classList.add("copy");setTimeout(function(){window.addEventListener("click",function(e){if(a.findCopyElement(e)!==i){i.classList.remove("copy")}},{once:true})});if(!i._tippy){i._tippy=L()(i,{content:this.$t("复制成功"),placement:"bottom",trigger:"manual",arrow:true,size:"small",extCls:"copy-successfully-tippy"})}i._tippy.show()}catch(e){console.warn(e)}}},findCopyElement:function e(t){var a=t.target;while(a!==null&&!a.classList.value.includes("copy-text-container")){a=a.parentElement}return a}}};var S=T;var P=a(770);var E=a(771);var N=Object(g["a"])(S,b,C,false,null,"6955d7c5",null);var I=N.exports;var j=function(){var e=this;var t=e.$createElement;var a=e._self._c||t;return a("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:e.basicLoading,opacity:.1},expression:"{ isLoading: basicLoading, opacity: .1 }"}],staticClass:"version-preview-container"},[a("div",{staticClass:"right-panel-header"},[a("div",{staticClass:"icon-container",on:{click:function(t){e.$emit("close")}}},[a("span",{staticClass:"bk-icon icon-expand-line"})]),e._v(" "),a("div",{staticClass:"title"},[e._v(e._s(e.$t("预览")))]),e._v(" "),a("div",{staticClass:"head-select"},[a("div",{staticClass:"process-instance"},[e._v("\n        "+e._s(e.$t("进程实例"))+"\n        "),a("span",{staticClass:"star"},[e._v("*")])]),e._v(" "),a("TreeSelect",{ref:"treeSelectRef",attrs:{placement:"bottom-end","popover-min-width":398,"tree-data":e.topoData},on:{selected:e.handleSelected}})],1)]),e._v(" "),a("div",{staticClass:"right-panel-main"},[a("CodeEditor",{attrs:{content:e.codeContent,language:e.codeLanguage}})],1)])};var O=[];var A=function(){var e=this;var t=e.$createElement;var a=e._self._c||t;return a("div",{staticClass:"custom-tree-select-container"},[a("bk-popover",{ref:"popover",attrs:{theme:"light custom-tree-select",trigger:"click",animation:"slide-toggle",placement:e.placement,offset:0,distance:12,"on-show":e.handleDropdownShow,"on-hide":e.handleDropdownHide}},[a("div",{directives:[{name:"test",rawName:"v-test",value:"treeSelect",expression:"'treeSelect'"}],ref:"triggerRef",staticClass:"custom-tree-select-trigger",class:{active:e.showDropdown,"is-not-selected":!e.selectedName}},[e.selectedName?a("span",[e._v(e._s(e.selectedName))]):a("span",{staticClass:"holder-text"},[e._v(e._s(e.$t("请选择进程实例")))]),e._v(" "),!e.showDropdown&&!e.selectedName?a("span",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips",value:e.noSelectedTips,expression:"noSelectedTips"}],staticClass:"bk-icon icon-exclamation-circle-shape"}):e._e(),e._v(" "),a("span",{staticClass:"bk-icon icon-angle-down"})]),e._v(" "),a("div",{ref:"contentRef",staticClass:"custom-tree-select-content",style:e.contentStyle,attrs:{slot:"content"},slot:"content"},[a("div",{staticClass:"input-container"},[a("span",{staticClass:"bk-icon icon-search"}),e._v(" "),a("input",{directives:[{name:"test",rawName:"v-test",value:"searchInstance",expression:"'searchInstance'"},{name:"model",rawName:"v-model.trim",value:e.searchKeyword,expression:"searchKeyword",modifiers:{trim:true}}],ref:"searchInput",staticClass:"search-input",attrs:{type:"text",placeholder:e.$t("请输入关键字")},domProps:{value:e.searchKeyword},on:{input:[function(t){if(t.target.composing){return}e.searchKeyword=t.target.value.trim()},e.handleSearch],blur:function(t){e.$forceUpdate()}}})]),e._v(" "),a("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:e.searchLoading,opacity:.1},expression:"{ isLoading: searchLoading, opacity: .1 }"}],staticClass:"tree-container"},[a("Tree",{attrs:{"node-list":e.treeData},on:{checked:e.handleCheckNode}})],1)])])],1)};var F=[];var R=function(){var e=this;var t=e.$createElement;var a=e._self._c||t;return a("ul",{staticClass:"select-tree-container"},[e._l(e.nodeList,function(t,i){return[a("li",{directives:[{name:"show",rawName:"v-show",value:t.topoVisible,expression:"topoNode.topoVisible"}],key:i,staticClass:"tree-node-container"},[a("div",{staticClass:"tree-node-item",class:{"checked-node-item":t.topoChecked},style:{"padding-left":8+30*t.topoLevel+"px"},on:{click:function(a){e.handleClickNode(t)}}},[!t.topoProcess?a("div",{staticClass:"icon-container"},[t.topoLoading?a("svg",{staticClass:"svg-icon",attrs:{"aria-hidden":"true"}},[a("use",{attrs:{"xlink:href":"#gsekit-icon-loading"}})]):a("span",{class:["bk-icon icon-right-shape",t.topoExpand&&"expanded"]})]):e._e(),e._v(" "),a("div",{staticClass:"node-type-icon",class:{"process-type":t.topoProcess}},[e._v("\n          "+e._s(e.nodeTypeMap[t.topoLevel])+"\n        ")]),e._v(" "),a("div",{directives:[{name:"bk-overflow-tips",rawName:"v-bk-overflow-tips"}],staticClass:"text-content"},[e._v("\n          "+e._s(t.topoName)+"\n        ")]),e._v(" "),t.topoType==="instanceProcess"&&t.unmanaged?a("div",{staticClass:"node-tag process-unmanaged"},[e._v("\n          "+e._s(e.$t("未关联"))+"\n        ")]):e._e(),e._v(" "),t.topoProcessCount!==undefined?a("div",{staticClass:"node-tag process-count"},[e._v("\n          "+e._s(t.topoProcessCount)+"\n        ")]):e._e()]),e._v(" "),t.child&&t.child.length?a("Tree",{directives:[{name:"show",rawName:"v-show",value:t.topoExpand,expression:"topoNode.topoExpand"}],attrs:{"node-list":t.child},on:{checked:e.handleCheckNode}}):e._e()],1)]})],2)};var B=[];var W={name:"Tree",inject:["linkedProcess"],props:{nodeList:{type:Array,required:true}},data:function e(){return{nodeTypeMap:[this.$t("集"),this.$t("模"),this.$t("实"),this.$t("进")]}},computed:{linkedList:function e(){return this.linkedProcess()}},methods:{handleClickNode:function e(t){var a=this;return d()(r.a.mark(function e(){var i,n;return r.a.wrap(function e(s){while(1){switch(s.prev=s.next){case 0:if(!t.topoProcess){s.next=4;break}a.$emit("checked",t);s.next=33;break;case 4:t.topoExpand=!t.topoExpand;if(!(t.topoExpand&&!(t.child&&t.child.length))){s.next=32;break}s.prev=6;t.topoLoading=true;if(!(t.topoType==="module")){s.next=16;break}s.next=11;return a.$store.dispatch("cmdb/ajaxGetServiceListByModule",{withProcCount:true,data:{bk_module_ids:[t.bk_inst_id]}});case 11:i=s.sent;i.data.forEach(function(e){e.child=[];e.topoParent=t;e.topoVisible=true;e.topoExpand=false;e.topoLoading=false;e.topoLevel=t.topoLevel+1;e.topoName=e.service_instance_name;e.topoProcessCount=e.process_count;e.topoProcess=false;e.topoType="serviceInstance"});t.child=i.data;s.next=22;break;case 16:if(!(t.topoType==="serviceInstance")){s.next=22;break}s.next=19;return a.$store.dispatch("process/ajaxGetInstanceProcessByServiceInstance",{serviceInstanceId:t.service_instance_id});case 19:n=s.sent;n.data.forEach(function(e){e.topoParent=t;e.topoVisible=true;e.topoExpand=false;e.topoLoading=false;e.topoLevel=t.topoLevel+1;e.topoName=e.property.bk_process_name;e.topoProcess=true;e.topoType="instanceProcess";e.topoChecked=false;e.unmanaged=!a.linkedList.find(function(t){var a=t.type,i=t.id;return a==="TEMPLATE"?i===e.process_template_id:i===e.bk_process_id})});t.child=n.data;case 22:s.next=27;break;case 24:s.prev=24;s.t0=s["catch"](6);console.warn(s.t0);case 27:s.prev=27;t.topoLoading=false;return s.finish(27);case 30:s.next=33;break;case 32:if(t.child&&t.child.length){t.child.forEach(function(e){e.topoVisible=true})}case 33:case"end":return s.stop()}}},e,null,[[6,24,27,30]])}))()},handleCheckNode:function e(t){this.$emit("checked",t)}}};var M=W;var q=a(772);var K=Object(g["a"])(M,R,B,false,null,"461cec1f",null);var z=K.exports;var U=a(19);var H={components:{Tree:z},props:{treeData:{type:Array,default:function e(){return[]}},placement:{type:String,default:"bottom-start"},popoverMinWidth:{type:Number,default:0}},data:function e(){return{selectedName:"",noSelectedTips:{content:this.$t("预览必须选择实例进程"),distance:20},showDropdown:false,searchKeyword:"",searchLoading:false,searchTimer:null}},computed:{contentStyle:function e(){return this.popoverMinWidth?{minWidth:"".concat(this.popoverMinWidth,"px")}:{}}},methods:{handleDropdownShow:function e(){var t=this;this.showDropdown=true;var a=this.$refs.triggerRef.getBoundingClientRect().width;this.$refs.contentRef.style.width="".concat(Object(U["b"])(a,280,400)-2,"px");this.$nextTick(function(){t.$refs.searchInput.focus()})},handleDropdownHide:function e(){this.showDropdown=false},handleCheckNode:function e(t){this.setNodeChecked(t,this.treeData);this.selectedName=t.topoName;this.$emit("selected",t);this.$refs.popover.instance.hide()},setNodeChecked:function e(t,a){var i=this;a.forEach(function(e){e.topoChecked=e===t;if(e.child&&e.child.length){i.setNodeChecked(t,e.child)}})},handleSearch:function e(){var t=this;this.searchLoading=true;this.searchTimer&&clearTimeout(this.searchTimer);this.searchTimer=setTimeout(function(){t.searchTree(t.treeData,t.searchKeyword);t.searchLoading=false},300)},searchTree:function e(t,a){var i=this;t.forEach(function(e){e.topoExpand=false;var t=e.topoName.includes(a);e.topoVisible=t;if(t){i.setParentVisible(e.topoParent,a)}if(e.child&&e.child.length){i.searchTree(e.child,a)}})},setParentVisible:function e(t,a){if(t){t.topoVisible=true;t.topoExpand=Boolean(a);this.setParentVisible(t.topoParent,a)}}}};var G=H;var X=a(773);var Z=a(774);var Y=Object(g["a"])(G,A,F,false,null,"5c75e4b2",null);var J=Y.exports;var Q=a(385);var ee={name:"VersionPreview",components:{TreeSelect:J,CodeEditor:Q["a"]},provide:function e(){var t=this;return{linkedProcess:function e(){return t.linkedProcess}}},props:{templateId:{type:String,default:""},showPreviewPanel:{type:Boolean,default:false},previewLanguage:{type:String,default:"python"},previewContent:{type:String,default:""},previewContentCache:{type:String,default:""}},data:function e(){return{codeContent:"",codeLanguage:"python",basicLoading:false,topoData:[],selectedProcess:null,linkedProcess:[]}},watch:{showPreviewPanel:{handler:function e(t){if(t){if(this.topoData.length){this.handleRefresh()}else{this.getProcessList();this.getTemplateBindRelationship()}}},immediate:true}},methods:{getProcessList:function e(){var t=this;return d()(r.a.mark(function e(){var a,i;return r.a.wrap(function e(n){while(1){switch(n.prev=n.next){case 0:n.prev=0;t.basicLoading=true;n.next=4;return t.$store.dispatch("cmdb/ajaxGetBizTopo");case 4:a=n.sent;i=a.data.length?a.data[0].child:[];t.filterTopoData(i);t.topoData=t.getHasProcessTopo(i);t.$nextTick(t.openSelect);n.next=14;break;case 11:n.prev=11;n.t0=n["catch"](0);console.warn(n.t0);case 14:n.prev=14;t.basicLoading=false;return n.finish(14);case 17:case"end":return n.stop()}}},e,null,[[0,11,14,17]])}))()},getTemplateBindRelationship:function e(){var t=this;return d()(r.a.mark(function e(){var a,i,n;return r.a.wrap(function e(s){while(1){switch(s.prev=s.next){case 0:s.prev=0;s.next=3;return t.$store.dispatch("configTemplate/ajaxGetTemplateBindRelationship",{templateId:t.templateId});case 3:a=s.sent;i=a.data;n=i===void 0?[]:i;t.linkedProcess=n.map(function(e){return{id:e.process_object_id,type:e.process_object_type}});s.next=12;break;case 9:s.prev=9;s.t0=s["catch"](0);console.warn(s.t0);case 12:case"end":return s.stop()}}},e,null,[[0,9]])}))()},openSelect:function e(){this.$refs.treeSelectRef.$el.querySelector(".custom-tree-select-trigger").click()},filterTopoData:function e(t){var a=this;var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:-1;var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;i+=1;t.sort(Object(U["h"])("bk_inst_name"));t.forEach(function(e){e.topoParent=n;e.topoVisible=true;e.topoExpand=false;e.topoLoading=false;e.topoLevel=i;e.topoName=e.bk_inst_name;e.topoProcessCount=e.process_count;e.topoProcess=false;e.topoType=e.bk_obj_id;if(e.child&&e.child.length){a.filterTopoData(e.child,i,e)}})},getHasProcessTopo:function e(t){var a=this;var i=t.filter(function(e){return!["set","module"].includes(e.topoType)||e.topoProcessCount});i.forEach(function(e){if(e.child&&e.child.length){e.child=a.getHasProcessTopo(e.child)}});return i},handleSelected:function e(t){this.selectedProcess=t;this.handleRefresh()},handleRefresh:function e(){var t=this;return d()(r.a.mark(function e(){var a;return r.a.wrap(function e(i){while(1){switch(i.prev=i.next){case 0:if(t.selectedProcess){i.next=3;break}t.openSelect();return i.abrupt("return");case 3:i.prev=3;t.basicLoading=true;i.next=7;return t.$store.dispatch("configVersion/ajaxPreviewConfigVersion",{data:{content:t.previewContent,bk_process_id:t.selectedProcess.property.bk_process_id}});case 7:a=i.sent;t.codeLanguage=t.previewLanguage;t.codeContent=a.data;t.$emit("update:previewContentCache",t.previewContent);i.next=17;break;case 13:i.prev=13;i.t0=i["catch"](3);console.warn(i.t0);t.codeContent="";case 17:i.prev=17;t.basicLoading=false;return i.finish(17);case 20:case"end":return i.stop()}}},e,null,[[3,13,17,20]])}))()}}};var te=ee;var ae=a(775);var ie=Object(g["a"])(te,j,O,false,null,"72a386d3",null);var ne=ie.exports;var se=function(){var e=this;var t=e.$createElement;var a=e._self._c||t;return a("div",{staticClass:"draft-diff-container"},[a("div",{staticClass:"draft-diff-header"},[a("DiffNav",{attrs:{"diff-count":e.diffCount},on:{previous:e.jumpPreviousChange,next:e.jumpNextChange}})],1),e._v(" "),a("div",{staticClass:"draft-diff-title"},[a("div",{staticClass:"draft-diff-title-half"},[a("div",{staticClass:"status-flag"},[e._v(e._s(e.$t("选择对比")))]),e._v(" "),a("bk-select",{ref:"versionSelectRef",staticClass:"king-select dark",attrs:{"ext-popover-cls":"dark",clearable:false},model:{value:e.selectedVersionId,callback:function(t){e.selectedVersionId=t},expression:"selectedVersionId"}},[a("div",{staticClass:"bk-select-name",attrs:{slot:"trigger"},slot:"trigger"},[a("span",{directives:[{name:"bk-overflow-tips",rawName:"v-bk-overflow-tips",value:{distance:20},expression:"{ distance: 20 }"}],staticClass:"text-overflow-row"},[e._v("\n            #"+e._s(e.compareVersion.config_version_id)+" "+e._s(e.compareVersion.description)+"\n          ")]),e._v(" "),e.compareVersion.is_active?a("TagAvailable",{attrs:{dark:""}}):e._e()],1),e._v(" "),e._l(e.filterVersionList,function(t){return[a("bk-option",{key:t.config_version_id,attrs:{id:t.config_version_id,name:t.description}},[a("div",{staticStyle:{display:"flex","align-items":"center"}},[a("span",{directives:[{name:"bk-overflow-tips",rawName:"v-bk-overflow-tips",value:{placement:"right"},expression:"{ placement: 'right' }"}],staticClass:"text-overflow-row"},[e._v("\n                #"+e._s(t.config_version_id+t.description)+"\n              ")]),e._v(" "),t.is_active?a("TagAvailable",{attrs:{dark:""}}):e._e()],1)])]})],2)],1),e._v(" "),a("div",{staticClass:"draft-diff-title-half"},[a("div",{staticClass:"status-flag"},[e._v(e._s(e.$t("当前草稿")))]),e._v(" "),a("span",{directives:[{name:"bk-overflow-tips",rawName:"v-bk-overflow-tips"}],staticClass:"description-name text-overflow-row"},[e._v("\n        #"+e._s(e.draftVersion.config_version_id+" "+e.draftVersion.description)+"\n      ")]),e._v(" "),a("TagDraft",{attrs:{dark:""}})],1)]),e._v(" "),a("div",{staticClass:"diff-editor-content"},[e.showDiffEditor?a("DiffEditor",{ref:"diffEditorRef",attrs:{"old-data":e.oldData,"new-data":e.newData,"diff-count":e.diffCount},on:{"update:diffCount":function(t){e.diffCount=t}}}):e._e()],1),e._v(" "),a("div",{staticClass:"diff-editor-footer"},[a("bk-button",{attrs:{loading:e.isLoading},on:{click:e.coverDraftWithSelected}},[e._v(e._s(e.$t("用对比版本覆盖当前草稿")))]),e._v(" "),a("bk-button",{staticStyle:{"margin-left":"10px"}},[e._v(e._s(e.$t("取消")))])],1)])};var re=[];var oe=a(388);var ce=a(387);var le={components:{TagAvailable:v["a"],TagDraft:u["a"],DiffNav:oe["a"],DiffEditor:ce["a"]},props:{versionList:{type:Array,required:true},draftVersion:{type:Object,required:true},newData:{type:Object,default:function e(){return{content:"",language:"python"}}}},data:function e(){var t=this.versionList.filter(function(e){return!e.is_draft});var a=t[0];var i=a.config_version_id;return{selectedVersionId:i,compareVersion:a,filterVersionList:t,showDiffEditor:true,isLoading:false,diffCount:0}},computed:{oldData:function e(){return{content:this.compareVersion.content,language:this.compareVersion.file_format||"python"}}},watch:{selectedVersionId:function e(t){var a=this;this.compareVersion=this.filterVersionList.find(function(e){return e.config_version_id===t});this.showDiffEditor=false;this.$nextTick(function(){a.showDiffEditor=true})}},methods:{jumpNextChange:function e(){this.$refs.diffEditorRef.diffNavigator.next()},jumpPreviousChange:function e(){this.$refs.diffEditorRef.diffNavigator.previous()},coverDraftWithSelected:function e(){var t=this;return d()(r.a.mark(function e(){var a,i;return r.a.wrap(function e(n){while(1){switch(n.prev=n.next){case 0:n.prev=0;t.isLoading=true;a=t.draftVersion.config_version_id;n.next=5;return t.$store.dispatch("configVersion/ajaxUpdateConfigVersion",{versionId:a,data:{description:t.compareVersion.description,content:t.compareVersion.content,file_format:t.compareVersion.file_format,is_active:false,is_draft:true}});case 5:i=n.sent;t.$emit("coverSuccess",i);n.next=12;break;case 9:n.prev=9;n.t0=n["catch"](0);console.warn(n.t0);case 12:n.prev=12;t.isLoading=false;return n.finish(12);case 15:case"end":return n.stop()}}},e,null,[[0,9,12,15]])}))()}}};var de=le;var ve=a(776);var ue=Object(g["a"])(de,se,re,false,null,"542a2a81",null);var fe=ue.exports;var pe=function(){var e=this;var t=e.$createElement;var a=e._self._c||t;return a("bk-dialog",{attrs:{value:e.show,title:e.$t("保存确认"),"mask-close":false,width:"480","header-position":"left"},on:{"value-change":e.handleValueChange}},[a("div",{staticClass:"save-dialog-content"},[a("div",{staticClass:"version-description"},[a("div",{staticClass:"title"},[e._v("\n        "+e._s(e.$t("版本描述"))+"\n        "),a("span",{staticClass:"star"},[e._v("*")])]),e._v(" "),a("bk-input",{ref:"inputRef",class:e.isError&&"is-error-input",attrs:{type:"textarea",clearable:true,maxlength:100},on:{blur:function(t){e.isError=!e.versionDescription},focus:function(t){e.isError=false}},model:{value:e.versionDescription,callback:function(t){e.versionDescription=typeof t==="string"?t.trim():t},expression:"versionDescription"}}),e._v(" "),e.isError?a("div",{staticClass:"is-error-text"},[e._v(e._s(e.$t("版本描述不能为空")))]):e._e()],1)]),e._v(" "),a("div",{staticClass:"footer-wrapper",attrs:{slot:"footer"},slot:"footer"},[a("bk-button",{attrs:{theme:"primary",loading:e.loading,disabled:e.isError},on:{click:e.handleConfirm}},[e._v("\n      "+e._s(e.$t("确定"))+"\n    ")]),e._v(" "),a("bk-button",{on:{click:e.handleCancel}},[e._v("\n      "+e._s(e.$t("取消"))+"\n    ")])],1)])};var he=[];var ge={props:{show:{type:Boolean,required:true},loading:{type:Boolean,required:true}},data:function e(){return{isError:false,versionDescription:""}},watch:{show:function e(t){var a=this;if(t){this.versionDescription="";setTimeout(function(){a.$refs.inputRef.$el.querySelector("textarea").focus()},100)}}},methods:{handleValueChange:function e(t){this.$emit("update:show",t)},handleConfirm:function e(){if(!this.isError){this.$emit("confirm",this.versionDescription)}},handleCancel:function e(){this.$emit("update:show",false)}}};var me=ge;var _e=a(777);var we=Object(g["a"])(me,pe,he,false,null,"a5f7607c",null);var be=we.exports;var Ce=a(647);var ke={name:"VersionDetail",components:{TagAvailable:v["a"],TagDraft:u["a"],DragIcon:w,VariableComponent:I,PreviewComponent:ne,CodeEditor:Q["a"],DraftDiff:fe,SaveDialog:be,CoverDialog:Ce["a"]},props:{selectedConfig:{type:Object,required:true},displayTitle:{type:String,default:""},versionLoading:{type:Boolean,required:true},versionList:{type:Array,required:true},selectedVersion:{type:Object,default:null}},data:function e(){var t=document.body.offsetWidth-120;var a=Math.floor(t*.382);return{formatDate:U["e"],codeLanguage:"python",currentEditorContent:"",saveLoading:false,isFullScreen:false,rightPanelWidth:a,minWidth:500,maxWidth:900,isDragActive:false,showVariablePanel:false,showPreviewPanel:false,previewContentCache:"",showDiff:false,showSaveDialog:false,showCoverDialog:false,saveDraftLoading:false}},computed:{showRightPanel:function e(){return this.showVariablePanel||this.showPreviewPanel},isDraftUpdated:function e(){return this.previewContentCache&&this.currentEditorContent!==this.previewContentCache},versionId:function e(){return this.$route.params.versionId},templateId:function e(){return this.$route.params.templateId},usableVersion:function e(){return this.versionList.find(function(e){return e.is_active})},usableCodeData:function e(){return{content:this.usableVersion.content,language:this.usableVersion.file_format}},draftCodeData:function e(){return{content:this.currentEditorContent,language:this.codeLanguage}},rePreviewTips:function e(){return{theme:"black-arrow",content:this.$t("草稿有更新，请重新预览"),disabled:!this.isDraftUpdated||!this.showPreviewPanel}},disableDiffTips:function e(){return{theme:"black-arrow",content:this.$t("暂无可供对比的版本"),disabled:Boolean(this.usableVersion)}},canSave:function e(){return this.currentEditorContent===this.previewContentCache},emptyContentTips:function e(){var t={theme:"black-arrow",content:"",disable:true};if(!this.currentEditorContent){t.content=this.$t("配置模板内容为空");t.disable=false}else if(!this.canSave){t.content=this.$t("请预览成功后再保存");t.disable=false}return t},endOfLine:function e(){return this.selectedConfig&&this.selectedConfig.line_separator?this.selectedConfig.line_separator:"LF"}},watch:{selectedVersion:{handler:function e(t){if(t){this.codeLanguage=t.file_format||"python";if(this.$route.query.preview){this.showVariablePanel=false;this.showPreviewPanel=true}else if(t.is_draft){this.showVariablePanel=true;this.showPreviewPanel=false}}},immediate:true},isFullScreen:function e(){window.bus.$emit("resize",true)},showRightPanel:function e(){window.bus.$emit("resize",true)},rightPanelWidth:function e(){window.bus.$emit("resize")}},mounted:function e(){window.addEventListener("keydown",this.handleKeydown)},beforeDestroy:function e(){window.removeEventListener("keydown",this.handleKeydown)},beforeRouteLeave:function e(t,a,i){var n=this;if(this.selectedVersion.is_draft&&this.selectedVersion.content!==this.currentEditorContent){this.$bkInfo({title:this.$t("是否离开当前页")+this.$t("？"),subTitle:this.$t("离开将会导致未保存信息丢失"),confirmFn:function e(){n.$refs.codeEditorRef.setValue(n.selectedVersion.content);i()}})}else{i()}},methods:{handleKeydown:function e(t){if(t.code==="Escape"&&this.isFullScreen){this.isFullScreen=false}},handleEditorContentChange:function e(t){this.currentEditorContent=t},handleSave:function e(){if(!this.currentEditorContent||!this.canSave){return}this.showSaveDialog=true},handleConfirmSave:function e(t){var a=this;return d()(r.a.mark(function e(){var i;return r.a.wrap(function e(n){while(1){switch(n.prev=n.next){case 0:if(a.currentEditorContent){n.next=2;break}return n.abrupt("return");case 2:if(!(a.selectedVersion.config_version_id==="0")){n.next=4;break}return n.abrupt("return",a.createNewActiveVersion(t));case 4:n.prev=4;a.saveLoading=true;n.next=8;return a.$store.dispatch("configVersion/ajaxUpdateConfigVersion",{versionId:a.selectedVersion.config_version_id,data:{description:t,content:a.currentEditorContent,file_format:a.codeLanguage,is_active:true,is_draft:false}});case 8:i=n.sent;if(a.usableVersion){a.usableVersion.is_active=false}c()(a.selectedVersion,{description:i.data.description,content:i.data.content,file_format:i.data.codeLanguage,updated_at:i.data.updated_at,updated_by:i.data.updated_by,is_active:true,is_draft:false});a.messageSuccess(a.$t("保存成功"));a.showSaveDialog=false;a.backToVersionList();n.next=19;break;case 16:n.prev=16;n.t0=n["catch"](4);console.warn(n.t0);case 19:n.prev=19;a.saveLoading=false;return n.finish(19);case 22:case"end":return n.stop()}}},e,null,[[4,16,19,22]])}))()},createNewActiveVersion:function e(t){var a=this;return d()(r.a.mark(function e(){var i;return r.a.wrap(function e(n){while(1){switch(n.prev=n.next){case 0:n.prev=0;a.saveLoading=true;n.next=4;return a.$store.dispatch("configTemplate/ajaxCreateNewConfigVersion",{templateId:a.templateId,data:{description:t,content:a.currentEditorContent,file_format:a.codeLanguage,is_active:true}});case 4:i=n.sent;if(a.usableVersion){a.usableVersion.is_active=false}a.$emit("createNewVersion",i.data);a.messageSuccess(a.$t("成功创建新版本"));a.showSaveDialog=false;a.$set(a.selectedVersion,"is_draft",false);a.backToVersionList();n.next=16;break;case 13:n.prev=13;n.t0=n["catch"](0);console.warn(n.t0);case 16:n.prev=16;a.saveLoading=false;return n.finish(16);case 19:case"end":return n.stop()}}},e,null,[[0,13,16,19]])}))()},handleSaveDraft:function e(){var t=this;return d()(r.a.mark(function e(){var a;return r.a.wrap(function e(i){while(1){switch(i.prev=i.next){case 0:if(t.currentEditorContent){i.next=2;break}return i.abrupt("return");case 2:if(!(t.selectedVersion.config_version_id==="0")){i.next=4;break}return i.abrupt("return",t.createNewDraftVersion());case 4:i.prev=4;t.saveDraftLoading=true;i.next=8;return t.$store.dispatch("configVersion/ajaxUpdateConfigVersion",{versionId:t.versionId,data:{description:t.selectedVersion.description,content:t.currentEditorContent,file_format:t.codeLanguage,is_active:false,is_draft:true}});case 8:a=i.sent;c()(t.selectedVersion,{description:a.data.description,content:a.data.content,file_format:a.data.codeLanguage,updated_at:a.data.updated_at,updated_by:a.data.updated_by});t.messageSuccess(t.$t("保存成功"));i.next=16;break;case 13:i.prev=13;i.t0=i["catch"](4);console.warn(i.t0);case 16:i.prev=16;t.saveDraftLoading=false;return i.finish(16);case 19:case"end":return i.stop()}}},e,null,[[4,13,16,19]])}))()},createNewDraftVersion:function e(){var t=this;return d()(r.a.mark(function e(){var a;return r.a.wrap(function e(i){while(1){switch(i.prev=i.next){case 0:i.prev=0;t.saveDraftLoading=true;i.next=4;return t.$store.dispatch("configTemplate/ajaxCreateNewConfigVersion",{templateId:t.templateId,data:{description:t.selectedVersion.description,content:t.currentEditorContent,file_format:t.codeLanguage}});case 4:a=i.sent;t.$emit("createNewVersion",a.data);t.messageSuccess(t.$t("保存成功"));t.$store.commit("routeConfigTemplateVersionDetail",{templateId:t.templateId,versionId:a.data.config_version_id});i.next=13;break;case 10:i.prev=10;i.t0=i["catch"](0);console.warn(i.t0);case 13:i.prev=13;t.saveDraftLoading=false;return i.finish(13);case 16:case"end":return i.stop()}}},e,null,[[0,10,13,16]])}))()},handleDiff:function e(){if(!this.usableVersion){return}this.showDiff=true},handleDiffCoverSuccess:function e(t){var a=this;return d()(r.a.mark(function e(){return r.a.wrap(function e(i){while(1){switch(i.prev=i.next){case 0:c()(a.selectedVersion,{description:t.data.description,content:t.data.content,file_format:t.data.codeLanguage,updated_at:t.data.updated_at,updated_by:t.data.updated_by});a.showDiff=false;a.messageSuccess(a.$t("修改成功"));case 3:case"end":return i.stop()}}},e)}))()},handleOpenVariable:function e(){this.showVariablePanel=true;this.showPreviewPanel=false},handleOpenPreview:function e(){if(this.showPreviewPanel){this.$refs.previewRef.handleRefresh()}else{this.showPreviewPanel=true;this.showVariablePanel=false}},backToVersionList:function e(){this.$store.commit("routeConfigTemplateVersionList",{templateId:this.templateId})},copyAndCreate:function e(){var t=this;return d()(r.a.mark(function e(){var a;return r.a.wrap(function e(i){while(1){switch(i.prev=i.next){case 0:if(!t.versionList.some(function(e){return e.is_draft})){i.next=4;break}t.showCoverDialog=true;i.next=17;break;case 4:i.prev=4;t.$emit("update:versionLoading",true);i.next=8;return t.$store.dispatch("configVersion/ajaxCreateConfigVersion",{versionId:t.versionId,data:{description:t.selectedVersion.description}});case 8:a=i.sent;t.messageSuccess(t.$t("成功创建新版本"));t.$emit("updateVersionList",a.data.config_version_id.toString());i.next=17;break;case 13:i.prev=13;i.t0=i["catch"](4);console.warn(i.t0);t.$emit("update:versionLoading",false);case 17:case"end":return i.stop()}}},e,null,[[4,13]])}))()},handleCopyCoverSuccess:function e(t){this.showCoverDialog=false;this.$emit("updateVersionList",t)},dragBegin:function e(t){this.isDragActive=true;this.currentWidth=this.rightPanelWidth;this.currentScreenX=t.screenX;window.addEventListener("mousemove",this.dragMoving,{passive:true});window.addEventListener("mouseup",this.dragStop,{passive:true})},dragMoving:function e(t){var a=this.currentWidth-t.screenX+this.currentScreenX;if(a<this.minWidth){this.rightPanelWidth=this.minWidth}else if(a>this.maxWidth){this.rightPanelWidth=this.maxWidth}else{this.rightPanelWidth=a}},dragStop:function e(){this.isDragActive=false;this.currentWidth=null;this.currentScreenX=null;window.removeEventListener("mousemove",this.dragMoving);window.removeEventListener("mouseup",this.dragStop)}}};var xe=ke;var ye=a(778);var $e=a(779);var Ve=Object(g["a"])(xe,i,n,false,null,"9eadb192",null);var Le=t["default"]=Ve.exports},220:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this;var t=e.$createElement;var a=e._self._c||t;return a("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:e.versionLoading},expression:"{ isLoading: versionLoading }"}],staticClass:"version-list-container"},[a("div",{staticClass:"template-title",staticStyle:{"padding-bottom":"9px"}},[a("span",{staticClass:"gsekit-icon gsekit-icon-down-line",on:{click:function(t){e.$store.commit("routeConfigTemplateList")}}}),e._v(" "),a("span",{staticClass:"text"},[e._v(e._s(e.displayTitle))])]),e._v(" "),a("TemplateFieldList",{attrs:{"selected-config":e.selectedConfig},on:{"update:selectedConfig":function(t){e.selectedConfig=t},change:e.updateSelectedConfig}}),e._v(" "),a("div",{staticClass:"version-list"},[a("div",{staticClass:"version-top-container"},[a("bk-button",{directives:[{name:"test",rawName:"v-test",value:"addVersion",expression:"'addVersion'"}],staticStyle:{"min-width":"104px"},attrs:{theme:"primary"},on:{click:e.handleCreate}},[e._v("\n        "+e._s(e.$t("新建版本"))+"\n      ")]),e._v(" "),a("bk-input",{directives:[{name:"test",rawName:"v-test",value:"searchDesc",expression:"'searchDesc'"}],staticStyle:{width:"480px"},attrs:{"right-icon":"icon-search",clearable:true,placeholder:e.$t("搜索版本描述")},on:{change:e.handleSearch},model:{value:e.searchKeyword,callback:function(t){e.searchKeyword=t},expression:"searchKeyword"}})],1),e._v(" "),a("bk-table",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:e.tableLoading,zIndex:0},expression:"{ isLoading: tableLoading, zIndex: 0 }"}],staticClass:"king-table",attrs:{data:e.searchedVersionList,"max-height":e.$store.state.pageHeight-280},on:{"row-click":e.handleRowClick}},[a("bk-table-column",{attrs:{label:e.$t("版本ID"),"min-width":"10"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;return[a("bk-button",{directives:[{name:"test",rawName:"v-test",value:"viewVersion",expression:"'viewVersion'"}],attrs:{theme:"primary",text:""}},[e._v(e._s(i.config_version_id))])]}}])}),e._v(" "),a("bk-table-column",{attrs:{label:e.$t("版本描述"),"min-width":"20"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;return a("div",{staticClass:"version-description"},[a("span",{directives:[{name:"bk-overflow-tips",rawName:"v-bk-overflow-tips"}],class:{"lighten-text":!i.is_draft&&!i.is_active,"text-overflow-row":true}},[e._v("\n            "+e._s(i.description)+"\n          ")]),e._v(" "),i.is_draft?a("TagDraft"):i.is_active?a("TagAvailable"):e._e()],1)}}])}),e._v(" "),a("bk-table-column",{attrs:{label:e.$t("更新人"),"min-width":"10",filters:e.updatePersonFilters,"filter-method":e.commonFilterMethod,"filter-multiple":true},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;return[a("div",{class:{"lighten-text":!i.is_draft&&!i.is_active}},[e._v(e._s(i.updated_by))])]}}])}),e._v(" "),a("bk-table-column",{attrs:{label:e.$t("更新时间"),"min-width":"15",sortable:"","sort-method":e.sortByDate("updated_at")},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;return[a("div",{class:{"lighten-text":!i.is_draft&&!i.is_active}},[e._v(e._s(e.formatDate(i.updated_at)))])]}}])}),e._v(" "),a("bk-table-column",{attrs:{label:e.$t("操作"),"min-width":"10"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;return[a("div",{staticClass:"button-container"},[a("span",{staticClass:"button-text"},[e._v(e._s(i.is_draft?e.$t("编辑"):e.$t("查看")))]),e._v(" "),!i.is_draft?a("span",{directives:[{name:"test",rawName:"v-test",value:"copy",expression:"'copy'"}],staticClass:"button-text",on:{click:function(t){t.stopPropagation();e.handleCopyAndCreate(i)}}},[e._v("\n              "+e._s(e.$t("复制并新建"))+"\n            ")]):e._e(),e._v(" "),i.is_active?[e.selectedConfig.is_bound?a("AuthTag",{directives:[{name:"test",rawName:"v-test",value:"configRelease",expression:"'configRelease'"}],class:["button-text",{"is-disabled":!e.authMap.operate_config}],attrs:{action:"operate_config",authorized:e.authMap.operate_config},on:{click:e.handleDistributeConfig}},[e._v("\n                "+e._s(e.$t("配置下发"))+"\n              ")]):a("span",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips",value:e.$t("未关联进程，无法进行配置下发"),expression:"$t('未关联进程，无法进行配置下发')"}],staticClass:"button-text is-disabled",on:{click:function(e){e.stopPropagation()}}},[e._v("\n                "+e._s(e.$t("配置下发"))+"\n              ")])]:e._e()],2)]}}])}),e._v(" "),a("bk-exception",{staticClass:"empty-box-container",attrs:{slot:"empty",type:"empty",scene:"part"},slot:"empty"},[e.versionList.length&&(e.searchKeyword||e.tableLoading)?[a("span",[e._v(e._s(e.$t("未搜索到匹配版本")))])]:[a("span",[e._v(e._s(e.$t("当前配置模板下暂无版本")))]),e._v(" "),a("div",{staticClass:"button-text",on:{click:e.handleCreate}},[e._v(e._s(e.$t("新建版本")))])]],2)],1)],1),e._v(" "),a("CreateDraft",{attrs:{"show-dialog":e.showCreateDialog,"version-list":e.versionList},on:{"update:showDialog":function(t){e.showCreateDialog=t},newVersion:e.handleNewCreate,created:e.handleSuccessCreated}}),e._v(" "),a("CoverDialog",{attrs:{show:e.showCoverDialog,"version-list":e.versionList,"cover-version":e.coverVersion},on:{"update:show":function(t){e.showCoverDialog=t},close:e.closeCoverDialog,coverSuccess:e.handleCoverSuccess}})],1)};var n=[];var s=a(11);var r=a.n(s);var o=a(3);var c=a.n(o);var l=a(7);var d=a.n(l);var v=a(13);var u=a.n(v);var f=a(4);var p=a.n(f);var h=a(8);var g=function(){var e=this;var t=e.$createElement;var a=e._self._c||t;return a("div",{staticClass:"template-field-list-container"},[a("div",{staticClass:"row"},[a("div",{staticClass:"couple"},[a("TemplateField",{attrs:{"selected-config":e.selectedConfig,field:"template_name","field-text":e.$t("模板名称")+e.$t("：")}})],1),e._v(" "),a("div",{staticClass:"couple"},[a("TemplateField",{attrs:{"selected-config":e.selectedConfig,field:"abs_path","field-text":e.$t("文件所处路径")+e.$t("：")}})],1),e._v(" "),a("div",{staticClass:"couple"},[a("TemplateField",{attrs:{"selected-config":e.selectedConfig,field:"owner","field-text":e.$t("文件拥有者")+e.$t("：")}})],1),e._v(" "),a("div",{staticClass:"couple"},[a("TemplateField",{attrs:{"selected-config":e.selectedConfig,field:"line_separator","field-text":e.$t("输出格式")+e.$t("：")}})],1)]),e._v(" "),a("div",{staticClass:"row"},[a("div",{staticClass:"couple"},[a("TemplateField",{attrs:{"selected-config":e.selectedConfig,field:"file_name","field-text":e.$t("文件名称")+e.$t("：")}})],1),e._v(" "),a("div",{staticClass:"couple"},[a("TemplateField",{attrs:{"selected-config":e.selectedConfig,field:"filemode","field-text":e.$t("文件权限")+e.$t("：")}})],1),e._v(" "),a("div",{staticClass:"couple"},[a("TemplateField",{attrs:{"selected-config":e.selectedConfig,field:"group","field-text":e.$t("文件用户组")+e.$t("：")}})],1),e._v(" "),a("div",{staticClass:"couple"},[a("div",{staticClass:"field-content"},[a("span",{staticClass:"field-text"},[e._v(e._s(e.$t("关联进程")+e.$t("：")))]),e._v(" "),e.selectedConfig.relation_count?a("span",{staticClass:"field-value button-text",on:{click:function(t){e.showBindProcess=true}}},[e._v("\n          "+e._s(e.selectedConfig.relation_count.TEMPLATE+e.selectedConfig.relation_count.INSTANCE)+"\n        ")]):e._e()])])]),e._v(" "),a("BindProcessDialog",{attrs:{"template-item":e.selectedConfig,"show-dialog":e.showBindProcess},on:{"update:showDialog":function(t){e.showBindProcess=t},bindSuccess:e.handleBindSuccess}})],1)};var m=[];var _=function(){var e=this;var t=e.$createElement;var a=e._self._c||t;return a("div",{staticClass:"field-content"},[a("span",{staticClass:"field-text"},[e._v(e._s(e.fieldText))]),e._v(" "),e.isEdit?[e.field==="line_separator"?a("bk-select",{ref:"select",staticStyle:{width:"260px"},attrs:{clearable:false},on:{toggle:e.handleSelectToggle},model:{value:e.initialValue,callback:function(t){e.initialValue=typeof t==="string"?t.trim():t},expression:"initialValue"}},[a("bk-option",{attrs:{id:"CRLF",name:"CRLF - Windows（\\r\\n）"}}),e._v(" "),a("bk-option",{attrs:{id:"LF",name:"LF - Unix and macOS（\\n）"}})],1):a("bk-input",{directives:[{name:"bk-clickoutside",rawName:"v-bk-clickoutside",value:e.handleChange,expression:"handleChange"}],ref:"input",staticStyle:{width:"260px"},on:{enter:e.handleChange},model:{value:e.initialValue,callback:function(t){e.initialValue=typeof t==="string"?t.trim():t},expression:"initialValue"}})]:[e.field==="line_separator"?a("span",{staticClass:"field-value"},[e._v("\n      "+e._s(e.lineSeparatorMap[e.selectedConfig[e.field]]||"--")+"\n    ")]):a("span",{directives:[{name:"bk-overflow-tips",rawName:"v-bk-overflow-tips"}],staticClass:"field-value"},[e._v(e._s(e.selectedConfig[e.field]||"--"))]),e._v(" "),e.isLoading?a("svg",{staticClass:"svg-icon",attrs:{"aria-hidden":"true"}},[a("use",{attrs:{"xlink:href":"#gsekit-icon-loading"}})]):a("AuthTag",{staticClass:"gsekit-icon gsekit-icon-edit-fill",attrs:{action:"edit_config_template",id:e.selectedConfig.config_template_id,authorized:e.selectedConfig.edit_config_template},on:{click:e.editField}})]],2)};var w=[];var b={props:{selectedConfig:{type:Object,default:function e(){return{}}},field:{type:String,default:""},fieldText:{type:String,default:""}},data:function e(){return{initialValue:this.selectedConfig[this.field],isEdit:false,isLoading:false,lineSeparatorMap:{LF:"LF - Unix and macOS（\\n）",CRLF:"CRLF - Windows（\\r\\n）"},rules:{abs_path:{validator:function e(t){return t.match(/^\/|^[a-zA-Z]:[\\]/)},message:this.$t("路径格式非法，请检查绝对路径格式是否正确")},owner:{validator:function e(t){return t.match(/^[a-zA-Z][a-zA-Z0-9]*$/)},message:this.$t("请输入英文字母或数字，且必须以英文字母开头")},group:{validator:function e(t){return t.match(/^[a-zA-Z][a-zA-Z0-9]*$/)},message:this.$t("请输入英文字母或数字，且必须以英文字母开头")},filemode:{validator:function e(t){return t.match(/^[0-7]{4}$/)},message:this.$t("文件权限设置提示")}}}},methods:{editField:function e(){this.isEdit=true;this.$nextTick(this.focusOnForm)},focusOnForm:function e(){if(this.field==="line_separator"){var t=this.$refs.select.$el.querySelector(".bk-select-name");t.click()}else{this.$refs.input.$el.querySelector("input").select()}},handleSelectToggle:function e(t){if(!t){this.handleChange()}},handleChange:function e(){var t=this;return d()(c.a.mark(function e(){var a,i;return c.a.wrap(function e(n){while(1){switch(n.prev=n.next){case 0:a=t.initialValue;i=t.rules[t.field];if(!i){n.next=7;break}if(i.validator(a)){n.next=7;break}t.messageError(i.message);t.focusOnForm();return n.abrupt("return");case 7:t.isEdit=false;if(!(a===t.selectedConfig[t.field])){n.next=10;break}return n.abrupt("return");case 10:n.prev=10;t.isLoading=true;n.next=14;return t.$store.dispatch("configTemplate/ajaxUpdateConfigTemplate",{templateId:t.$route.params.templateId,data:p()({},t.field,a)});case 14:t.$set(t.selectedConfig,t.field,t.initialValue);t.messageSuccess(t.$t("修改成功"));n.next=22;break;case 18:n.prev=18;n.t0=n["catch"](10);t.initialValue=t.selectedConfig[t.field];console.warn(n.t0);case 22:n.prev=22;t.isLoading=false;return n.finish(22);case 25:case"end":return n.stop()}}},e,null,[[10,18,22,25]])}))()}}};var C=b;var k=a(10);var x=Object(k["a"])(C,_,w,false,null,null,null);var y=x.exports;var $=a(646);var V={components:{TemplateField:y,BindProcessDialog:$["a"]},props:{selectedConfig:{type:Object,default:function e(){return{}}}},data:function e(){return{showBindProcess:false}},methods:{handleBindSuccess:function e(t,a){this.$emit("change",{key:"relation_count",value:{TEMPLATE:t,INSTANCE:a}});this.$emit("change",{key:"is_bound",value:!!t||!!a})}}};var L=V;var D=a(765);var T=Object(k["a"])(L,g,m,false,null,"f2e93058",null);var S=T.exports;var P=function(){var e=this;var t=e.$createElement;var a=e._self._c||t;return a("bk-dialog",{attrs:{value:e.showDialog,title:e.$t("新建版本"),loading:e.isLoading,"mask-close":false,width:"480","ext-cls":"create-version-dialog","header-position":"left"},on:{confirm:e.handleConfirm,"value-change":e.handleValueChange}},[a("div",{staticStyle:{margin:"-10px 0 8px"}},[e._v(e._s(e.$t("选择载入版本")))]),e._v(" "),a("bk-select",{ref:"select",staticStyle:{width:"430px"},attrs:{clearable:false},model:{value:e.selectedVersionId,callback:function(t){e.selectedVersionId=t},expression:"selectedVersionId"}},[a("div",{staticClass:"bk-select-name",attrs:{slot:"trigger"},slot:"trigger"},[e._v("\n      "+e._s(e.selectedVersionName)+"\n      "),e.isActiveVersion?a("TagAvailable"):e._e()],1),e._v(" "),a("bk-option",{attrs:{id:"__EMPTY",name:e.$t("不载入任何版本")}}),e._v(" "),e._l(e.versionList,function(t){return[a("bk-option",{key:t.config_version_id,attrs:{id:t.config_version_id,name:t.description}},[a("div",{staticClass:"option-name"},[a("span",{staticClass:"id"},[e._v("#"+e._s(t.config_version_id))]),e._v(" "),a("span",{staticClass:"description"},[e._v(e._s(t.description))]),e._v(" "),t.is_active?a("TagAvailable"):e._e()],1)])]})],2)],1)};var E=[];var N=a(345);var I={components:{TagAvailable:N["a"]},props:{showDialog:{type:Boolean,default:false},versionList:{type:Array,required:true}},data:function e(){return{selectedVersionId:"",selectedVersionName:"",isActiveVersion:false,isLoading:false}},watch:{showDialog:function e(t){if(t){this.selectedVersionId=this.versionList[0].config_version_id}},selectedVersionId:function e(t){if(t==="__EMPTY"){this.selectedVersionName=this.$t("不载入任何版本");this.isActiveVersion=false}else{var a=this.versionList.find(function(e){return e.config_version_id===t});this.selectedVersionName="#".concat(a.config_version_id," ").concat(a.description);this.isActiveVersion=a.is_active}}},methods:{handleValueChange:function e(t){this.$emit("update:showDialog",t)},handleConfirm:function e(){var t=this;return d()(c.a.mark(function e(){var a;return c.a.wrap(function e(i){while(1){switch(i.prev=i.next){case 0:if(!(t.selectedVersionId==="__EMPTY")){i.next=4;break}t.$emit("update:showDialog",false);t.$emit("newVersion");return i.abrupt("return");case 4:i.prev=4;t.isLoading=true;i.next=8;return t.$store.dispatch("configVersion/ajaxCreateConfigVersion",{versionId:t.selectedVersionId,data:{description:t.versionList.find(function(e){return e.config_version_id===t.selectedVersionId}).description}});case 8:a=i.sent;t.$emit("update:showDialog",false);t.$emit("created",a.data.config_version_id.toString());i.next=16;break;case 13:i.prev=13;i.t0=i["catch"](4);console.warn(i.t0);case 16:i.prev=16;t.isLoading=false;return i.finish(16);case 19:case"end":return i.stop()}}},e,null,[[4,13,16,19]])}))()}}};var j=I;var O=Object(k["a"])(j,P,E,false,null,null,null);var A=O.exports;var F=a(647);var R=a(386);var B=a(19);function W(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a.push.apply(a,i)}return a}function M(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?W(Object(a),!0).forEach(function(t){p()(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):W(Object(a)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}var q={name:"VersionList",components:{TemplateFieldList:S,CreateDraft:A,CoverDialog:F["a"],TagAvailable:N["a"],TagDraft:R["a"]},props:{selectedConfig:{type:Object,required:true},versionList:{type:Array,required:true},displayTitle:{type:String,default:""},versionLoading:{type:Boolean,default:true}},data:function e(){return{sortByDate:B["i"],commonFilterMethod:B["c"],formatDate:B["e"],showCreateDialog:false,showCoverDialog:false,coverVersion:null,searchKeyword:"",searchTimer:null,searchConfirmKeyword:"",tableLoading:false,updatePersonFilters:[]}},computed:M(M({},Object(h["d"])(["authMap"])),{},{searchedVersionList:function e(){var t=this;return this.versionList.filter(function(e){return e.description.includes(t.searchConfirmKeyword)})}}),watch:{versionList:{handler:function e(t){var a=new Set;t.forEach(function(e){a.add(e.updated_by)});this.updatePersonFilters=u()(a).map(function(e){return{text:e,value:e}})},immediate:true}},methods:{handleSearch:function e(t){var a=this;this.tableLoading=true;this.searchTimer&&clearTimeout(this.searchTimer);this.searchTimer=setTimeout(function(){a.tableLoading=false;a.searchConfirmKeyword=t},300)},handleRowClick:function e(t){this.$emit("clickVersionRow",t)},handleCopyAndCreate:function e(t){var a=this;return d()(c.a.mark(function e(){var i;return c.a.wrap(function e(n){while(1){switch(n.prev=n.next){case 0:if(!a.versionList.some(function(e){return e.is_draft})){n.next=5;break}a.coverVersion=t;a.showCoverDialog=true;n.next=21;break;case 5:n.prev=5;a.$emit("update:versionLoading",true);n.next=9;return a.$store.dispatch("configVersion/ajaxCreateConfigVersion",{versionId:t.config_version_id,data:{description:t.description}});case 9:i=n.sent;a.messageSuccess(a.$t("成功创建新版本"));a.$emit("createNewVersion",i.data);a.$store.commit("routeConfigTemplateVersionDetail",{templateId:a.$route.params.templateId,versionId:i.data.config_version_id});n.next=18;break;case 15:n.prev=15;n.t0=n["catch"](5);console.warn(n.t0);case 18:n.prev=18;a.$emit("update:versionLoading",false);return n.finish(18);case 21:case"end":return n.stop()}}},e,null,[[5,15,18,21]])}))()},handleCoverSuccess:function e(t,a){var i=this.versionList.find(function(e){return e.is_draft});r()(i,{description:a.description,content:a.content,file_format:a.codeLanguage,updated_at:a.updated_at,updated_by:a.updated_by});this.showCoverDialog=false;this.coverVersion=null;this.$store.commit("routeConfigTemplateVersionDetail",{templateId:this.$route.params.templateId,versionId:t})},closeCoverDialog:function e(){this.showCoverDialog=false;this.coverVersion=null},handleDistributeConfig:function e(){this.$store.commit("routeConfigTemplateDistribute",{templateId:this.$route.params.templateId})},handleCreate:function e(){var t=this;var a=this.versionList[0];if(!a){this.handleNewCreate()}else if(a.is_draft){this.$bkInfo({title:this.$t("当前已有草稿，是否继续编辑？"),confirmFn:function e(){t.$store.commit("routeConfigTemplateVersionDetail",{templateId:t.$route.params.templateId,versionId:a.config_version_id})}})}else{this.showCreateDialog=true}},handleNewCreate:function e(){var t=this;return d()(c.a.mark(function e(){return c.a.wrap(function e(a){while(1){switch(a.prev=a.next){case 0:t.$store.commit("routeConfigTemplateVersionDetail",{templateId:t.$route.params.templateId,versionId:"0"});case 1:case"end":return a.stop()}}},e)}))()},handleSuccessCreated:function e(t){this.$emit("updateVersionList",t)},updateSelectedConfig:function e(t){var a=t.key,i=t.value;this.$emit("change",{key:a,value:i})}}};var K=q;var z=a(768);var U=Object(k["a"])(K,i,n,false,null,"474cceb2",null);var H=t["default"]=U.exports},229:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this;var t=e.$createElement;var a=e._self._c||t;return a("div",{staticClass:"config-file-template-version-container"},[a("router-view",{attrs:{"selected-config":e.selectedConfig,"display-title":e.displayTitle,"version-loading":e.versionLoading,"version-list":e.versionList,"selected-version":e.selectedVersion},on:{"update:versionLoading":function(t){e.versionLoading=t},clickVersionRow:e.handleClickVersionRow,createNewVersion:e.handleCreateNewVersion,updateVersionList:e.getVersionList}})],1)};var n=[];var s=a(3);var r=a.n(s);var o=a(4);var c=a.n(o);var l=a(7);var d=a.n(l);function v(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a.push.apply(a,i)}return a}function u(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?v(Object(a),!0).forEach(function(t){c()(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):v(Object(a)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}var f={name:"TemplateVersion",props:{selectedConfig:{type:Object,required:true},displayTitle:{type:String,required:true}},data:function e(){return{versionLoading:true,versionList:[]}},computed:{selectedVersion:function e(){var t=this;var a=this.$route.params.versionId;if(a==="0"){return{isDraftCreating:true,config_version_id:"0",description:this.$t("草稿"),content:"",file_format:"python",is_draft:true}}return this.versionList.find(function(e){return e.config_version_id===t.$route.params.versionId})||null}},created:function e(){this.getVersionList()},methods:{getVersionList:function e(t){var a=this;return d()(r.a.mark(function e(){var i,n,s;return r.a.wrap(function e(r){while(1){switch(r.prev=r.next){case 0:r.prev=0;a.versionLoading=true;r.next=4;return a.$store.dispatch("configTemplate/ajaxGetConfigVersionList",{templateId:a.$route.params.templateId});case 4:i=r.sent;if(i.data.length){i.data.forEach(function(e){e.config_version_id+=""});a.versionList=i.data;if(t){a.$nextTick(function(){if(a.$route.params.versionId){a.$router.replace({params:{versionId:t}})}else{a.$store.commit("routeConfigTemplateVersionDetail",{templateId:a.$route.params.templateId,versionId:t})}})}else{n=a.$route.params.versionId;if(n){if(!i.data.some(function(e){return e.config_version_id===n})){s=i.data.find(function(e){return e.is_active})||i.data[0];a.$router.replace({params:{versionId:s.config_version_id},query:u({},a.$route.query)})}}else{}}}r.next=12;break;case 8:r.prev=8;r.t0=r["catch"](0);console.warn(r.t0);a.versionList.splice(0);case 12:r.prev=12;a.versionLoading=false;return r.finish(12);case 15:case"end":return r.stop()}}},e,null,[[0,8,12,15]])}))()},handleClickVersionRow:function e(t){this.$store.commit("routeConfigTemplateVersionDetail",{templateId:this.$route.params.templateId,versionId:t.config_version_id})},handleCreateNewVersion:function e(t){t.config_version_id+="";this.versionList.unshift(t)}}};var p=f;var h=a(764);var g=a(10);var m=Object(g["a"])(p,i,n,false,null,"9729315c",null);var _=t["default"]=m.exports},345:function(e,t,a){"use strict";var i=function(){var e=this;var t=e.$createElement;var a=e._self._c||t;return a("span",{style:e.style},[e._v("\n  "+e._s(e.$t("可用"))+"\n")])};var n=[];var s={props:{dark:{type:Boolean,default:false}},data:function e(){return{style:{"flex-shrink":"0",padding:"0 4px","margin-left":"4px","font-size":"12px","line-height":"16px",color:this.dark?"#59B383":"#3FC06D",background:this.dark?"#1F4D28":"#E5F6EA","border-radius":"2px"}}}};var r=s;var o=a(10);var c=Object(o["a"])(r,i,n,false,null,null,null);var l=t["a"]=c.exports},386:function(e,t,a){"use strict";var i=function(){var e=this;var t=e.$createElement;var a=e._self._c||t;return a("span",{style:e.style},[e._v("\n  "+e._s(e.$t("草稿"))+"\n")])};var n=[];var s={props:{dark:{type:Boolean,default:false}},data:function e(){return{style:{"flex-shrink":"0",padding:"0 4px","margin-left":"4px","font-size":"12px","line-height":"16px",color:this.dark?"#80AAFF":"#3A84FF",background:this.dark?"#293D66":"#E1ECFF","border-radius":"2px"}}}};var r=s;var o=a(10);var c=Object(o["a"])(r,i,n,false,null,null,null);var l=t["a"]=c.exports},546:function(e,t,a){},547:function(e,t,a){},548:function(e,t,a){},549:function(e,t,a){},550:function(e,t,a){},551:function(e,t,a){},552:function(e,t,a){},553:function(e,t,a){},554:function(e,t,a){},555:function(e,t,a){},556:function(e,t,a){},557:function(e,t,a){},558:function(e,t,a){},559:function(e,t,a){},560:function(e,t,a){},561:function(e,t,a){},647:function(e,t,a){"use strict";var i=function(){var e=this;var t=e.$createElement;var a=e._self._c||t;return a("bk-dialog",{attrs:{value:e.show,"mask-close":false,position:{top:e.dialogTop},width:"1200","ext-cls":"cover-draft-dialog"},on:{"value-change":e.handleValueChange}},[a("div",{staticClass:"header-container",attrs:{slot:"header"},slot:"header"},[a("div",[e._v(e._s(e.$t("当前已有草稿，是否覆盖？")))]),e._v(" "),a("DiffNav",{attrs:{"diff-count":e.diffCount},on:{previous:e.jumpPreviousChange,next:e.jumpNextChange}})],1),e._v(" "),a("div",{staticClass:"content-container"},[e.showEditor?[a("div",{staticClass:"cover-dialog-title"},[a("div",{staticClass:"cover-dialog-title-half"},[e._v("\n          #"+e._s(e.draftVersion.config_version_id+" "+e.draftVersion.description)+"\n          "),a("TagDraft",{attrs:{dark:""}})],1),e._v(" "),a("div",{staticClass:"cover-dialog-title-half"},[e._v("\n          #"+e._s(e.coverVersion.config_version_id+" "+e.coverVersion.description)+"\n          "),e.coverVersion.is_active?a("TagAvailable",{attrs:{dark:""}}):e._e()],1)]),e._v(" "),a("DiffEditor",{ref:"diffEditorRef",staticStyle:{height:"calc(100% - 52px)"},attrs:{"old-data":e.oldData,"new-data":e.newData,"diff-count":e.diffCount},on:{"update:diffCount":function(t){e.diffCount=t}}})]:e._e()],2),e._v(" "),a("div",{staticClass:"footer-container",attrs:{slot:"footer"},slot:"footer"},[a("bk-button",{directives:[{name:"test",rawName:"v-test",value:"cover",expression:"'cover'"}],staticClass:"confirm-button",attrs:{theme:"primary",loading:e.loading},on:{click:e.handleConfirm}},[e._v("\n      "+e._s(e.$t("确定覆盖"))+"\n    ")]),e._v(" "),a("bk-button",{on:{click:e.handleCancel}},[e._v(e._s(e.$t("取消")))])],1)])};var n=[];var s=a(3);var r=a.n(s);var o=a(7);var c=a.n(o);var l=a(386);var d=a(345);var v=a(388);var u=a(387);var f=a(544);var p={components:{TagDraft:l["a"],TagAvailable:d["a"],DiffNav:v["a"],DiffEditor:u["a"]},mixins:[f["a"]],props:{show:{type:Boolean,default:false},versionList:{type:Array,required:true},coverVersion:{type:Object,default:null}},data:function e(){return{dialogHeight:620,showEditor:false,loading:false,diffCount:0,draftVersion:null,oldData:{content:"",language:"python"},newData:{content:"",language:"python"}}},watch:{show:function e(t){var a=this;if(t){var i=this.versionList.find(function(e){return e.is_draft});this.draftVersion=i;this.oldData={content:i.content,language:i.file_format};this.newData={content:this.coverVersion.content,language:this.coverVersion.file_format};setTimeout(function(){a.showEditor=true})}else{this.showEditor=false}}},methods:{handleValueChange:function e(t){this.$emit("update:show",t)},jumpNextChange:function e(){this.$refs.diffEditorRef.diffNavigator.next()},jumpPreviousChange:function e(){this.$refs.diffEditorRef.diffNavigator.previous()},handleConfirm:function e(){var t=this;return c()(r.a.mark(function e(){var a,i;return r.a.wrap(function e(n){while(1){switch(n.prev=n.next){case 0:n.prev=0;t.loading=true;a=t.draftVersion.config_version_id;n.next=5;return t.$store.dispatch("configVersion/ajaxUpdateConfigVersion",{versionId:a,data:{description:t.coverVersion.description,content:t.coverVersion.content,file_format:t.coverVersion.file_format,is_active:false,is_draft:true}});case 5:i=n.sent;t.messageSuccess(t.$t("成功覆盖已有草稿"));t.$emit("coverSuccess",a,i.data);n.next=13;break;case 10:n.prev=10;n.t0=n["catch"](0);console.warn(n.t0);case 13:n.prev=13;t.loading=false;return n.finish(13);case 16:case"end":return n.stop()}}},e,null,[[0,10,13,16]])}))()},handleCancel:function e(){this.$emit("close")}}};var h=p;var g=a(766);var m=a(767);var _=a(10);var w=Object(_["a"])(h,i,n,false,null,"33dcfe92",null);var b=t["a"]=w.exports},764:function(e,t,a){"use strict";var i=a(546);var n=a.n(i);var s=n.a},765:function(e,t,a){"use strict";var i=a(547);var n=a.n(i);var s=n.a},766:function(e,t,a){"use strict";var i=a(548);var n=a.n(i);var s=n.a},767:function(e,t,a){"use strict";var i=a(549);var n=a.n(i);var s=n.a},768:function(e,t,a){"use strict";var i=a(550);var n=a.n(i);var s=n.a},769:function(e,t,a){"use strict";var i=a(551);var n=a.n(i);var s=n.a},770:function(e,t,a){"use strict";var i=a(552);var n=a.n(i);var s=n.a},771:function(e,t,a){"use strict";var i=a(553);var n=a.n(i);var s=n.a},772:function(e,t,a){"use strict";var i=a(554);var n=a.n(i);var s=n.a},773:function(e,t,a){"use strict";var i=a(555);var n=a.n(i);var s=n.a},774:function(e,t,a){"use strict";var i=a(556);var n=a.n(i);var s=n.a},775:function(e,t,a){"use strict";var i=a(557);var n=a.n(i);var s=n.a},776:function(e,t,a){"use strict";var i=a(558);var n=a.n(i);var s=n.a},777:function(e,t,a){"use strict";var i=a(559);var n=a.n(i);var s=n.a},778:function(e,t,a){"use strict";var i=a(560);var n=a.n(i);var s=n.a},779:function(e,t,a){"use strict";var i=a(561);var n=a.n(i);var s=n.a}}]);