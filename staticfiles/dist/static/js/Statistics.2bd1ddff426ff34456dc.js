(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[14],{224:function(t,a,e){"use strict";e.r(a);var r=function(){var t=this;var a=t.$createElement;var e=t._self._c||a;return e("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:t.loading},expression:"{ isLoading: loading }"}],staticClass:"operational-statistics"},[e("div",{staticClass:"page-head"},[e("div",[t._v(t._s(t.$t("运营统计")))]),t._v(" "),e("div",{staticClass:"search-head"},[e("div"),t._v(" "),e("bk-date-picker",{ref:"datePickerRef",attrs:{clearable:false,shortcuts:t.picker.shortcuts,type:"daterange","shortcut-close":true,"use-shortcut-text":true,"shortcut-selected-index":0,value:t.formData.timeRange,placeholder:t.$t("选择日期范围"),options:t.picker.options},on:{change:t.onPickerChange,"shortcut-change":t.handleShortcutChange}})],1)]),t._v(" "),e("section",{staticClass:"page-content"},[e("div",{staticClass:"chart-list"},[e("section",{staticClass:"chart-item"},[e("div",{staticClass:"chart-item-top"},[e("div",{staticClass:"chart-item-title"},[t._v(t._s(t.$t("活跃排行")))]),t._v(" "),e("div",{staticClass:"chart-item-filter"},[e("div",{staticClass:"select-job"},[e("bk-select",{attrs:{clearable:false},on:{change:t.getStaticByRanking},model:{value:t.formData.ranking,callback:function(a){t.$set(t.formData,"ranking",a)},expression:"formData.ranking"}},t._l(t.rankingFilters,function(t){return e("bk-option",{key:t.id,attrs:{id:t.id,name:t.name}})}),1)],1)])]),t._v(" "),e("div",{staticClass:"chart-item-bottom",style:{height:t.chartHeight+"px"}},[e("div",{staticClass:"chart-item-content"},[e("Chart",{ref:"chartTrendRef",attrs:{"chart-type":"bar","chart-data":t.chartData.ranking,"chart-options":Object.assign({},t.chartOption,{plugins:t.rankingPlugins})}})],1)])]),t._v(" "),e("section",{staticClass:"chart-item"},[e("div",{staticClass:"chart-item-top"},[e("div",{staticClass:"chart-item-title"},[t._v(t._s(t.$t("统计频次")))]),t._v(" "),e("div",{staticClass:"chart-item-filter"},[e("bk-radio-group",{on:{change:t.getStaticByFrequency},model:{value:t.formData.frequency,callback:function(a){t.$set(t.formData,"frequency",a)},expression:"formData.frequency"}},t._l(t.frequencyFilters,function(a){return e("bk-radio",{key:a.value,staticClass:"mr20",attrs:{value:a.value}},[t._v("\n                "+t._s(a.label)+"\n              ")])}),1)],1)]),t._v(" "),e("div",{staticClass:"chart-item-bottom",style:{height:t.chartHeight+"px"}},[e("div",{staticClass:"chart-item-content"},[e("Chart",{ref:"chartFrequencyRef",attrs:{"chart-type":"bar","chart-data":t.chartData.frequency,"chart-options":Object.assign({},t.chartOption,{plugins:t.frequencyPlugins})}})],1)])]),t._v(" "),e("section",{staticClass:"chart-item"},[e("div",{staticClass:"chart-item-top"},[e("div",{staticClass:"chart-item-title"},[t._v(t._s(t.$t("趋势统计")))]),t._v(" "),e("div",{staticClass:"chart-item-filter"},[e("div",{staticClass:"select-job"},[e("bk-select",{attrs:{clearable:false},on:{change:t.getStaticByTrend},model:{value:t.formData.job_object,callback:function(a){t.$set(t.formData,"job_object",a)},expression:"formData.job_object"}},t._l(t.objectFilters,function(t){return e("bk-option",{key:t.id,attrs:{id:t.id,name:t.name}})}),1)],1),t._v(" "),e("div",{staticClass:"select-job ml10"},[e("bk-select",{attrs:{clearable:false},on:{change:t.getStaticByTrend},model:{value:t.formData.job_action,callback:function(a){t.$set(t.formData,"job_action",a)},expression:"formData.job_action"}},t._l(t.actionFilters,function(t){return e("bk-option",{key:t.id,attrs:{id:t.id,name:t.name}})}),1)],1)])]),t._v(" "),e("div",{staticClass:"chart-item-bottom",style:{height:t.chartHeight+"px"}},[e("div",{staticClass:"chart-item-content"},[e("Chart",{ref:"chartTrendRef",attrs:{"chart-type":"line","chart-data":t.chartData.trend,"chart-options":t.chartOption}})],1)])])])])])};var i=[];var n=e(37);var s=e.n(n);var c=e(3);var o=e.n(c);var l=e(7);var u=e.n(l);var h=e(4);var d=e.n(h);var f=function(){var t=this;var a=t.$createElement;var e=t._self._c||a;return e("div",{staticClass:"chart"},[e("canvas",{ref:"chartRef",staticClass:"chart-instance"})])};var v=[];var m=e(788);var b=e.n(m);var g={props:{chartType:{type:String,required:true},chartData:{type:Object,default:function t(){return{}}},chartOptions:{type:Object,default:function t(){return{}}}},data:function t(){return{chart:null}},watch:{chartData:{deep:true,handler:function t(a){if(this.chart){this.chart.data=a;this.update()}}},chartOptions:{deep:true,handler:function t(a){if(this.chart){this.chart.options=a;this.update()}}}},mounted:function t(){var a=this.$refs.chartRef;this.chart=new b.a(a,{type:this.chartType,data:this.chartData,options:this.chartOptions})},methods:{onDataPickerPick:function t(){this.getTaskHistoryList()},handleClearDate:function t(){this.initDateTimeRange=["",""];this.getTaskHistoryList()},update:function t(){this.chart&&this.chart.update()}}};var p=g;var _=e(789);var k=e(10);var y=Object(k["a"])(p,f,v,false,null,"7db12664",null);var D=y.exports;var j=e(8);var C=e(19);function w(t,a){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);a&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),e.push.apply(e,r)}return e}function x(t){for(var a=1;a<arguments.length;a++){var e=null!=arguments[a]?arguments[a]:{};a%2?w(Object(e),!0).forEach(function(a){d()(t,a,e[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):w(Object(e)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(e,a))})}return t}var $={name:"OperationalStatistics",components:{Chart:D},data:function t(){return{loading:false,formData:{shortcutIndex:0,timeRange:[],frequency:"bk_biz_id",job_object:"all",job_action:"all",ranking:"bk_biz_id"},chartData:{frequency:{},trend:{},ranking:{}},chartOption:{maintainAspectRatio:false,layout:{padding:{left:0,right:0,top:30,bottom:0}},parsing:{xAxisKey:"date",yAxisKey:"count"},scales:{x:{stacked:true},y:{stacked:true}},plugins:{legend:{display:false},datalabels:{anchor:"end",align:"center",color:"#63656e",font:{weight:"bold",size:"10px"},formatter:Math.round,display:function t(a){var e=a.dataIndex,r=a.dataset;return r.data[e]}}}},frequencyPlugins:{},rankingPlugins:{},color:["rgb(75, 192, 192)","rgb(255, 99, 132)","rgb(255, 159, 64)","rgb(255, 205, 86)","rgb(75, 192, 192)","rgb(54, 162, 235)","rgb(153, 102, 255)","rgb(201, 203, 207)"],frequencyFilters:[{label:this.$t("按业务"),value:"bk_biz_id"},{label:this.$t("按执行人"),value:"created_by"},{label:this.$t("按执行命令"),value:"job_action"}],objectFilters:[{name:this.$t("全部任务对象"),id:"all"},{name:this.$t("配置文件"),id:"configfile"},{name:this.$t("进程"),id:"process"}],actionFilters:[{name:this.$t("全部动作"),id:"all"},{name:this.$t("生成"),id:"generate"},{name:this.$t("下发"),id:"release"},{name:this.$t("启动"),id:"start"},{name:this.$t("停止"),id:"stop"},{name:this.$t("重启"),id:"restart"},{name:this.$t("重载"),id:"reload"},{name:this.$t("强制停止"),id:"force_stop"},{name:this.$t("托管"),id:"set_auto"},{name:this.$t("取消托管"),id:"unset_auto"}],rankingFilters:[{name:this.$t("按业务"),id:"bk_biz_id"},{name:this.$t("按执行人"),id:"created_by"},{name:this.$t("按执行命令"),id:"job_action"},{name:this.$t("按任务状态"),id:"status"},{name:this.$t("按任务来源"),id:"bk_app_code"}],statusMap:{pending:this.$t("等待执行"),running:this.$t("正在执行"),succeeded:this.$t("执行成功"),failed:this.$t("执行失败"),ignored:this.$t("已忽略")},picker:{format:"YYYY-mm-dd",options:{disabledDate:function t(a){return a.getTime()>Date.now()}},shortcuts:[{text:window.i18n.t("近7天"),value:function t(){var a=new Date;var e=new Date;e.setTime(e.getTime()-3600*1e3*24*6);return[e,a]}},{text:window.i18n.t("近15天"),value:function t(){var a=new Date;var e=new Date;e.setTime(e.getTime()-3600*1e3*24*14);return[e,a]}},{text:window.i18n.t("近30天"),value:function t(){var a=new Date;var e=new Date;e.setTime(e.getTime()-3600*1e3*24*29);return[e,a]}},{text:window.i18n.t("近1年"),value:function t(){var a=new Date;var e=new Date;e.setTime(e.getTime()-3600*1e3*24*364);return[e,a]}}]}}},computed:x(x({},Object(j["d"])(["bizList","pageHeight"])),{},{chartHeight:function t(){return(Math.max(this.pageHeight,708)-220)/2-52}}),created:function t(){this.frequencyPlugins=this.getChartPlugin("frequency");this.rankingPlugins=this.getChartPlugin("ranking");var a=new Date;var e=new Date;e.setTime(e.getTime()-3600*1e3*24*7);this.formData.timeRange=[e,a];this.getStaticPageData()},methods:x(x({},Object(j["b"])("meta",["ajaxFrequencyStatistics","ajaxTrendStatistics","ajaxJobCountStatistics"])),{},{getStaticPageData:function t(){this.getStaticByFrequency();this.getStaticByTrend();this.getStaticByRanking()},getStaticByFrequency:function t(){var a=this;return u()(o.a.mark(function t(){var e,r,i,n,s,c,l,u,h;return o.a.wrap(function t(o){while(1){switch(o.prev=o.next){case 0:e=a.formData.frequency;o.prev=1;r=a.getDateParams();r.group_by=e;o.next=6;return a.ajaxFrequencyStatistics(r);case 6:i=o.sent;n=i.data;s=n===void 0?[]:n;if(s.length){if(["bk_biz_id","job_action"].includes(e)){c=a.getI18nMap(e);s=s.map(function(t){return x(x({},t),{},d()({},e,c[t[e]]))})}l={};s.reduce(function(t,a){t[a.date]=a;return t},l);u=a.getContinuityDate(r.start_time.slice(0,10),r.end_time.slice(0,10));s=u.map(function(t){return d()({date:t,count:l[t]?l[t].count:0},e,l[t]?l[t][e]:"")});h=a.color;a.$set(a.chartData,"frequency",{labels:s.map(function(t){return t.date}),datasets:[{data:s,backgroundColor:h,borderColor:h}]})}else{a.chartData.frequency={labels:[],datasets:[]}}o.next=15;break;case 12:o.prev=12;o.t0=o["catch"](1);console.warn(o.t0);case 15:case"end":return o.stop()}}},t,null,[[1,12]])}))()},getStaticByTrend:function t(){var a=this;return u()(o.a.mark(function t(){var e,r,i,n,c,l,u,h;return o.a.wrap(function t(o){while(1){switch(o.prev=o.next){case 0:o.prev=0;e=a.getDateParams();if(a.formData.job_object!=="all"){e.job_object=a.formData.job_object}if(a.formData.job_action!=="all"){e.job_action=a.formData.job_action}o.next=6;return a.ajaxTrendStatistics(e);case 6:r=o.sent;i=r.data;n=i===void 0?[]:i;if(n.length){c={};n.reduce(function(t,a){t[a.date]=a;return t},c);l=a.getContinuityDate(e.start_time.slice(0,10),e.end_time.slice(0,10));n=l.map(function(t){return{date:t,count:c[t]?c[t].count:0}});u=s()(a.color,1),h=u[0];a.chartData.trend={labels:n.map(function(t){return t.date}),datasets:[{data:n.map(function(t){return t.count}),borderColor:h}]}}else{a.chartData.trend={labels:[],datasets:[]}}o.next=15;break;case 12:o.prev=12;o.t0=o["catch"](0);console.warn(o.t0);case 15:case"end":return o.stop()}}},t,null,[[0,12]])}))()},getStaticByRanking:function t(){var a=this;return u()(o.a.mark(function t(){var e,r,i,n,s,c,l,u,h,f;return o.a.wrap(function t(o){while(1){switch(o.prev=o.next){case 0:o.prev=0;e=a.formData.ranking;r=a.color;i=a.getDateParams(),n=i.start_time,s=i.end_time;c={exclude_conditions:{},filter_conditions:{start_time__gte:n,start_time__lte:s},group_by:[e]};o.next=7;return a.ajaxJobCountStatistics(c);case 7:l=o.sent;u=l.data;h=u===void 0?[]:u;if(h.length){if(["bk_biz_id","job_action","status"].includes(e)){f=a.getI18nMap(e);h=h.map(function(t){return x(x({},t),{},d()({},e,f[t[e]]||t[e]))})}a.chartData.ranking={labels:h.map(function(t){return t[e]}),datasets:[{data:h,backgroundColor:r,borderColor:r}]}}else{a.chartData.trend={labels:[],datasets:[]}}o.next=16;break;case 13:o.prev=13;o.t0=o["catch"](0);console.warn(o.t0);case 16:case"end":return o.stop()}}},t,null,[[0,13]])}))()},handleShortcutChange:function t(a,e){this.formData.shortcutIndex=e},onPickerChange:function t(a){this.formData.timeRange=a;this.getStaticPageData()},getDateParams:function t(){var a="";var e="";if(this.formData.shortcutIndex>-1){var r=this.picker.shortcuts[this.formData.shortcutIndex];if(r){var i=r.value(),n=s()(i,2),c=n[0],o=n[1];a=Object(C["e"])(c,this.picker.format);e=Object(C["e"])(o,this.picker.format)}}else{var l=s()(this.formData.timeRange,2),u=l[0],h=l[1];a=Object(C["e"])(u,this.picker.format);e=Object(C["e"])(h,this.picker.format)}return{start_time:"".concat(a," 00:00:00"),end_time:"".concat(e," 23:59:59")}},getDateTimes:function t(a){return Date.parse(a.split("-"))},getContinuityDate:function t(a,e){var r=[];var i=this.getDateTimes(a);var n=this.getDateTimes(e);var s=60*60*24*1e3;var c=(n-i)/s;for(var o=0;o<=c;o++){if(i>=n){i=Object(C["e"])(n,this.picker.format);r.push(i)}else{r.push(Object(C["e"])(i,this.picker.format))}i+=s}return r},getI18nMap:function t(a){var e={};switch(a){case"bk_biz_id":this.bizList.reduce(function(t,a){e[a.bk_biz_id]=a.name;return t},e);break;case"job_action":this.actionFilters.reduce(function(t,a){e[a.id]=a.name;return t},e);break;case"status":e=this.statusMap;break;default:e={}}return e},getChartPlugin:function t(a){var e=this;var r=function t(r){return r[e.formData[a]]||""};var i=function t(a){var e=a.dataset;return e.data.length<=31};var n={callbacks:{label:function t(a){var r=a.formattedValue;return e.$t("执行次数",[r])}}};var s="-70";if(a==="ranking"){r=function t(a){return a.count||""};i=function t(a){var e=a.dataIndex,r=a.dataset;return r.data[e]};s=0}else{n.callbacks.label=function(t){var a=t.dataset,r=t.dataIndex;var i=a.data[r]||{};return e.$t("不定项次数",[i[e.formData.frequency],i.count])}}var c={anchor:"end",clamping:true,align:"top",offset:1,color:"#63656e",font:{weight:"bold",size:"10px"},rotation:s,formatter:r,display:i};var o={legend:{display:false},tooltip:n,datalabels:c};return o}})};var O=$;var P=e(790);var T=Object(k["a"])(O,r,i,false,null,"69812e21",null);var S=a["default"]=T.exports},570:function(t,a,e){},571:function(t,a,e){},789:function(t,a,e){"use strict";var r=e(570);var i=e.n(r);var n=i.a},790:function(t,a,e){"use strict";var r=e(571);var i=e.n(r);var n=i.a}}]);