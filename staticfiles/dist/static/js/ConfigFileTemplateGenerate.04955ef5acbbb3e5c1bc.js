(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[7],{222:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this;var e=t.$createElement;var a=t._self._c||e;return a("div",{staticClass:"config-file-template-generate-container"},[a("div",{staticClass:"template-title"},[a("span",{staticClass:"gsekit-icon gsekit-icon-down-line",on:{click:t.backRoute}}),t._v(" "),a("span",{staticClass:"text"},[t._v(t._s(t.$t("配置生成")+t.$t("：")+t.displayTitle))])]),t._v(" "),a("MainComponent",{attrs:{type:"generate","selected-config":t.selectedConfig}})],1)};var n=[];var i=function(){var t=this;var e=t.$createElement;var a=t._self._c||e;return a("div",{staticClass:"main-component",class:{"is-generate":t.isGeneratePage}},[!t.isGeneratePage?a("div",{staticClass:"steps-container"},[a("bk-steps",{staticClass:"king-steps",attrs:{"cur-step":t.curStep,steps:t.steps}})],1):t._e(),t._v(" "),a("div",{staticClass:"distribute-main"},[a("SelectInstance",{directives:[{name:"show",rawName:"v-show",value:t.curStep===1,expression:"curStep === 1"}],attrs:{"show-button":"","button-loading":t.tableLoading||t.generateButtonLoading},on:{init:t.handleSelectInstance,buttonClick:t.handleSelectInstance}}),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:t.curStep===2,expression:"curStep === 2"}],staticClass:"config-generate-button"},[a("bk-button",{staticStyle:{"margin-right":"10px"},attrs:{loading:t.generateButtonLoading,disabled:t.isDisableGenerateAndPrevious},on:{click:t.handleGenerate}},[t._v("\n        "+t._s(t.$t("全部重新生成"))+"\n      ")])],1),t._v(" "),a("InstanceTable",{attrs:{"cur-step":t.curStep,"selected-config":t.selectedConfig,"has-polling-task":t.hasPollingTask,"status-counter":t.statusCounter,"is-distributing":t.distributeButtonLoading,"is-generate-page":t.isGeneratePage,"instance-list":t.instanceList,"table-loading":t.tableLoading},on:{pageAdd:t.handlePageAdd,updateStatus:t.handleStatusChange}})],1),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:!(t.isGeneratePage&&t.curStep===2),expression:"!(isGeneratePage && curStep === 2)"}],staticClass:"distribute-footer",class:{"is-button-fixed":t.isButtonFixed}},[a("bk-button",{directives:[{name:"show",rawName:"v-show",value:t.curStep===1,expression:"curStep === 1"}],staticStyle:{"min-width":"120px","margin-right":"10px"},attrs:{loading:t.generateButtonLoading,disabled:!t.instanceList.length||t.tableLoading,theme:"primary"},on:{click:t.handleGenerate}},[t._v("\n      "+t._s(t.isGeneratePage?t.$t("立即生成"):t.$t("下一步"))+"\n    ")]),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:t.curStep===2,expression:"curStep === 2"},{name:"bk-tooltips",rawName:"v-bk-tooltips",value:{content:t.$t("所有配置生成成功方能下发"),disabled:!t.isDisableDistribute},expression:"{ content: $t('所有配置生成成功方能下发'), disabled: !isDisableDistribute }"}],staticClass:"button-container"},[a("bk-button",{staticStyle:{"min-width":"120px","margin-right":"10px"},attrs:{theme:"primary",loading:t.distributeButtonLoading,disabled:t.isDisableDistribute},on:{click:t.handleDistribute}},[t._v("\n        "+t._s(t.$t("立即下发"))+"\n      ")])],1),t._v(" "),a("bk-button",{directives:[{name:"show",rawName:"v-show",value:t.curStep===2,expression:"curStep === 2"}],staticStyle:{"min-width":"86px","margin-right":"10px"},attrs:{disabled:t.isDisableGenerateAndPrevious},on:{click:t.handlePrevious}},[t._v("\n      "+t._s(t.$t("上一步"))+"\n    ")]),t._v(" "),a("bk-button",{staticStyle:{"min-width":"86px"},on:{click:t.handleCancel}},[t._v("\n      "+t._s(t.$t("取消"))+"\n    ")])],1)])};var r=[];var o=a(3);var l=a.n(o);var u=a(4);var c=a.n(u);var d=a(7);var p=a.n(d);var f=a(572);var v=function(){var t=this;var e=t.$createElement;var a=t._self._c||e;return a("div",{staticClass:"instance-table-container"},[a("div",{staticClass:"header"},[a("div",{staticClass:"header-left"},[a("b",[t._v(t._s(t.$t("选择实例")))]),t._v("\n      "+t._s(t.$t("（")+t.$t("已选"))+"\n      "),a("span",{staticClass:"blue"},[t._v(t._s(t.instanceList.length))]),t._v("\n      "+t._s(t.$t("个_实例")+t.$t("）"))+"\n    ")]),t._v(" "),t.curStep===2?a("div",{staticClass:"header-right"},[a("span",{staticClass:"success"},[t._v(t._s(t.statusCounter.succeeded))]),t._v("\n      "+t._s(t.$t("已生成")+t.$t("，"))+"\n      "),a("span",{staticClass:"failed"},[t._v(t._s(t.statusCounter.failed))]),t._v("\n      "+t._s(t.$t("生成失败")+t.$t("，"))+"\n      "),a("span",{staticClass:"loading"},[t._v(t._s(t.statusCounter.pending+t.statusCounter.running))]),t._v("\n      "+t._s(t.$t("生成中"))+"\n    ")]):t._e()]),t._v(" "),a("bk-table",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:t.tableLoading,zIndex:0},expression:"{ isLoading: tableLoading, zIndex: 0 }"}],staticClass:"king-table",attrs:{"max-height":t.maxHeight,"empty-text":t.emptyText,data:t.tableLoadedList}},[a("bk-table-column",{attrs:{label:t.$t("集群")},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.row;return a("div",{directives:[{name:"bk-overflow-tips",rawName:"v-bk-overflow-tips"}],staticClass:"table-ceil-overflow"},[a("span",[t._v(t._s(s.bk_set_name))])])}}])}),t._v(" "),a("bk-table-column",{attrs:{label:t.$t("模块")},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.row;return a("div",{directives:[{name:"bk-overflow-tips",rawName:"v-bk-overflow-tips"}],staticClass:"table-ceil-overflow"},[a("span",[t._v(t._s(s.bk_module_name))])])}}])}),t._v(" "),a("bk-table-column",{attrs:{label:t.$t("服务实例")},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.row;return a("div",{directives:[{name:"bk-overflow-tips",rawName:"v-bk-overflow-tips"}],staticClass:"table-ceil-overflow"},[a("span",[t._v(t._s(s.bk_service_name))])])}}])}),t._v(" "),a("bk-table-column",{attrs:{label:t.$t("进程别名")},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.row;return a("div",{directives:[{name:"bk-overflow-tips",rawName:"v-bk-overflow-tips"}],staticClass:"table-ceil-overflow"},[a("span",[t._v(t._s(s.bk_process_name))])])}}])}),t._v(" "),a("bk-table-column",{attrs:{label:"process_id"},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.row;return a("div",{directives:[{name:"bk-overflow-tips",rawName:"v-bk-overflow-tips"}],staticClass:"table-ceil-overflow"},[a("span",[t._v(t._s(s.bk_process_id))])])}}])}),t._v(" "),a("bk-table-column",{attrs:{label:"inst_id"},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.row;return a("div",{directives:[{name:"bk-overflow-tips",rawName:"v-bk-overflow-tips"}],staticClass:"table-ceil-overflow"},[a("span",[t._v(t._s(s.inst_id))])])}}])}),t._v(" "),a("bk-table-column",{attrs:{label:t.$t("内网IP")},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.row;return a("div",{directives:[{name:"bk-overflow-tips",rawName:"v-bk-overflow-tips"}],staticClass:"table-ceil-overflow"},[a("span",[t._v(t._s(s.bk_host_innerip))])])}}])}),t._v(" "),t.curStep===2?[a("bk-table-column",{attrs:{label:t.$t("状态"),prop:"taskStatus"},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.row;return[s.taskStatus==="pending"||s.taskStatus==="running"?a("StatusView",{attrs:{type:"loading",text:t.$t("生成中")}}):t._e(),t._v(" "),s.taskStatus==="succeeded"?a("StatusView",{attrs:{type:"success",text:t.$t("已生成")}}):s.taskStatus==="failed"?a("GenerateFailed",{attrs:{"failed-reason":s.failed_reason,solutions:s.solutions}}):t._e()]}}])}),t._v(" "),a("bk-table-column",{attrs:{label:t.$t("操作"),width:"170px"},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.row;return[a("bk-button",{staticStyle:{"margin-right":"6px"},attrs:{theme:"primary",text:"",disabled:t.hasPollingTask||t.isDistributing||["pending","running"].includes(s.taskStatus)},on:{click:function(e){t.regenerate(s)}}},[t._v(t._s(t.$t("重新生成"))+"\n          ")]),t._v(" "),a("bk-button",{attrs:{theme:"primary",text:"",disabled:s.taskStatus!=="succeeded"||t.isDistributing},on:{click:function(e){t.compareConfiguration(s)}}},[t._v(t._s(t.$t("配置对比"))+"\n          ")])]}}])})]:t._e()],2),t._v(" "),a("bk-sideslider",{attrs:{"is-show":t.sliderData.isShow,"quick-close":true,width:1200},on:{"update:isShow":function(e){t.$set(t.sliderData,"isShow",e)},hidden:t.handleCloseSlider}},[a("div",{staticClass:"config-contrast-header",attrs:{slot:"header"},slot:"header"},[a("span",[t._v(t._s(t.$t("配置对比")))]),t._v(" "),a("span",{staticClass:"divide-line"},[t._v(t._s("-"))]),t._v(" "),a("span",{staticClass:"template-name"},[t._v(t._s(t.selectedConfig.template_name+"("+t.selectedConfig.file_name+")"))])]),t._v(" "),a("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:t.sliderData.isLoading},expression:"{ isLoading: sliderData.isLoading }"}],staticStyle:{height:"calc(100vh - 60px)"},attrs:{slot:"content"},slot:"content"},[t.sliderData.oldData?a("SidesliderDiff",{attrs:{"old-data":t.sliderData.oldData,"new-data":t.sliderData.newData}},[a("template",{slot:"leftTitle"},[a("div",{staticClass:"status-flag"},[t._v(t._s(t.$t("实时")))]),t._v(" "),a("div",{staticClass:"create-time"},[t._v(t._s(t.$t("更新时间")+t.$t("：")+(t.formatDate(t.sliderData.oldData.time)||"--")))])]),t._v(" "),a("template",{slot:"rightTitle"},[a("div",{staticClass:"status-flag"},[t._v(t._s(t.$t("预生成")))]),t._v(" "),a("div",{staticClass:"create-time"},[t._v(t._s(t.$t("生成时间")+t.$t("：")+(t.formatDate(t.sliderData.newData.time)||"--")))])])],2):t._e()],1)])],1)};var h=[];var g=a(13);var b=a.n(g);var _=a(19);var m=a(649);var k=a(575);var S={components:{SidesliderDiff:m["a"],GenerateFailed:k["a"]},props:{curStep:{type:Number,required:true},selectedConfig:{type:Object,required:true},hasPollingTask:{type:Boolean,required:true},statusCounter:{type:Object,required:true},isDistributing:{type:Boolean,required:true},isGeneratePage:{type:Boolean,required:true},instanceList:{type:Array,required:true},tableLoading:{type:Boolean,required:true}},data:function t(){return{formatDate:_["e"],emptyText:this.$t("暂未选择实例"),isThrottled:false,isPageOver:false,tableScroller:null,tableLoadedList:[],tablePagedList:[],pageSize:50,totalCount:null,totalPage:null,currentPage:null,sliderData:{isShow:false,isLoading:false,oldData:null,newData:null}}},computed:{maxHeight:function t(){var e=this.$store.state.pageHeight;if(this.isGeneratePage){return e-257}return e-317}},watch:{instanceList:function t(e){this.emptyText=this.$t("当前指定范围未能匹配到实例，请确认所选范围是否有误，或对应范围是否存在主机");this.tableLoadedList.splice(0);if(e.length){this.initPagination(e)}else{this.isPageOver=true}}},mounted:function t(){this.tableScroller=this.$el.querySelector(".bk-table-body-wrapper");this.tableScroller.addEventListener("scroll",this.handleTableScroll,{passive:true})},beforeDestroy:function t(){this.tableScroller.removeEventListener("scroll",this.handleTableScroll)},methods:{initPagination:function t(e){this.isPageOver=false;this.totalCount=e.length;this.totalPage=Math.ceil(this.totalCount/this.pageSize);this.currentPage=0;this.tablePagedList.splice(0);for(var a=0;a<this.totalCount;a+=this.pageSize){this.tablePagedList.push(e.slice(a,a+this.pageSize))}this.loadPage();this.tableScroller.scrollTop=0},loadPage:function t(){var e;this.currentPage+=1;this.isPageOver=this.currentPage===this.totalPage;(e=this.tableLoadedList).splice.apply(e,[this.tableLoadedList.length,0].concat(b()(this.tablePagedList[this.currentPage-1])));this.$emit("pageAdd",this.tableLoadedList.length)},handleTableScroll:function t(){var e=this;if(!this.isPageOver&&!this.isThrottled){this.isThrottled=true;setTimeout(function(){e.isThrottled=false;var t=e.tableScroller;if(t.scrollHeight-t.offsetHeight-t.scrollTop<10){e.loadPage()}},200)}},regenerate:function t(e){var a=this;return p()(l.a.mark(function t(){var s,n;return l.a.wrap(function t(i){while(1){switch(i.prev=i.next){case 0:s=a.instanceList.filter(function(t){return t.bk_process_id===e.bk_process_id});s.forEach(function(t){a.updateStatus("running",a.statusCounter.running+1);if(t.taskStatus==="succeeded"){a.updateStatus("succeeded",a.statusCounter.succeeded-1)}else if(t.taskStatus==="failed"){a.updateStatus("failed",a.statusCounter.failed-1)}t.taskStatus="running"});i.prev=2;i.next=5;return a.$store.dispatch("configTemplate/ajaxSyncGenerateConfig",{data:{bk_process_id:e.bk_process_id},templateId:a.$route.params.templateId});case 5:n=i.sent;s.forEach(function(t){var e=n.data.find(function(e){return t.inst_id===e.extra_data.inst_id})||{};if(e.status==="succeeded"){t.taskStatus="succeeded";a.updateStatus("running",a.statusCounter.running-1);a.updateStatus("succeeded",a.statusCounter.succeeded+1)}else if(e.status==="failed"){t.taskStatus="failed";t.failed_reason=e.extra_data.failed_reason;t.solutions=e.extra_data.solutions;a.updateStatus("running",a.statusCounter.running-1);a.updateStatus("failed",a.statusCounter.failed+1)}else{console.warn("同步生成接口出错，没有 matchTaskItem 或者状态不对");t.taskStatus="failed";a.updateStatus("running",a.statusCounter.running-1);a.updateStatus("failed",a.statusCounter.failed+1)}});i.next=13;break;case 9:i.prev=9;i.t0=i["catch"](2);console.warn(i.t0);s.forEach(function(t){t.taskStatus="failed";a.updateStatus("running",a.statusCounter.running-1);a.updateStatus("failed",a.statusCounter.failed+1)});case 13:case"end":return i.stop()}}},t,null,[[2,9]])}))()},compareConfiguration:function t(e){var a=this;return p()(l.a.mark(function t(){var s;return l.a.wrap(function t(n){while(1){switch(n.prev=n.next){case 0:n.prev=0;a.sliderData.isShow=true;a.sliderData.isLoading=true;n.next=5;return a.$store.dispatch("configInstance/ajaxGetLatestConfigInstance",{instId:e.inst_id,processId:e.bk_process_id,templateId:Number(a.$route.params.templateId)});case 5:s=n.sent;s.data.released_config=s.data.released_config||{};a.sliderData.oldData={content:s.data.released_config.content,language:s.data.released_config.file_format,time:s.data.released_config.created_at};a.sliderData.newData={content:s.data.generated_config.content,language:s.data.generated_config.file_format,time:s.data.generated_config.created_at};n.next=14;break;case 11:n.prev=11;n.t0=n["catch"](0);console.warn(n.t0);case 14:n.prev=14;a.sliderData.isLoading=false;return n.finish(14);case 17:case"end":return n.stop()}}},t,null,[[0,11,14,17]])}))()},handleCloseSlider:function t(){this.sliderData.oldData=null;this.sliderData.newData=null},updateStatus:function t(e,a){this.$emit("updateStatus",{key:e,value:a})}}};var w=S;var C=a(781);var x=a(10);var L=Object(x["a"])(w,v,h,false,null,"b82d5028",null);var $=L.exports;var T={components:{SelectInstance:f["a"],InstanceTable:$},props:{selectedConfig:{type:Object,required:true},type:{type:String,default:"distribute",validator:function t(e){return["distribute","generate"].includes(e)}}},data:function t(){return{tableLoading:false,distributeButtonLoading:false,generateButtonLoading:false,hasPollingTask:false,isAllTaskSucceededOrFailed:false,jobId:null,isJobReady:false,jobTimer:null,taskTimer:null,isButtonFixed:false,isDropdownMode:true,selectedScope:null,instanceList:[],instanceCounts:0,curStep:1,steps:[{title:this.$t("选择实例"),icon:1},{title:this.$t("配置生成"),icon:2}],statusCounter:{succeeded:0,failed:0,pending:0,running:0}}},computed:{isGeneratePage:function t(){return this.type==="generate"},hasRunningTask:function t(){return this.statusCounter.pending+this.statusCounter.running!==0},isDisableGenerateAndPrevious:function t(){return this.distributeButtonLoading||this.generateButtonLoading||this.hasRunningTask},isDisableDistribute:function t(){return this.generateButtonLoading||this.hasRunningTask}},watch:{"$store.state.pageHeight":function t(){this.resizeHandler()},instanceList:function t(){this.resizeHandler()}},beforeDestroy:function t(){this.jobTimer&&clearTimeout(this.jobTimer);this.taskTimer&&clearTimeout(this.taskTimer)},methods:{resizeHandler:function t(){var e=this;this.$nextTick(function(){e.isButtonFixed=e.$el.scrollHeight>e.$el.offsetHeight})},handleSelectInstance:function t(e,a){var s=this;return p()(l.a.mark(function t(){var n,i;return l.a.wrap(function t(r){while(1){switch(r.prev=r.next){case 0:r.prev=0;s.isDropdownMode=e;s.selectedScope=a;s.tableLoading=true;r.next=6;return s.$store.dispatch("configInstance/ajaxGetConfigInstanceList",{data:(n={},c()(n,e?"scope":"expression_scope",s.selectedScope),c()(n,"config_template_id",Number(s.$route.params.templateId)),n)});case 6:i=r.sent;i.data.forEach(function(t){t.taskStatus=""});s.instanceList=i.data;r.next=15;break;case 11:r.prev=11;r.t0=r["catch"](0);console.warn(r.t0);s.instanceList.splice(0);case 15:r.prev=15;s.tableLoading=false;return r.finish(15);case 18:case"end":return r.stop()}}},t,null,[[0,11,15,18]])}))()},handleGenerate:function t(){var e=this;return p()(l.a.mark(function t(){var a;return l.a.wrap(function t(s){while(1){switch(s.prev=s.next){case 0:if(!(!e.isGeneratePage&&e.curStep===1&&e.instanceList.every(function(t){return t.status==="generated"}))){s.next=5;break}e.curStep=2;e.instanceList.forEach(function(t){t.taskStatus="succeeded"});e.statusCounter={succeeded:e.instanceList.length,failed:0,pending:0,running:0};return s.abrupt("return");case 5:s.prev=5;e.jobId=null;e.isJobReady=false;e.generateButtonLoading=true;e.instanceList.forEach(function(t){t.taskStatus="running"});e.statusCounter={succeeded:0,failed:0,pending:0,running:e.instanceList.length};s.next=13;return e.$store.dispatch("configTemplate/ajaxGenerateConfig",{data:c()({config_template_id:Number(e.$route.params.templateId)},e.isDropdownMode?"scope":"expression_scope",e.selectedScope)});case 13:a=s.sent;e.jobId=a.data.job_id;e.pollingJobStatus();e.curStep=2;e.hasPollingTask=true;e.isAllTaskSucceededOrFailed=false;s.next=24;break;case 21:s.prev=21;s.t0=s["catch"](5);console.warn(s.t0);case 24:s.prev=24;e.generateButtonLoading=false;return s.finish(24);case 27:case"end":return s.stop()}}},t,null,[[5,21,24,27]])}))()},pollingJobStatus:function t(){var e=this;this.jobTimer=setTimeout(p()(l.a.mark(function t(){var a;return l.a.wrap(function t(s){while(1){switch(s.prev=s.next){case 0:s.prev=0;s.next=3;return e.$store.dispatch("job/ajaxGetJobDetail",{jobId:e.jobId});case 3:a=s.sent;if(a.data.is_ready){e.isJobReady=true;e.getTaskList()}else{e.pollingJobStatus()}s.next=10;break;case 7:s.prev=7;s.t0=s["catch"](0);console.warn(s.t0);case 10:case"end":return s.stop()}}},t,null,[[0,7]])})),2e3)},getTaskList:function t(){var e=this;return p()(l.a.mark(function t(){var a,s;return l.a.wrap(function t(n){while(1){switch(n.prev=n.next){case 0:n.prev=0;e.taskTimer&&clearTimeout(e.taskTimer);n.next=4;return e.$store.dispatch("job/ajaxGetJobTaskList",{jobId:e.jobId,data:{page:1,pagesize:e.instanceCounts}});case 4:a=n.sent;if(e.hasPollingTask){e.statusCounter=a.data.status_counter}s=[];e.instanceList.slice(0,e.instanceCounts).forEach(function(t,e){var n=a.data.list[e];var i=n.id,r=n.status;if(r==="succeeded"){t.taskStatus="succeeded"}else if(r==="failed"){t.taskStatus="failed";t.failed_reason=n.extra_data.failed_reason;t.solutions=n.extra_data.solutions}else{s.push({taskId:i,instanceIndex:e})}});if(e.judgeTaskDone()){e.hasPollingTask=false}else if(e.hasPollingTask){e.pollingTaskStatus(s)}n.next=14;break;case 11:n.prev=11;n.t0=n["catch"](0);console.warn(n.t0);case 14:case"end":return n.stop()}}},t,null,[[0,11]])}))()},pollingTaskStatus:function t(e){var a=this;this.taskTimer=setTimeout(p()(l.a.mark(function t(){var s,n;return l.a.wrap(function t(i){while(1){switch(i.prev=i.next){case 0:i.prev=0;i.next=3;return a.$store.dispatch("job/ajaxGetJobStatus",{jobId:a.jobId,data:{job_task_id_list:e.map(function(t){return t.taskId})}});case 3:s=i.sent;a.statusCounter=s.data.status_counter;n=[];e.forEach(function(t,e){var i=a.instanceList[t.instanceIndex];var r=s.data.job_tasks[e];var o=r.status;if(o==="succeeded"){i.taskStatus="succeeded"}else if(o==="failed"){i.taskStatus="failed";i.failed_reason=r.extra_data.failed_reason;i.solutions=r.extra_data.solutions}else{n.push(t)}});if(a.judgeTaskDone()){a.hasPollingTask=false}else{a.pollingTaskStatus(n)}i.next=13;break;case 10:i.prev=10;i.t0=i["catch"](0);console.warn(i.t0);case 13:case"end":return i.stop()}}},t,null,[[0,10]])})),2e3)},judgeTaskDone:function t(){var e=this.statusCounter.pending+this.statusCounter.running===0;if(e&&!this.isAllTaskSucceededOrFailed){if(!this.statusCounter.failed){this.isAllTaskSucceededOrFailed=true;this.instanceList.forEach(function(t){t.taskStatus="succeeded"})}else if(!this.statusCounter.succeeded){this.isAllTaskSucceededOrFailed=true;this.instanceList.forEach(function(t){t.taskStatus="failed"})}}return e},handlePageAdd:function t(e){this.instanceCounts=e;if(this.jobId!==null&&this.isJobReady&&!this.isAllTaskSucceededOrFailed){this.getTaskList()}},handleDistribute:function t(){var e=this;return p()(l.a.mark(function t(){var a;return l.a.wrap(function t(s){while(1){switch(s.prev=s.next){case 0:s.prev=0;e.distributeButtonLoading=true;s.next=4;return e.$store.dispatch("configTemplate/ajaxSetReleaseConfig",{data:c()({config_template_id:Number(e.$route.params.templateId)},e.isDropdownMode?"scope":"expression_scope",e.selectedScope)});case 4:a=s.sent;e.$store.commit("routeTaskHistoryDetail",a.data.job_id);s.next=12;break;case 8:s.prev=8;s.t0=s["catch"](0);console.warn(s.t0);e.distributeButtonLoading=false;case 12:case"end":return s.stop()}}},t,null,[[0,8]])}))()},handlePrevious:function t(){this.curStep-=1;this.jobId=null;this.isJobReady=false;this.hasPollingTask=false;this.isAllTaskSucceededOrFailed=false;this.handleSelectInstance(this.isDropdownMode,this.selectedScope)},handleCancel:function t(){if(this.$router.__from_name){this.$router.back()}else{this.$store.commit("routeConfigTemplateList")}},handleStatusChange:function t(e){var a=e.key,s=e.value;this.statusCounter[a]=s}}};var D=T;var y=a(782);var P=Object(x["a"])(D,i,r,false,null,"c443a684",null);var j=P.exports;var I={name:"TemplateGenerate",components:{MainComponent:j},props:{selectedConfig:{type:Object,required:true},displayTitle:{type:String,required:true}},methods:{backRoute:function t(){if(this.$router.__from_name){this.$router.back()}else{this.$store.commit("routeConfigTemplateList")}}}};var G=I;var B=a(783);var N=Object(x["a"])(G,s,n,false,null,"4c6f0a4d",null);var O=e["default"]=N.exports},563:function(t,e,a){},564:function(t,e,a){},565:function(t,e,a){},781:function(t,e,a){"use strict";var s=a(563);var n=a.n(s);var i=n.a},782:function(t,e,a){"use strict";var s=a(564);var n=a.n(s);var i=n.a},783:function(t,e,a){"use strict";var s=a(565);var n=a.n(s);var i=n.a}}]);